<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML lang="ja-JP">
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>ポリシーエディタの使い方</title>
<link rel=stylesheet href="tomoyo.css" media=all>
</HEAD>
<body>
<h1>ポリシーエディタの使い方</h1>
<p style="text-align:right;">Last modified: $Date$ UT</p>
<p>TOMOYO Linux には、 CUI で動作するポリシーエディタが付属しています。<br>
TOMOYO Linux のポリシーはテキストファイルなので、 vi や emacs 等の任意のエディタを使用することも可能ですが、<br>
/proc/ccs インタフェースに書き込もうとすると「バックアップファイルを作成できない」等のエラーメッセージが
多数表示されて使いにくいので、<br>
ポリシーエディタを使用することを推奨します。</p>

<p>プロンプトから editpolicy と入力すると、ポリシーエディタを実行することができます。</p>

<p><img src="editpolicy-1.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<ul>
<li>rootでログイン</li>
<li>idコマンドを実行</li>
<li>/etc/passwdの「最初の3行」を表示</li>
<li>/bin/shを起動</li>
<li>dateコマンドを実行</li>
<li>/etc/passwdの「最後の3行」を表示</li>
<li>/bin/shを終了してからTOMOYO Linuxのポリシーエディタを起動</li>
</ul>

<p>以下の画面は、CentOS 4.4 を学習モードで起動した後、上記の操作を行った場合のポリシーです。<br>
この画面には、ドメイン遷移の一覧が表示されており、Linuxが起動時にどのような動作を行っているかを解析することができます。</p>

<p>＜ドメインポリシーの編集画面（１）＞</p>
<p><img src="editpolicy-2.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p>上の図からanacronを起動するスクリプトのに対して学習されたポリシーを確認してみましょう。<br>
ポリシーエディタは「ドメイン遷移の表示」モードと「個別のドメインにおけるアクセス許可の表示」モードの2つのモードを持ちます。<br>
起動直後は「ドメイン遷移の表示」モードとなっています。<br>
アクセス許可の内容を知りたいドメインを選択して Enter を押すと、「個別のドメインにおけるアクセス許可の表示」モードになります。<br>
矢印キーでカーソルを動かしてanacronの行を選択してから Enterキーを押すと、<br>
次のような画面（anacronを起動するスクリプトに対するアクセス許可内容）が表示されます。</p>

<p>＜ドメインポリシーの編集画面（２）＞</p>
<p><img src="editpolicy-3.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p>行番号の右隣の数字は、Linuxのパーミッション(rwx)を8進数にしたものです。<br>
つまり4はr--(読み込み)、6はrw-(読み書き)、1は--x(実行)を意味します。<br>
anacronを起動するスクリプトの実行に必要なアクセス許可がポリシーとして学習されているのがおわかりいただけると思います。</p>
<p>一番下のuse_profileという行は、そのドメインに割り当てられているプロファイル番号です。 setprofile コマンドで変更することができる他、この画面からも a キーを押してから「use_profile プロファイル番号」と入力することで変更することが可能です。</p>

<p>Enterキーを押して、再びドメイン遷移の表示モードに戻り、/sbin/mingettyのドメインを探してみてください。</p>
<p>画面を見ると、ログインするとmingettyから/bin/loginというプログラム経由で/bin/bashというシェルを起動していること、<br>
（後述する例外ポリシーで alias /bin/bash /bin/sh という指定がされていることから）/bin/bashへのシンボリックリンクである/bin/shが実行された場合は/bin/shとして扱われていることがわかります。<br>
また、先ほど実行したheadコマンドやdateコマンドが記録されていることもわかります。<br>
では、カーソルを動かしてheadコマンドのドメインを選択して Enter キーを押してみましょう。</p>

<p><img src="editpolicy-4.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p><img src="editpolicy-5.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p>/sbin/mingettyから起動された/bin/loginから起動された/bin/bashから起動された/usr/bin/headが<br>
/etc/passwdに対して読み込みアクセス許可を与えられていることがわかります。<br>
同じコマンドであっても起動されたアクセス履歴により独立なドメインとして扱われますし、<br>
同じドメインであっても対象毎に細かくアクセスが定義できることがおわかりいただけると思います。<br>
しかもそれらが自動的に行われるので、TOMOYO Linuxは標準的なスキルを持つシステム管理者であれば誰でも使うことができます。</p>

<p>また、 Tab キーを押すことで「ドメインポリシー」→「システムポリシー」→「例外ポリシー」→「ドメインポリシー」の順番で画面が切り替わります。</p>

<p>＜システムポリシーの編集画面＞</p>
<p><img src="editpolicy-6.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p>＜例外ポリシーの編集画面＞</p>

<p><img src="editpolicy-7.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>
<p><img src="editpolicy-8.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>
<p><img src="editpolicy-9.png" alt="Policy Editor" WIDTH="733" HEIGHT="458"></p>

<p>上記で説明したポリシーエディタの editpolicy は TOMOYO Linux カーネルで動作中に、カーネル内のポリシーを直接編集するためのエディタです。 /etc/ccs/ ディレクトリに保存されているポリシーを編集する場合は editpolicy_offline を利用します。</p>
</body>
</html>
