<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>SYAORAN ポリシー解説書</title>
<link rel="stylesheet" href="tomoyo.css" media="all" type="text/css">
</head>
<body>
<hr>
<h1 style="text-align:center;">SYAORAN ポリシー解説書</h1>
<p style="text-align:right;">Last modified: $Date$ UT</p>
<h2><a name="policy_syntax">1. ポリシーファイルの分類と構文</a></h2>
<h3><a name="pathname_style">ファイル名の指定方法について</a></h3>
<p>SYAORAN では、シンボリックリンクや .. 等を全て解決した上でカーネルから見た絶対パス名（以下、正規化されたパス名）を使用している。 当該プロセスが chroot された環境下で動作する場合であっても、 chroot する前のパス名で指定されることに注意。</p>
<p>正規化されたディレクトリ名は常に / で終わる。 正規化されたファイル名は決して / で終わらない。</p>
<p>正規化されたパス名は、全てアスキーコードの表示可能な範囲（0x21〜0x7E）で構成されている。 従って、空白文字（0x20）は \040 、 \ 文字（0x5C）は \\ 、その他の表示不可能な文字は \ooo 形式の８進数で表記する。 空白や改行はデリミタとして扱われるので、必ず８進数に変換すること。</p>
<h3><a name="syntax">SYAORANファイルシステム用ポリシーファイル</a></h3>
<p>このファイルでは、 /dev ディレクトリの内容を指定する。 /dev ディレクトリには多数のデバイスファイルが存在しているが、実際にシステムの動作に必要なのは数十個程度である。 また、デバイスファイルが常に正しいデバイスと繋がっていることは、セキュリティ上、不可欠である。 例えば、 /dev/null がメジャー番号 1 マイナー番号 3 のキャラクタ型デバイスとしてではなく、メジャー番号 8 マイナー番号 0 のブロック型デバイス（ /dev/sda ）として存在していた場合、たちまち SCSI ハードディスクの内容が破壊されてしまうであろう。</p>
<p>設定ファイルの書式は以下の通りである。</p>
<p>１行に１エントリを記述する。 各エントリには９個の要素がある。</p>
<table border="1">
<tr>
<td>filename</td>
<td>マウントポイント以降の正規化されたパス名。但し、最初の / は除く。</td>
</tr>
<tr>
<td>permission</td>
<td>８進数で表記されたパーミッション。 000 〜 777 で指定する。</td>
</tr>
<tr>
<td>owner</td>
<td>１０進数で表記された所有者。</td>
</tr>
<tr>
<td>group</td>
<td>１０進数で表記されたグループ。</td>
</tr>
<tr>
<td>flags</td>
<td>以下の値の論理和。<br>
<ul>
<li>1: マウント後に作成を許可する。</li>
<li>2: マウント後に削除を許可する。</li>
<li>4: マウント後にパーミッションの変更を許可する。</li>
<li>8: マウント後に所有者またはグループの変更を許可する。</li>
<li>16: 内部で使用。デバイスファイルにアクセスされたか否か。</li>
<li>32: マウント時点では作成しない。</li>
</ul>
</td>
</tr>
<tr>
<td>type</td>
<td>デバイスファイルの型。 'd' (ディレクトリ), 'p' (ＦＩＦＯ), 's' (ソケット), 'c' (キャラクタ型デバイス), 'b' (ブロック型デバイス), 'l' (シンボリックリンク) , 'f' (通常ファイル) のいずれかを指定。</td>
</tr>
<tr>
<td>symlink_data</td>
<td>マウント時に作成されるシンボリックリンクの内容。 type が l 以外の場合は不要。</td>
</tr>
<tr>
<td>major</td>
<td>１０進数で表記されたメジャー番号。 type が c または b 以外の場合は不要。</td>
</tr>
<tr>
<td>minor</td>
<td>１０進数で表記されたマイナー番号。 type が c または b 以外の場合は不要。</td>
</tr>
</table>
<p>各行は '\n' で区切られる。 ファイル名・ディレクトリ名の内容は全て正規化した形で指定する。 ただし、ディレクトリ名の末尾の / は省略可能である。</p>
<p>シンボリックリンクの内容は正規化する必要は無い。</p>
<p>空白文字などをシンボリックリンク中に含める目的で \\ および \ooo 形式によるエスケープを行うことが可能である。</p>
<p>使用方法：</p>
<table border="1">
<tr>
<td>Step 1</td>
<td>flags が 0 の状態の設定ファイルを作成する。</td>
</tr>
<tr>
<td>Step 2</td>
<td>accept モードでマウントする。設定ファイルを /etc/ccs/syaoran.conf に作成して /dev にマウントする場合、<br>
mount -t syaoran -o accept=/etc/ccs/syaoran.conf none /dev<br>
を実行する。</td>
</tr>
<tr>
<td>Step 3</td>
<td>通常通りシステムを稼動させる。実際のアクセスされた内容に基づき flags の値が更新される。</td>
</tr>
<tr>
<td>Step 4</td>
<td>学習結果はマウントポイント直下にある .syaoran というファイルを通じて読み出すことができるのでこれを適当に編集（不要なシンボリックリンクの削除など）して /etc/ccs/syaoran.conf に保存する。 accept モードでは、実際にオープンされたキャラクタ型デバイスとブロック型デバイスのみが .syaoran に反映されるので、不要なエントリを削除するために利用できる。ディレクトリ、ＦＩＦＯ、ソケット、シンボリックリンク、通常ファイルはオープンされたかどうかに関係なく常に .syaoran に反映される。</td>
</tr>
<tr>
<td>Step 5</td>
<td>アンマウントする。</td>
</tr>
<tr>
<td>Step 6</td>
<td>enforce モードでマウントする場合は、<br>
mount -t syaoran -o enforce=/etc/ccs/syaoran.conf none /dev<br>
を実行する。 enforce モードでは、 flags の値が更新されることは無い。<br>
エントリ不足などによりポリシー違反が発生すると SYAORAN-ERROR: というメッセージが表示される。以下のコマンドを用いて知ることができる。<br>
dmesg | grep ^SYAORAN-ERROR:
</td>
</tr>
</table>
<p>カーネルのコマンドラインに SYAORAN=accept または SYAORAN=enforce と指定することで、デフォルトのモードを指定できる。デフォルトのモードを指定した場合は、マウント時に accept= または enforce= を省略することができる。</p>
<hr>
<h2><a name="policy_example">2. ポリシーファイルの例</a></h2>
<p>必要なエントリはシステム毎に異なります。</p>
<table border="0">
<tr>
<td>#filename</td>
<td>permission</td>
<td>owner</td>
<td>group</td>
<td>flags</td>
<td>type</td>
<td colspan="2">[ symlink_data | major minor ]</td>
</tr>
<tr>
<td>pts</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>shm</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>fd</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd</td>
</tr>
<tr>
<td>stdin</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/0</td>
</tr>
<tr>
<td>stdout</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/1</td>
</tr>
<tr>
<td>stderr</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/2</td>
</tr>
<tr>
<td>null</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>zero</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>random</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>urandom</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>9</td>
</tr>
<tr>
<td>tty</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>5</td>
<td>0</td>
</tr>
<tr>
<td>tty0</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>tty1</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>tty2</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>tty3</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>3</td>
</tr>
<tr>
<td>tty4</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>tty5</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>5</td>
</tr>
<tr>
<td>tty6</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>6</td>
</tr>
<tr>
<td>tty7</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>7</td>
</tr>
<tr>
<td>tty8</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>8</td>
</tr>
<tr>
<td>cdrom</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/dev/scd0</td>
</tr>
<tr>
<td>mouse</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>psaux</td>
</tr>
<tr>
<td>console</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>c</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>fd0</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>fd1</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>fd2</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>fd3</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>hda</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>hda1</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>hda2</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>hda3</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>hda5</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>hda6</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>6</td>
</tr>
<tr>
<td>hda7</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>7</td>
</tr>
<tr>
<td>hda8</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>8</td>
</tr>
<tr>
<td>hda9</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>9</td>
</tr>
<tr>
<td>hda10</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>10</td>
</tr>
<tr>
<td>hda11</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>11</td>
</tr>
<tr>
<td>hda12</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>12</td>
</tr>
<tr>
<td>initctl</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>p</td>
</tr>
<tr>
<td>log</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>15</td>
<td>s</td>
</tr>
<tr>
<td>rtc</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>135</td>
</tr>
<tr>
<td>ptmx</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>5</td>
<td>2</td>
</tr>
<tr>
<td>ram</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/dev/ram0</td>
</tr>
<tr>
<td>ram0</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>ram1</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>sda</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>8</td>
<td>0</td>
</tr>
<tr>
<td>initrd</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>1</td>
<td>b</td>
<td>1</td>
<td>250</td>
</tr>
<tr>
<td>psaux</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td>apm_bios</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>134</td>
</tr>
<tr>
<td>cpu</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>cpu/0</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>cpu/0/microcode</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>184</td>
</tr>
<tr>
<td>ttyS0</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>64</td>
</tr>
<tr>
<td>ttyS1</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>65</td>
</tr>
<tr>
<td>ttyS2</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>66</td>
</tr>
<tr>
<td>ttyS3</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>67</td>
</tr>
<tr>
<td>ptal-printd</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/var/run/ptal-printd</td>
</tr>
<tr>
<td>gpmctl</td>
<td>700</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>s</td>
</tr>
<tr>
<td>scd0</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>11</td>
<td>0</td>
</tr>
</table>
<hr>
<p><a href="index.html#manual">目次へ戻る</a></p>
<hr>
</body>
</html>
