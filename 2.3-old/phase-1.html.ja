<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linux 導入手順書</title>
<link rel="stylesheet" href="http://tomoyo.sourceforge.jp/tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>This page is for TOMOYO 2.3 (for Linux 2.6.36 and later kernels). Please jump to <a href="../2.2/">this page</a> for TOMOYO 2.2 (for Linux 2.6.30 - 2.6.35 kernels).</p>
<p style="text-align:right;"><a href="phase-1.html.en">English Page</a></p>
<p style="text-align:right;">Last modified: $Date$</p>
<h1>第１節：導入と初期化</h1>

<p style="text-align:center;">目的： TOMOYO Linux 対応カーネルおよび管理ツールをインストールし、システムの解析および保護を行うための準備をします。</p>

<hr>

<h2><a name="1.1">ステップ１．１：依存するパッケージのインストール</a></h2>

<p>カーネルおよびツールをコンパイルするためには以下のパッケージが必要になります。</p>
<ul>
<li><b>wget</b>：ファイルをダウンロードするために必要です。</li>
<li><b>gcc</b>：コンパイルを行うために必要です。</li>
<li><b>make</b>： Makefile を利用するために必要です。</li>
<li><b>ncurses</b>：ツールのユーザインタフェースを利用するために必要です。</li>
<li><b>patch</b>：不具合修正パッチを適用するために必要です。</li>
</ul>

<p>これらのパッケージは以下のコマンドを実行することによりインストールできます。</p>

<table border="1">
<tr><td>RedHat 系の場合</td><td>
[root@tomoyo ~]# yum -y install wget gcc make ncurses-devel patch
</td></tr>
<tr><td>Debian 系の場合</td><td>
[root@tomoyo ~]# apt-get -y install wget gcc make libncurses-dev patch
</td></tr>
<tr><td>SUSE 系の場合</td><td>
[root@tomoyo ~]# yast -i wget gcc make ncurses-devel patch
</td></tr>
</table>

<br>

<hr>

<h2><a name="1.2">ステップ１．２：カーネルのインストール</a></h2>

<h3>既に TOMOYO Linux 対応カーネルであるかどうか判断する</h3>

<p>TOMOYO Linux 2.3 はメインラインカーネルのソースに既に含まれていますが、特定のカーネルコンフィグオプションを有効にしないと利用できません。以下の手順により利用中のカーネルで TOMOYO Linux を利用できるかどうかを判断することができます。</p>

<table border="1">
<tr><td>
[root@tomoyo ~]$ grep tomoyo_supervisor /proc/kallsyms
</td></tr>
</table>

<p>/proc/kallsyms の中に tomoyo_supervisor を含む行が存在していた場合、既に TOMOYO Linux 対応カーネルですので、<a href="#1.3">ステップ１．３：管理ツールのインストール</a>へと進んでください。存在しない場合、 TOMOYO Linux 対応カーネルを作成する必要がありますので、以下の手順に従ってインストールしてください。</p>

<h3>カーネルソースの入手</h3>

<p>カーネルのソースを "<a href="https://www.kernel.org/pub/linux/kernel/v2.6/">linux-2.6</a>" または "<a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git">linux git tree</a>" からダウンロードして展開してください。<br>
カーネル 2.6.36 以降に対応しています。</p>

<p>カーネルのソースを展開して、そのディレクトリに移動してください。</p>

<p>メインラインのカーネルのソースに反映することが間に合わなかった不具合修正パッチがあるかもしれません。利用するカーネルのバージョンに合った全ての不具合修正パッチ（例えば 2.6.38 カーネルの場合には 2.6.38-tomoyo-\*.patch ）を <a href="http://tomoyo.sourceforge.jp/2.3/patches/">http://tomoyo.sourceforge.jp/2.3/patches/</a> からダウンロードして、カーネルのソースコードを展開したディレクトリから以下のコマンドを実行してください。（以下のコマンドは、適用済みのパッチがあればスキップします。）</p>

<table border="1">
<tr><td>
[user@tomoyo ~]$ for i in 2.6.*-tomoyo-*.patch; do patch -Nt -p1 --dry-run &lt; $i &amp;&amp; patch -p1 &lt; $i; done
</td></tr>
</table>

<h3>カーネルコンパイルオプションの変更</h3>

<table border="1">
<tr><td>
[user@tomoyo ~]$ make -s menuconfig
</td></tr>
</table>

<p>Security options の画面に移動して、以下のオプションを選択してください。（ <i>Default security module</i> として TOMOYO を指定するかどうかは任意です。）</p>

<pre>
[*] Enable different security models
-*- Enable the securityfs filesystem
-*- Security hooks for pathname based access control
[*] TOMOYO Linux Support
    Default security module (TOMOYO)
</pre>

<h3>カーネルのコンパイルとインストール</h3>

<p>カーネルコンパイルオプションの変更が終わったら、カーネルをコンパイルしてください。</p>

<table border="1">
<tr><td>
[user@tomoyo ~]$ make -s<br>
[user@tomoyo ~]$ su<br>
[root@tomoyo ~]# make -s modules_install install
</td></tr>
</table>

<p>必要であれば initrd/initramfs の作成を行ってください。</p>

<hr>

<h2><a name="1.3">ステップ１．３：管理ツールのインストール</a></h2>

<p>前述した依存するパッケージがインストールされていることを確認してください。以下のコマンドを実行することによりコンパイルおよびインストールできます。</p>

<table border="1">
<tr><td>
[root@tomoyo ~]# wget -O tomoyo-tools-2.3.0-20110511.tar.gz 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/48663/tomoyo-tools-2.3.0-20110511.tar.gz'<br>
[root@tomoyo ~]# wget -O tomoyo-tools-2.3.0-20110511.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/48663/tomoyo-tools-2.3.0-20110511.tar.gz.asc'<br>
[root@tomoyo ~]# wget http://I-love.SAKURA.ne.jp/kumaneko-key<br>
[root@tomoyo ~]# gpg --import kumaneko-key<br>
[root@tomoyo ~]# gpg tomoyo-tools-2.3.0-20110511.tar.gz.asc<br>
[root@tomoyo ~]# tar -zxf tomoyo-tools-2.3.0-20110511.tar.gz<br>
[root@tomoyo ~]# make -C tomoyo-tools/ install<br>
[root@tomoyo ~]# ldconfig
</td></tr>
</table>

<br>

<hr>

<h2><a name="1.4">ステップ１．４：設定の初期化</a></h2>

<p>TOMOYO Linux を利用するために、ポリシーの初期化を行う必要があります。以下の操作を行ってください。</p>

<table border="1">
<tr><td>
[root@tomoyo ~]# /usr/lib/tomoyo/init_policy
</td></tr>
</table>

<p>ポリシーファイルが /etc/tomoyo/ ディレクトリの中に作成されます。</p>

<p>TOMOYO 2.2 用のポリシーと TOMOYO 2.3 用のポリシーとの間には互換性がありません。既に TOMOYO 2.2 用のポリシーを策定済みであっても、 /etc/tomoyo/ ディレクトリを削除（またはリネーム）してから上記のコマンドを実行する必要があります。さもないと、起動時にカーネルパニックに遭遇します。</p>

<hr>

<h2><a name="1.5">ステップ１．５：ブートローダの設定および再起動</a></h2>

<p>前述の手順でインストールされたカーネルをブートローダ（例えば GRUB など）から選択できるように、ブートローダの設定を行ってください。もし、カーネルコンフィグで CONFIG_DEFAULT_SECURITY_TOMOYO=y という指定が行われていない場合、 security=tomoyo という指定をカーネル起動時のコマンドラインオプションに含めることを忘れないでください。ディストリビューションにより、ブートローダの設定ファイルの場所が異なります。 GRUB バージョン１を利用している場合には /boot/grub/grub.conf または /boot/grub/menu.lst のどちらか、 GRUB バージョン２を利用している場合には /boot/grub/grub.cfg であると思います。詳しくはお使いのディストリビューションのドキュメントを参照してください。</p>

<p>その後、再起動を行い、インストールされたカーネルを選択して起動してください。（第２節からは TOMOYO Linux 対応カーネルで起動されていることを前提として話を進めます。）</p>

<br>

<div class=navfooter>
<hr align="left" width="100%">
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="33%" align="left" valign="top">
</td>
<td width="34%" align="center" valign="top">
<a href="index.html.ja">目次</a>
</td>
<td width="33%" align="right" valign="top">
<a href="phase-2.html.ja">次節</a>
</td></tr>
<tr><td width="33%" align="left" valign="top">
</td>
<td width="34%" align="center" valign="top">
<a href="http://tomoyo.sourceforge.jp/">ホームへ</a>
</td>
<td width="33%" align="right" valign="top">
第２節： TOMOYO Linux を理解する
</td>
</tr>
</table>
</div>

<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="sflogo.php" title="SourceForge.jp"></a></p>
</body>
</html>
