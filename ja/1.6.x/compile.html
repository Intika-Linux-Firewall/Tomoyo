<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linuxカーネルの作成手順</title>
<link rel="stylesheet" href="tomoyo.css" media="all" type="text/css">
</head>
<body>
<p style="text-align:right;"><a href="../../en/1.6.x/compile.html">English Page</a></p>
<h1>TOMOYO Linuxカーネルの作成手順</h1>
<p style="text-align:right;">Last modified: $Date$</p>

<p>カーネルをコンパイルするためには、以下のパッケージが必要です。</p>

<ul>
<li>gcc</li>
<li>make</li>
<li>ncurses</li>
</ul>

<p>make menuconfig を実行し、「File systems」画面の一番下に表示される以下の項目を選択してください。</p>

<ul>
<li>[*] SAKURA (Domain-Free Mandatory Access Control) support
<li>[*] TOMOYO (Domain-Based Mandatory Access Control) support
<li>&lt;m&gt; SYAORAN (Tamper-Proof Device Filesystem) support
</ul>

<p>カーネル 2.6 には、 CONFIG_DEBUG_INFO という名前のコンパイルオプションが存在します。このオプションが有効である場合、コンパイルされたコードのサイズが約１０倍の大きさになります。このオプションを有効にすると、 /usr/src/ ディレクトリで約１ＧＢ、 /lib/modules/ ディレクトリで約３００ＭＢの余分なディスク領域を消費します。<br>
ディスク領域を節約したい場合、以下のオプションを無効にしてください。</p>

<table border="1">
<tr><td>
Kernel hacking ---&gt;[&nbsp;] &nbsp;&nbsp;Compile the kernel with debug info
</td></tr>
</table>

<p>以下の一覧から、該当するバージョンを選択してください。</p>

<ul>
<li><a href="#RedHatLinux9">RedHat Linux 9</a>
<li><a href="#FedoraCore3">Fedora Core 3</a>
<li><a href="#FedoraCore4">Fedora Core 4</a>
<li><a href="#FedoraCore5">Fedora Core 5</a>
<li><a href="#FedoraCore6">Fedora Core 6</a>
<li><a href="#Fedora7">Fedora 7</a>
<li><a href="#Fedora8">Fedora 8</a>
<li><a href="#Fedora9">Fedora 9</a>
<li><a href="#CentOS4.6">CentOS 4.6</a>
<li><a href="#CentOS5.2">CentOS 5.2</a>
<li><a href="#Sarge-2.4">Debian Sarge (2.4.27)</a>
<li><a href="#Sarge-2.6">Debian Sarge (2.6.8)</a>
<li><a href="#Etch">Debian Etch</a>
<li><a href="#Lenny">Debian Lenny</a>
<li><a href="#OpenSUSE10.1">OpenSUSE 10.1</a>
<li><a href="#OpenSUSE10.2">OpenSUSE 10.2</a>
<li><a href="#OpenSUSE10.3">OpenSUSE 10.3</a>
<li><a href="#OpenSUSE11.0">OpenSUSE 11.0</a>
<li><a href="#Asianux2">Asianux 2.0</a>
<li><a href="#Asianux3">Asianux 3.0</a>
<li><a href="#Ubuntu6.06">Ubuntu 6.06</a>
<li><a href="#Ubuntu6.10">Ubuntu 6.10</a>
<li><a href="#Ubuntu7.04">Ubuntu 7.04</a>
<li><a href="#Ubuntu7.10">Ubuntu 7.10</a>
<li><a href="#Ubuntu8.04">Ubuntu 8.04</a>
<li><a href="#VineLinux4.2">VineLinux 4.2</a>
<li><a href="#2.6-vanilla">バニラ 2.6 カーネル</a>
<li><a href="#2.4-vanilla">バニラ 2.4 カーネル</a>
</ul>

<hr>

<h2><a name="RedHatLinux9">RedHat Linux 9</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-rhl9-2.4.20.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-rhl9-2.4.20.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-rhl9-2.4.20.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i386 /tmp/kernel-2.4.20-46.9.legacy_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="FedoraCore3">Fedora Core 3</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-fc3-2.6.12.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-fc3-2.6.12.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-fc3-2.6.12.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.12-2.3.legacy_FC3_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="FedoraCore4">Fedora Core 4</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-fc4-2.6.17.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-fc4-2.6.17.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-fc4-2.6.17.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.17-1.2142_FC4_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="FedoraCore5">Fedora Core 5</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-fc5-2.6.20.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-fc5-2.6.20.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-fc5-2.6.20.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.20-1.2320.fc5_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="FedoraCore6">Fedora Core 6</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-fc6-2.6.22.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-fc6-2.6.22.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-fc6-2.6.22.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.22.14-72.fc6_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Fedora7">Fedora 7</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-f7-2.6.23.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-f7-2.6.23.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-f7-2.6.23.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.23.17-88.fc7_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Fedora8">Fedora 8</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-f8-2.6.25.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-f8-2.6.25.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-f8-2.6.25.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.25.4-10.fc8_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Fedora9">Fedora 9</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-f9-2.6.25.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-f9-2.6.25.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-f9-2.6.25.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.25.9-76.fc9_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="CentOS4.6">CentOS 4.6</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-c4-2.6.9.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-c4-2.6.9.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-c4-2.6.9.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.9-67.0.20.EL_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="CentOS5.2">CentOS 5.2</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-c5-2.6.18.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-c5-2.6.18.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-c5-2.6.18.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i686 --without kabichk /tmp/kernel-2.6.18-92.1.6.el5_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Sarge-2.4">Debian Sarge (2.4.27)</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-debian_sarge-2.4.27.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_sarge-2.4.27.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-debian_sarge-2.4.27.sh<br>
</td></tr>
</table>

<h2><a name="Sarge-2.6">Debian Sarge (2.6.8)</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-debian_sarge-2.6.8.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_sarge-2.6.8.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-debian_sarge-2.6.8.sh<br>
</td></tr>
</table>

<h2><a name="Etch">Debian Etch</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-debian_etch.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_etch.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-debian_etch.sh<br>
</td></tr>
</table>

<h2><a name="Lenny">Debian Lenny</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-debian_lenny.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_lenny.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-debian_lenny.sh<br>
</td></tr>
</table>

<h2><a name="OpenSUSE10.1">OpenSUSE 10.1</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-suse10.1-2.6.16.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse10.1-2.6.16.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-suse10.1-2.6.16.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.16.54-0.2.5-default_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="OpenSUSE10.2">OpenSUSE 10.2</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-suse10.2-2.6.18.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse10.2-2.6.18.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-suse10.2-2.6.18.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.18.8-0.10-default_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="OpenSUSE10.3">OpenSUSE 10.3</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-suse10.3-2.6.22.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse10.3-2.6.22.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-suse10.3-2.6.22.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.22.18-0.2-default_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="OpenSUSE11.0">OpenSUSE 11.0</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-suse11.0-2.6.25.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse11.0-2.6.25.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-suse11.0-2.6.25.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.25.5-1.1-default_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Asianux2">Asianux 2.0</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ax2-2.6.9.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ax2-2.6.9.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ax2-2.6.9.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i686 /tmp/kernel-2.6.9-42.22AX_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Asianux3">Asianux 3.0</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ax3-2.6.18.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ax3-2.6.18.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ax3-2.6.18.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i686 /tmp/kernel-2.6.18-8.16AX_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="Ubuntu6.06">Ubuntu 6.06</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ubuntu_6.06.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_6.06.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ubuntu_6.06.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu6.10">Ubuntu 6.10</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ubuntu_6.10.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_6.10.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ubuntu_6.10.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu7.04">Ubuntu 7.04</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ubuntu_7.04.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_7.04.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ubuntu_7.04.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu7.10">Ubuntu 7.10</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ubuntu_7.10.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_7.10.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ubuntu_7.10.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu8.04">Ubuntu 8.04</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-ubuntu_8.04.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_8.04.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-ubuntu_8.04.sh<br>
</td></tr>
</table>

<h2><a name="VineLinux4.2">VineLinux 4.2</a></h2>

<table border="1">
<tr><td>
# ビルドスクリプトをダウンロードする。<br>
wget -O build-vl4.2-2.6.16.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-vl4.2-2.6.16.sh?root=tomoyo'<br>
# ビルドスクリプトを実行する。<br>
sh build-vl4.2-2.6.16.sh<br>
# パッケージを作成する。<br>
rpmbuild -bb --target i586 /tmp/kernel-2.6.16-76.37vl4_tomoyo_1.6.2.spec
</td></tr>
</table>

<h2><a name="2.6-vanilla">バニラ 2.6 カーネル</a></h2>

<p>2.6.11 以降に対応しています。以下の手順では 2.6.25 を使用するものとします。</p>

<table border="1">
<tr><td>
# カーネルモジュールをインストールするディレクトリを作成する。<br>
mkdir -p /lib/modules/2.6.25-ccs<br>
# ソースディレクトリへ移動する。<br>
cd /usr/src/<br>
# カーネルのソースをダウンロードする。<br>
wget http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.25.tar.bz2<br>
# 展開する。<br>
tar -jxf linux-2.6.25.tar.bz2<br>
# 展開されたソースのディレクトリへ移動する。<br>
cd linux-2.6.25<br>
# ソースから world writable 属性を取り除く。<br>
find -print0 | xargs -0 chmod go-w --<br>
# TOMOYO Linux カーネルパッチをダウンロードする。<br>
wget http://osdn.dl.sourceforge.jp/tomoyo/30297/ccs-patch-1.6.2-20080625.tar.gz<br>
# 展開する。<br>
tar -zxf ccs-patch-1.6.2-20080625.tar.gz<br>
# カーネルパッチを適用する。<br>
wget -O patches/ccs-patch-2.6.25.diff 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/patches/ccs-patch-2.6.25.diff?root=tomoyo'<br>
patch -sp1 &lt; patches/ccs-patch-2.6.25.diff<br>
# TOMOYO Linux 用のオプションを選択する。<br>
make -s menuconfig<br>
# 通常通りコンパイルする。<br>
make -s<br>
make -s install modules modules_install
</td></tr>
</table>

<h2><a name="2.4-vanilla">バニラ 2.4 カーネル</a></h2>

<p>2.4.30 以降に対応しています。以下の手順では 2.4.36 を使用するものとします。</p>

<table border="1">
<tr><td>
# カーネルモジュールをインストールするディレクトリを作成する。<br>
mkdir -p /lib/modules/2.4.36-ccs<br>
# ソースディレクトリへ移動する。<br>
cd /usr/src/<br>
# カーネルのソースをダウンロードする。<br>
wget http://www.kernel.org/pub/linux/kernel/v2.4/linux-2.4.36.tar.bz2<br>
# 展開する。<br>
tar -jxf linux-2.4.36.tar.bz2<br>
# 展開されたソースのディレクトリへ移動する。<br>
cd linux-2.4.36<br>
# ソースから world writable 属性を取り除く。<br>
find -print0 | xargs -0 chmod go-w --<br>
# TOMOYO Linux カーネルパッチをダウンロードする。<br>
wget http://osdn.dl.sourceforge.jp/tomoyo/30297/ccs-patch-1.6.2-20080625.tar.gz<br>
# 展開する。<br>
tar -zxf ccs-patch-1.6.2-20080625.tar.gz<br>
# カーネルパッチを適用する。<br>
patch -sp1 &lt; patches/ccs-patch-2.4.36.diff<br>
# TOMOYO Linux 用のオプションを選択する。<br>
make -s menuconfig<br>
# 通常通りコンパイルする。<br>
make -s dep<br>
make -s<br>
make -s modules modules_install install
</td></tr>
</table>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</body>
</html>
