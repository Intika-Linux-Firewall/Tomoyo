<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>Policy Specifications of SYAORAN filesystem</title>
<link rel="stylesheet" href="http://tomoyo.sourceforge.jp/tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>Info: Version <a href="../1.6.x/">1.6.x</a> is available.</p>
<p style="text-align:right;"><a href="../../ja/1.5.x/policy-syaoran.html">Japanese Page</a></p>
<h1 style="text-align:center;">Policy Specifications of SYAORAN filesystem</h1>
<p style="text-align:right;">Last modified: $Date$</p>
<h2><a name="policy_syntax">1. Types and syntaxes of policy files</a></h2>
<h3><a name="pathname_style">Pathname representation rule</a></h3>
<p>SYAORAN uses canonicalized absolute pathnames ("Canonicalized Pathname") seen from kernel process that contain neither symbolic links nor "..".<br>
If a process is running under chroot'ed environment, pathnames are calculated from outside the chroot'ed directory.</p>
<p>Canonicalized directories always end with "/", and canonicalized files never end with "/".</p>
<p>Canonicalized Pathname contains only ASCII printable range (from 0x21 to 0x7E) characters.<br>
Thus, the space character (0x20) is represented as \040, \ character (0x5C) itself is represented as \\, and all other non-printable characters (from 0x01 to 0x20, from 0x7F to 0xFF) are represented using octal expressions(\ooo).<br>
Since spaces and carriage returns and tabs are treated as a delimiter, you need to convert octal representations to include these characters into Canonicalized Pathnames.</p>
<h3><a name="syntax">Policy specifications for SYAORAN filesystem</a></h3>
<p>The policy file contains a list of entries that the /dev directory has.<br>
There are many device files in the /dev directory, but only a few dozen files are needed for a system to work.<br>
Further, it is mandatory for system security that the device files are always associated with correct devices.<br>
For example, if /dev/null exists with major-8-0 (/dev/sda) attributes instead of char-1-3, the contents of the SCSI HDD will be destroyed at a blow.</p>
<p>The following is the format of this file.</p>
<p>List one entry per a line. An entry has maximum 9 elements.</p>
<table border="1">
<tr>
<td>filename</td>
<td>the name of the file seen from the mount point, without leading / .</td>
</tr>
<tr>
<td>permission</td>
<td>An octal form of permission value for the file, between 000 and 777.</td>
</tr>
<tr>
<td>owner</td>
<td>A decimal form of owner of the file.</td>
</tr>
<tr>
<td>group</td>
<td>A decimal form of group of the file.</td>
</tr>
<tr>
<td>flags</td>
<td>A combination of the following values.<br>
<ul>
<li>1: Allow creation of the file.</li>
<li>2: Allow deletion of the file.</li>
<li>4: Allow changing permissions of the file.</li>
<li>8: Allow changing owner or group of the file.</li>
<li>16: For internal use. Remembers whether this file is opened or not.</li>
<li>32: Don't create this file at mount time.</li>
</ul>
</td>
</tr>
<tr>
<td>type</td>
<td>The device type of the file, one of 'd' (directory), 'p' (FIFO), 's' (Socket), 'c' (Character device), 'b' (Block device), 'l' (Symbolic link), 'f' (regular file).</td>
</tr>
<tr>
<td>symlink_data</td>
<td>The content of the symbolic link that are automatically created when mounted. Not required if type is not 'l'.</td>
</tr>
<tr>
<td>major</td>
<td>A decimal form of major number. Not required if type is not 'c' nor 'b'.</td>
</tr>
<tr>
<td>minor</td>
<td>A decimal form of minor number. Not required if type is not 'c' nor 'b'.</td>
</tr>
</table>
<p>Lines are separated by '\n'.</p>
<p>The 'filename' must be canonicalized form, but the trailing / can be omitted for this policy file.</p>
<p>The 'symlink_data' needn't to be a Canonicalized Pathname, but you need to use \\ and \ooo style escapes to include non-printable characters.</p>
<p>How to use:</p>
<table border="1">
<tr>
<td>Step 1</td>
<td>Generate the policy file with 'flags' = 0.</td>
</tr>
<tr>
<td>Step 2</td>
<td>Mount the filesystem with accept mode. If this file is at /etc/ccs/syaoran.conf and you want to mount on /dev, run<br>
mount -t syaoran -o accept=/etc/ccs/syaoran.conf none /dev</td>
</tr>
<tr>
<td>Step 3</td>
<td>Run the system as usual, and you will get 'flags' value updated according to actual device file access.</td>
</tr>
<tr>
<td>Step 4</td>
<td>The result of file access tracing is readable via the file .syaoran which exists just under the mount point, and edit (removing unnecessary symbolic links etc.) and save as /etc/ccs/syaoran.conf<br>
The file access tracing functionality reflects to .syaoran only block and character device files that are actually opened, this functionality is available for removing unnecessary device files. Directories, FIFOs, sockets, symbolic links and regular files are always reflected to .syaoran regardless of they are actually opened or not.</td>
</tr>
<tr>
<td>Step 5</td>
<td>Unmount the filesystem.</td>
</tr>
<tr>
<td>Step 6</td>
<td>To mount the filesystem with enforce mode, run<br>
mount -t syaoran -o enforce=/etc/ccs/syaoran.conf none /dev<br>
In the enforce mode, 'flags' values are not updated.<br>
Whenever policy violation (caused by missing entry or insufficient flags) occurs, a message that begins with "SYAORAN-ERROR:" appears. You can pick up the messages by the following command.<br>
dmesg | grep ^SYAORAN-ERROR:</td>
</tr>
</table>
<p>You can tell the default mode for this filesystem by giving SYAORAN=accept or SYAORAN=enforce option to the kernel commandline. If you told the default mode to the command line, you can omit 'accept=' or 'enforce=' option at mount time.</p>
<hr>
<h2><a name="policy_example">2. An example of policy file</a></h2>
<p>The required files depend on your system.</p>
<table border="0">
<tr>
<td>#filename</td>
<td>permission</td>
<td>owner</td>
<td>group</td>
<td>flags</td>
<td>type</td>
<td colspan="2">[ symlink_data | major minor ]</td>
</tr>
<tr>
<td>pts</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>shm</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>fd</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd</td>
</tr>
<tr>
<td>stdin</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/0</td>
</tr>
<tr>
<td>stdout</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/1</td>
</tr>
<tr>
<td>stderr</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>l</td>
<td>/proc/self/fd/2</td>
</tr>
<tr>
<td>null</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>zero</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>random</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>urandom</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>1</td>
<td>9</td>
</tr>
<tr>
<td>tty</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>5</td>
<td>0</td>
</tr>
<tr>
<td>tty0</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>tty1</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>tty2</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>tty3</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>3</td>
</tr>
<tr>
<td>tty4</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>tty5</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>5</td>
</tr>
<tr>
<td>tty6</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>6</td>
</tr>
<tr>
<td>tty7</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>7</td>
</tr>
<tr>
<td>tty8</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>c</td>
<td>4</td>
<td>8</td>
</tr>
<tr>
<td>cdrom</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/dev/scd0</td>
</tr>
<tr>
<td>mouse</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>psaux</td>
</tr>
<tr>
<td>console</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>c</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>fd0</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>fd1</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>fd2</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>fd3</td>
<td>660</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>b</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>hda</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>hda1</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>hda2</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>hda3</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>hda5</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>hda6</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>6</td>
</tr>
<tr>
<td>hda7</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>7</td>
</tr>
<tr>
<td>hda8</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>8</td>
</tr>
<tr>
<td>hda9</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>9</td>
</tr>
<tr>
<td>hda10</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>10</td>
</tr>
<tr>
<td>hda11</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>11</td>
</tr>
<tr>
<td>hda12</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>3</td>
<td>12</td>
</tr>
<tr>
<td>initctl</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>p</td>
</tr>
<tr>
<td>log</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>15</td>
<td>s</td>
</tr>
<tr>
<td>rtc</td>
<td>644</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>135</td>
</tr>
<tr>
<td>ptmx</td>
<td>666</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>5</td>
<td>2</td>
</tr>
<tr>
<td>ram</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/dev/ram0</td>
</tr>
<tr>
<td>ram0</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>ram1</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>sda</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>8</td>
<td>0</td>
</tr>
<tr>
<td>initrd</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>1</td>
<td>b</td>
<td>1</td>
<td>250</td>
</tr>
<tr>
<td>psaux</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td>apm_bios</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>134</td>
</tr>
<tr>
<td>cpu</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>cpu/0</td>
<td>755</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>d</td>
</tr>
<tr>
<td>cpu/0/microcode</td>
<td>600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>c</td>
<td>10</td>
<td>184</td>
</tr>
<tr>
<td>ttyS0</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>64</td>
</tr>
<tr>
<td>ttyS1</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>65</td>
</tr>
<tr>
<td>ttyS2</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>66</td>
</tr>
<tr>
<td>ttyS3</td>
<td>660</td>
<td>0</td>
<td>14</td>
<td>0</td>
<td>c</td>
<td>4</td>
<td>67</td>
</tr>
<tr>
<td>ptal-printd</td>
<td>777</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>l</td>
<td>/var/run/ptal-printd</td>
</tr>
<tr>
<td>gpmctl</td>
<td>700</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>s</td>
</tr>
<tr>
<td>scd0</td>
<td>660</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>b</td>
<td>11</td>
<td>0</td>
</tr>
</table>
<hr>
<p><a href="index.html#manual">Return to index</a></p>
<hr>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</body>
</html>
