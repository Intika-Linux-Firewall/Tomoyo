<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linux kernel compilation</title>
<link rel="stylesheet" href="http://tomoyo.sourceforge.jp/tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>Info: Version <a href="../../1.7/">1.7.x</a> is available.</p>
<p style="text-align:right;"><a href="../../ja/1.6.x/compile.html">Japanese Page</a></p>
<h1>TOMOYO Linux kernel compilation</h1>
<p style="text-align:right;">Last modified: $Date$</p>

<p>To compile kernel, the following packages are needed.</p>

<ul>
<li>gcc</li>
<li>make</li>
<li>ncurses</li>
</ul>

<p>Run "make menuconfig" and choose the following options in "File systems" section.</p>

<ul>
<li>[*] SAKURA (Domain-Free Mandatory Access Control) support
<li>[*] TOMOYO (Domain-Based Mandatory Access Control) support
<li>(2048) Default maximal count for learning mode
<li>(/sbin/modprobe /sbin/hotplug) Built-in domain initializer programs
<li>[*]&nbsp;&nbsp;&nbsp;Auditing interface support
<li>(1024)&nbsp;&nbsp;Default maximal count for grant log
<li>(1024)&nbsp;&nbsp;Default maximal count for reject log
<li>&lt;m&gt; SYAORAN (Tamper-Proof Device Filesystem) support
</ul>

<p>The 2.6 kernels have a compilation option named CONFIG_DEBUG_INFO. If this option is enabled, the compiled code's size becomes about 10 times larger. Enabling this option consumes about 1 GB of extra disk space for /usr/src/ directory and about 300 MB of extra disk space for /lib/modules/ directory.<br>
To save disk space, disable the following option.</p>

<table border="1">
<tr><td>
Kernel hacking ---&gt;[&nbsp;] &nbsp;&nbsp;Compile the kernel with debug info
</td></tr>
</table>

<p>Choose the version you want to use from the following list.</p>

<ul>
<li><a href="#Fedora11">Fedora 11</a>
<li><a href="#CentOS3.9">CentOS 3.9</a>
<li><a href="#CentOS4.9">CentOS 4.9</a>
<li><a href="#CentOS5.6">CentOS 5.6</a>
<li><a href="#Etch">Debian Etch</a>
<li><a href="#Lenny">Debian Lenny</a>
<li><a href="#OpenSUSE11.0">OpenSUSE 11.0</a>
<li><a href="#OpenSUSE11.1">OpenSUSE 11.1</a>
<li><a href="#Asianux2">Asianux 2.0</a>
<li><a href="#Asianux3">Asianux 3.0</a>
<li><a href="#Ubuntu6.06">Ubuntu 6.06</a>
<li><a href="#Ubuntu8.04">Ubuntu 8.04</a>
<li><a href="#Ubuntu8.10">Ubuntu 8.10</a>
<li><a href="#Ubuntu9.04">Ubuntu 9.04</a>
<li><a href="#VineLinux4.2">VineLinux 4.2</a>
<li><a href="#VineLinux5.2">VineLinux 5.2</a>
<li><a href="#Gentoo">Gentoo</a>
<li><a href="#2.6-vanilla">Vanilla 2.6 kernels</a>
<li><a href="#2.4-vanilla">Vanilla 2.4 kernels</a>
</ul>

<hr>

<h2><a name="Fedora11">Fedora 11</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-f11-2.6.30.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-f11-2.6.30.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-f11-2.6.30.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /root/rpmbuild/SPECS/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="CentOS3.9">CentOS 3.9</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-c3-2.4.21.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-c3-2.4.21.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-c3-2.4.21.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="CentOS4.9">CentOS 4.9</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-c4-2.6.9.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-c4-2.6.9.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-c4-2.6.9.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="CentOS5.6">CentOS 5.6</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-c5-2.6.18.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-c5-2.6.18.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-c5-2.6.18.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i686 --without kabichk /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="Etch">Debian Etch</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-debian_etch.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_etch.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-debian_etch.sh<br>
</td></tr>
</table>

<h2><a name="Lenny">Debian Lenny</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-debian_lenny.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-debian_lenny.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-debian_lenny.sh<br>
</td></tr>
</table>

<h2><a name="OpenSUSE11.0">OpenSUSE 11.0</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-suse11.0-2.6.25.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse11.0-2.6.25.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-suse11.0-2.6.25.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="OpenSUSE11.1">OpenSUSE 11.1</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-suse11.1-2.6.27.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-suse11.1-2.6.27.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-suse11.1-2.6.27.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="Asianux2">Asianux 2.0</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ax2-2.6.9.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ax2-2.6.9.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ax2-2.6.9.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i686 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="Asianux3">Asianux 3.0</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ax3-2.6.18.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ax3-2.6.18.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ax3-2.6.18.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i686 --without kabichk /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="Ubuntu6.06">Ubuntu 6.06</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ubuntu_6.06.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_6.06.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ubuntu_6.06.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu8.04">Ubuntu 8.04</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ubuntu_8.04.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_8.04.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ubuntu_8.04.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu8.10">Ubuntu 8.10</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ubuntu_8.10.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_8.10.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ubuntu_8.10.sh<br>
</td></tr>
</table>

<h2><a name="Ubuntu9.04">Ubuntu 9.04</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-ubuntu_9.04.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-ubuntu_9.04.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-ubuntu_9.04.sh<br>
</td></tr>
</table>

<h2><a name="VineLinux4.2">VineLinux 4.2</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-vl4.2-2.6.16.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-vl4.2-2.6.16.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-vl4.2-2.6.16.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="VineLinux5.2">VineLinux 5.2</a></h2>

<table border="1">
<tr><td>
# Download build script.<br>
wget -O build-vl5.2-2.6.27.sh 'http://svn.sourceforge.jp/cgi-bin/viewcvs.cgi/*checkout*/trunk/1.6.x/ccs-patch/specs/build-vl5.2-2.6.27.sh?root=tomoyo'<br>
# Run build script.<br>
sh build-vl5.2-2.6.27.sh<br>
# Start compilation.<br>
rpmbuild -bb --target i586 /tmp/ccs-kernel.spec
</td></tr>
</table>

<h2><a name="Gentoo">Gentoo</a></h2>

<table border="1">
<tr><td>
# Install layman package.<br>
emerge layman<br>
# Install subversion package.<br>
emerge subversion<br>
# Add sunrise repository.<br>
layman -f -a sunrise<br>
# Configure /etc/make.conf to include layman's make.conf .<br>
echo "source /usr/local/portage/layman/make.conf" &gt;&gt; /etc/make.conf<br>
# Download kernel source.<br>
emerge ccs-sources<br>
# Run genkernel to build.<br>
genkernel --menuconfig all<br>
# Configure grub . See http://www.gentoo.org/doc/en/kernel-upgrade.xml for detail.<br>
</td></tr>
</table>

<h2><a name="2.6-vanilla">Vanilla 2.6 kernels</a></h2>

<p>2.6.11 and later are supported. The following is the case of version 2.6.31.14 .</p>

<table border="1">
<tr><td>
# Move to the source directory.<br>
cd /usr/src/<br>
# Download kernel source.<br>
wget http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.31.14.tar.bz2<br>
# Extract.<br>
tar -jxf linux-2.6.31.14.tar.bz2<br>
# Move to the extracted directory.<br>
cd linux-2.6.31.14<br>
# Remove world writable permissions from the source code.<br>
find -print0 | xargs -0 chmod go-w --<br>
# Download TOMOYO Linux's kernel patch.<br>
wget -O ccs-patch-1.7.3-20110903.tar.gz 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/30297/ccs-patch-1.7.3-20110903.tar.gz'<br>
# Check signature.<br>
wget -O ccs-patch-1.7.3-20110903.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/30297/ccs-patch-1.7.3-20110903.tar.gz.asc'<br>
gpg ccs-patch-1.7.3-20110903.tar.gz.asc<br>
# Extract.<br>
tar -zxf ccs-patch-1.7.3-20110903.tar.gz<br>
# Apply the kernel patch.<br>
patch -sp1 &lt; patches/ccs-patch-2.6.31.diff<br>
# Enable options for TOMOYO Linux.<br>
make -s menuconfig<br>
# Compile as usual.<br>
make -s<br>
make -s modules modules_install install
</td></tr>
</table>

<h2><a name="2.4-vanilla">Vanilla 2.4 kernels</a></h2>

<p>2.4.30 and later are supported. The following is the case of version 2.4.37.11 .</p>

<table border="1">
<tr><td>
# Move to the source directory.<br>
cd /usr/src/<br>
# Download kernel source.<br>
wget http://www.kernel.org/pub/linux/kernel/v2.4/linux-2.4.37.11.tar.bz2<br>
# Extract.<br>
tar -jxf linux-2.4.37.11.tar.bz2<br>
# Move to the extracted directory.<br>
cd linux-2.4.37.11<br>
# Remove world writable permissions from the source code.<br>
find -print0 | xargs -0 chmod go-w --<br>
# Download TOMOYO Linux's kernel patch.<br>
wget -O ccs-patch-1.7.3-20110903.tar.gz 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/30297/ccs-patch-1.7.3-20110903.tar.gz'<br>
# Check signature.<br>
wget -O ccs-patch-1.7.3-20110903.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/30297/ccs-patch-1.7.3-20110903.tar.gz.asc'<br>
gpg ccs-patch-1.7.3-20110903.tar.gz.asc<br>
# Extract.<br>
tar -zxf ccs-patch-1.7.3-20110903.tar.gz<br>
# Apply the kernel patch.<br>
patch -sp1 &lt; patches/ccs-patch-2.4.37.diff<br>
# Enable options for TOMOYO Linux.<br>
make -s menuconfig<br>
# Compile as usual.<br>
make -s dep<br>
make -s<br>
make -s modules modules_install install
</td></tr>
</table>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="sflogo.php" title="SourceForge.jp"></a></p>
</body>
</html>
