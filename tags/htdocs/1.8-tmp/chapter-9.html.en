<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="content-style-type" content="text/css">
<link rel="stylesheet" href="../media/tomoyolinux.css" media="all" type="text/css">
<title>TOMOYO Linux 1.8.x : The Official Guide : Chapter 9</title>
</head>

<body>

<div id="titlebar">
<a href="../index.html.en"><img src="../media/tomoyotitle.png" alt="tomoyotitle.png" width="320" height="40" border="0" align="left"></a>
</div>

<div id="navbar" class="tomoyo-documentation">
<ul id="navbarlist">
<li id="tomoyo-home"><a href="../index.html.en" title="TOMOYO Linux Home Page">Home</a></li>
<li id="tomoyo-about"><a href="../about.html.en" title="About TOMOYO Linux">About</a></li>
<li id="tomoyo-download"><a href="../download.html.en" title="Get TOMOYO Linux">Download</a></li>
<li id="tomoyo-changelogs"><a href="../changelogs.html.en" title="TOMOYO Linux ChangeLogs">ChangeLogs</a></li>
<li id="tomoyo-documentation"><a href="../documentation.html.en" title="Official Documentation">Documentation</a></li>
<li id="tomoyo-support"><a href="../support.html.en" title="Support information">Support</a></li>
<li id="tomoyo-links"><a href="../links.html.en" title="Links">Links</a></li>
</ul>
<ul id="switch-language">
<li id="tomoyo-switch-language"><a href="index.html.ja" title="Go to Japanese page">Japanese page</a></li>
</ul>
</div>

<div id="content">

<div id="documentation">

<p><a href="chapter-7.html.en">&lt;Prev&gt;</a> <a href="index.html.en">&lt;Index&gt;</a> <a href="chapter-9.html.en">&lt;Next&gt;</a></p>

<h2>Chapter 9: Using conditional parameters in policy</h2>

<h3><a name="9.1">9.1. Conditional parameters</a></h3>

<p>Conditions can be used to refine policy and make entries more specific. This is useful for taking into account the user ID of a process when deciding what to allow or reject. This table summarizes the possible conditional parameters:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Conditional</p></th>
<th><p>Meaning</p></th>
</tr>
<tr>
<td><p>task.type</p></td>
<td><p>Task type of the current process (e.g. execute_handler or not)</p></td>
</tr>
<tr>
<td><p>task.uid</p></td>
<td><p>UID of the current process</p></td>
</tr>
<tr>
<td><p>task.euid</p></td>
<td><p>Effective UID of the current process</p></td>
</tr>
<tr>
<td><p>task.suid</p></td>
<td><p>Saved UID of the current process</p></td>
</tr>
<tr>
<td><p>task.fsuid</p></td>
<td><p>Filesystem UID of the current process</p></td>
</tr>
<tr>
<td><p>task.gid</p></td>
<td><p>GID of the current process</p></td>
</tr>
<tr>
<td><p>task.egid</p></td>
<td><p>Effective GID of the current process</p></td>
</tr>
<tr>
<td><p>task.sgid</p></td>
<td><p>Saved GID of the current process</p></td>
</tr>
<tr>
<td><p>task.fsgid</p></td>
<td><p>Filesystem GID of the current process</p></td>
</tr>
<tr>
<td><p>task.pid</p></td>
<td><p>PID of the current process</p></td>
</tr>
<tr>
<td><p>task.ppid</p></td>
<td><p>PID of the parent process</p></td>
</tr>
<tr>
<td><p>path1.type</p></td>
<td><p>Type of the first object (e.g. file, directory, socket)</p></td>
</tr>
<tr>
<td><p>path1.uid</p></td>
<td><p>UID of the first object</p></td>
</tr>
<tr>
<td><p>path1.gid</p></td>
<td><p>GID of the first object</p></td>
</tr>
<tr>
<td><p>path1.ino</p></td>
<td><p>Inode number of the first object</p></td>
</tr>
<tr>
<td><p>path1.perm</p></td>
<td><p>Permissions of the first object</p></td>
</tr>
<tr>
<td><p>path1.major</p></td>
<td><p>Major device number of the device file in which the first object resides</p></td>
</tr>
<tr>
<td><p>path1.minor</p></td>
<td><p>Minor device number of the device file in which the first object resides</p></td>
</tr>
<tr>
<td><p>path1.dev_major</p></td>
<td><p>Major device number of the first object, assuming it is a device file</p></td>
</tr>
<tr>
<td><p>path1.dev_minor</p></td>
<td><p>Device minor number of the first object, assuming it is a device file</p></td>
</tr>
<tr>
<td><p>path1.parent.uid</p></td>
<td><p>UID of the parent directory of the first object</p></td>
</tr>
<tr>
<td><p>path1.parent.gid</p></td>
<td><p>GID of the parent directory of the first object</p></td>
</tr>
<tr>
<td><p>path1.parent.ino</p></td>
<td><p>Inode number of the parent directory of the first object</p></td>
</tr>
<tr>
<td><p>path1.parent.perm</p></td>
<td><p>Permissions of the parent directory of the first object</p></td>
</tr>
<tr>
<td><p>path2.type</p></td>
<td><p>Type of the second object (e.g. file, directory, socket)</p></td>
</tr>
<tr>
<td><p>path2.uid</p></td>
<td><p>UID of the second object</p></td>
</tr>
<tr>
<td><p>path2.gid</p></td>
<td><p>GID of the second object</p></td>
</tr>
<tr>
<td><p>path2.ino</p></td>
<td><p>Inode number of the second object</p></td>
</tr>
<tr>
<td><p>path2.perm</p></td>
<td><p>Permissions of the second object</p></td>
</tr>
<tr>
<td><p>path2.major</p></td>
<td><p>Major device number of the device file in which the second object resides</p></td>
</tr>
<tr>
<td><p>path2.minor</p></td>
<td><p>Minor device number of the device file in which the second object resides</p></td>
</tr>
<tr>
<td><p>path2.dev_major</p></td>
<td><p>Major device number of the second object, assuming it is a device file</p></td>
</tr>
<tr>
<td><p>path2.dev_minor</p></td>
<td><p>Minor device number of the second object, assuming it is a device file</p></td>
</tr>
<tr>
<td><p>path2.parent.uid</p></td>
<td><p>UID of the parent directory of the second object</p></td>
</tr>
<tr>
<td><p>path2.parent.gid</p></td>
<td><p>GID of the parent directory of the second object</p></td>
</tr>
<tr>
<td><p>path2.parent.ino</p></td>
<td><p>Inode number of the parent directory of the second object</p></td>
</tr>
<tr>
<td><p>path2.parent.perm</p></td>
<td><p>Permissions of the parent directory of the second object</p></td>
</tr>
<tr>
<td><p>exec.argc</p></td>
<td><p>Number of argv[] passed for the execute request</p></td>
</tr>
<tr>
<td><p>exec.envc</p></td>
<td><p>Number of envp[] passed for the execute request</p></td>
</tr>
<tr>
<td><p>exec.argv[n]</p></td>
<td><p>Argument number "n" for the execute request</p></td>
</tr>
<tr>
<td><p>exec.envp[var]</p></td>
<td><p>Value of environment variable "var" for the execute request</p></td>
</tr>
<tr>
<td><p>exec.realpath</p></td>
<td><p>Dereferenced pathname of the requested program</p></td>
</tr>
<tr>
<td><p>symlink.target</p></td>
<td><p>Content of a symlink to be created</p></td>
</tr>
</table>
</div>

<p>Matches may be made using the following tests:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Test</p></th>
<th><p>Meaning</p></th>
<th><p>Example</p></th>
</tr>
<tr>
<td><p>=</p></td>
<td><p>Positive match</p></td>
<td><p>task.uid=0</p></td>
</tr>
<tr>
<td><p>!=</p></td>
<td><p>Negative match</p></td>
<td><p>task.gid!=0</p></td>
</tr>
</table>
</div>

<p>The value to be tested may take the form of a single integer, a range of integers, or another conditional (the exceptions are "exec.argv[n]", "exec.envp[var]", "exec.realpath" and "symlink.target" which take string values):</p>

<div class="simple-table">
<table>
<tr>
<th><p>Value</p></th>
<th><p>Example</p></th>
</tr>
<tr>
<td><p>Integer</p></td>
<td><p>task.uid=0</p></td>
</tr>
<tr>
<td><p>Range</p></td>
<td><p>task.uid=100-500</p></td>
</tr>
<tr>
<td><p>Conditional</p></td>
<td><p>task.uid=path1.uid</p></td>
</tr>
</table>
</div>

<h3><a name="9.2">9.2. Example usage</a></h3>

<p>If you wish to deny login as the root user from a specific domain (e.g. "&lt;kernel&gt; /sbin/agetty /bin/login"), the following could be inserted into domain policy:</p>

<pre>
file execute /bin/bash task.uid!=0
</pre>

<p>If you wish to allow login for a range of user ID's from a specific domain (e.g. "&lt;kernel&gt; /sbin/agetty /bin/login"), the following could be inserted into domain policy:</p>

<pre>
file execute /bin/bash task.uid=500-1000
</pre>

<p>If you wish to allow a domain to read a temporary file only if they own it, the following could be inserted into domain policy:</p>

<pre>
file read /tmp/file001.tmp task.uid=path1.uid
</pre>

<p>If you wish to allow the execution of a program only when certain conditions are met, the following could be inserted into domain policy:</p>

<pre>
file execute /usr/bin/ssh exec.realpath="/usr/bin/ssh" exec.argv[0]="ssh"
file execute /usr/bin/firefox exec.realpath="/usr/lib/firefox-3.6/firefox" exec.argv[0]="/usr/bin/firefox" exec.envc=0
</pre>

</div><!-- documentation -->

</div><!-- content -->

<div id="navfooter">
<hr>
<table>
<tr>
<td class="docs-previous">
<a href="chapter-8.html.en">Prev</a>
</td>
<td class="docs-index">
<a href="index.html.en">Index</a>
</td>
<td class="docs-next">
<a href="chapter-10.html.en">Next</a>
</td>
</tr>
<tr>
<td class="docs-previous-description">
<p>Chapter 8: Advanced profile management</p>
</td>
<td class="docs-home">
</td>
<td class="docs-next-description">
<p>Chapter 10: Stuff</p>
</td>
</tr>
</table>
</div>

<div id="footer">
<p class="language">Go to <a href="index.html.ja">Japanese page</a>.</p>
<p class="timestamp">Last modified: $Date$</p>
<p class="trademark">Linux&reg; is a registered trademark of Linus Torvalds world-wide. TOMOYO&reg; is a registered trademark of <a href="http://www.nttdata.co.jp/en/">NTT DATA Corporation</a>.</p>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</div>

</body>
</html>
