<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linux Install manual</title>
<link rel="stylesheet" href="http://tomoyo.sourceforge.jp/tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>This page is for TOMOYO 2.3 (for Linux 2.6.36 and later kernels). Please jump to <a href="../2.2/">this page</a> for TOMOYO 2.2 (for Linux 2.6.30 - 2.6.35 kernels).</p>
<p style="text-align:right;"><a href="phase-1.html.ja">Japanese Page</a></p>
<p style="text-align:right;">Last modified: $Date$</p>
<h1>Phase 1: Installation and initialization</h1>

<p style="text-align:center;">Aim: to install the TOMOYO Linux kernel and userland tools and prepare the system for analysis and/or restriction.</p>

<hr>

<h2><a name="1.1">Step 1.1: Install dependencies</a></h2>

<p>These packages are required for compiling the kernel and the userspace tools:</p>
<ul>
<li><b>wget</b>: to download tools source package</li>
<li><b>gcc</b>: to build the kernel and tools</li>
<li><b>make</b>: to build the kernel and tools</li>
<li><b>ncurses</b>: for the tools user interface</li>
<li><b>patch</b>: to apply bugfix patches</li>
</ul>

<p>These can be installed with the following commands:</p>

<table border="1">
<tr><td>RedHat distributions</td><td>
[root@tomoyo ~]# yum -y install wget gcc make ncurses-devel patch
</td></tr>
<tr><td>Debian distributions</td><td>
[root@tomoyo ~]# apt-get -y install wget gcc make libncurses-dev patch
</td></tr>
<tr><td>SUSE distributions</td><td>
[root@tomoyo ~]# yast -i wget gcc make ncurses-devel patch
</td></tr>
</table>

<br>

<hr>

<h2><a name="1.2">Step 1.2: Install the kernel</a></h2>

<h3>Determine if your kernel has TOMOYO Linux enabled</h3>

<p>TOMOYO Linux 2.3.x is integrated with the upstream kernel source, but is only enabled when certain kernel configuration options are set. You can determine if your kernel has TOMOYO Linux enabled by running the following command:</p>

<table border="1">
<tr><td>
[root@tomoyo ~]$ grep tomoyo_supervisor /proc/kallsyms
</td></tr>
</table>

<p>If you found a line containing tomoyo_supervisor in "/proc/kallsyms", proceed to <a href="#1.3">Step 1.3: Install the userspace tools</a> because your kernel was built with TOMOYO Linux. If not, please follow below steps because your kernel was not built with TOMOYO Linux.</p>

<h3>Download the kernel</h3>

<p>Download the kernel source from "<a href="http://www.kernel.org/pub/linux/kernel/v2.6/">linux-2.6</a>" or "<a href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=summary">linux-2.6 git tree</a>".<br>
Linux kernel 2.6.36 and later are supported.</p>

<p>Extract the kernel source and go to the extracted directory.</p>

<p>There may be bugfixes that are too late to get merged in the upstream kernel releases. Download all patches that match your kernel version (e.g. 2.6.38-tomoyo-\*.patch for 2.6.38 kernels) from <a href="http://tomoyo.sourceforge.jp/2.3/patches/">http://tomoyo.sourceforge.jp/2.3/patches/</a> and run below command from the kernel's top directory. (Below command will skip already applied patch if any.)</p>

<table border="1">
<tr><td>
[user@tomoyo ~]$ for i in 2.6.*-tomoyo-*.patch; do patch -Nt -p1 --dry-run &lt; $i &amp;&amp; patch -p1 &lt; $i; done
</td></tr>
</table>

<h3>Configure the kernel</h3>

<table border="1">
<tr><td>
[user@tomoyo ~]$ make -s menuconfig
</td></tr>
</table>

<p>Choose the following options in the "Security options" section (although <i>"Default security module"</i> is optional):</p>

<pre>
[*] Enable different security models
-*- Enable the securityfs filesystem
-*- Security hooks for pathname based access control
[*] TOMOYO Linux Support
    Default security module (TOMOYO)
</pre>

<h3>Compile and install the kernel</h3>

<p>Once the kernel has been configured, compile and install:</p>

<table border="1">
<tr><td>
[user@tomoyo ~]$ make -s<br>
[user@tomoyo ~]$ su<br>
[root@tomoyo ~]# make -s modules_install install
</td></tr>
</table>

<p>Create initrd/initramfs if required.</p>

<hr>

<h2><a name="1.3">Step 1.3: Install the userspace tools</a></h2>

<p>Make sure the dependencies described above have been installed. Compile and install the tools with the following commands:</p>

<table border="1">
<tr><td>
[root@tomoyo ~]# wget -O tomoyo-tools-2.3.0-20110511.tar.gz 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/48663/tomoyo-tools-2.3.0-20110511.tar.gz'<br>
[root@tomoyo ~]# wget -O tomoyo-tools-2.3.0-20110511.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/48663/tomoyo-tools-2.3.0-20110511.tar.gz.asc'<br>
[root@tomoyo ~]# wget http://I-love.SAKURA.ne.jp/kumaneko-key<br>
[root@tomoyo ~]# gpg --import kumaneko-key<br>
[root@tomoyo ~]# gpg tomoyo-tools-2.3.0-20110511.tar.gz.asc<br>
[root@tomoyo ~]# tar -zxf tomoyo-tools-2.3.0-20110511.tar.gz<br>
[root@tomoyo ~]# make -C tomoyo-tools/ install<br>
[root@tomoyo ~]# ldconfig
</td></tr>
</table>

<br>

<hr>

<h2><a name="1.4">Step 1.4: Initialize configuration</a></h2>

<p>To prepare the system for usage of TOMOYO Linux, the policy must be initialized. Run the following command:</p>

<table border="1">
<tr><td>
[root@tomoyo ~]# /usr/lib/tomoyo/init_policy
</td></tr>
</table>

<p>All policy files will be saved in "/etc/tomoyo/" directory.</p>

<p>Note that the policy configuration is not compatible between TOMOYO 2.2 and TOMOYO 2.3. If policy has been developed for TOMOYO 2.2 then the "/etc/tomoyo" directory needs to be deleted or renamed, otherwise there will be a kernel panic on the next boot.</p>

<hr>

<h2><a name="1.5">Step 1.5: Configure bootloader and reboot</a></h2>

<p>Now edit your bootloader (e.g. GRUB) to include the kernel you have just compiled. If your kernel config does not contain "CONFIG_DEFAULT_SECURITY_TOMOYO=y", then edit your bootloader to include "security=tomoyo" in the kernel boot options. Depending on your distribution, the bootloader configuration file will probably be one of "/boot/grub/grub.conf" or "/boot/grub/menu.lst" (for GRUB version 1) or "/boot/grub/grub.cfg" (for GRUB version 2). Consult your distribution documentation for information on how to configure the bootloader.</p>

<p>Now reboot your system and select this kernel for use in Phase 2.</p>

<br>

<div class=navfooter>
<hr align="left" width="100%">
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="33%" align="left" valign="top">
</td>
<td width="34%" align="center" valign="top">
<a href="index.html.en">Index</a>
</td>
<td width="33%" align="right" valign="top">
<a href="phase-2.html.en">Next</a>
</td></tr>
<tr><td width="33%" align="left" valign="top">
</td>
<td width="34%" align="center" valign="top">
<a href="http://tomoyo.sourceforge.jp/">Home</a>
</td>
<td width="33%" align="right" valign="top">
Phase 2: Understanding TOMOYO Linux
</td>
</tr>
</table>
</div>

<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="sflogo.php" title="SourceForge.jp"></a></p>
</body>
</html>
