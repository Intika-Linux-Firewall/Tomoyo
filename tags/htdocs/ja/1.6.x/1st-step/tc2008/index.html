<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linux 導入手順書 （Turbolinux Client 2008版）</title>
<link rel="stylesheet" href="http://tomoyo.osdn.jp/tomoyo.css" media="all" type="text/css">
</head>
<body>

<h1><a href="http://tomoyo.osdn.jp/">TOMOYO Linux</a> 導入手順書 （Turbolinux Client 2008版）</h1>

<ul>
<li><a href="#l1">このページについて</a></li>
<li><a href="#l2">TOMOYO Linux 用ツールのインストール</a></li>
<li><a href="#l3">ポリシーの初期設定</a>
<li><a href="#l4">学習モードへの切り替え</a></li>
<li><a href="#l5">学習結果の確認</a></li>
<li><a href="#l6">強制モードへの切り替え</a></li>
<li><a href="#l7">情報源</a></li>
</ul>


<h2><a name="l1">このページについて</a></h2>

<p>以下では、 Turbolinux Client 2008 で TOMOYO Linux 1.6.3 を利用する手順を解説します。
この手順書に従って操作すれば、 TOMOYO Linux の基本的な機能を体験し、簡単な設定と運用が行えるようになります。</p>

<h2><a name="l2">TOMOYO Linux 用ツールのインストール</a></h2>

<p>最初に、 TOMOYO Linux 用のツールをインストールする必要があります。 TOMOYO Linux 用のツールには、 TOMOYO Linux のポリシーを管理するためのプログラムが含まれています。</p>

<p>管理者用のコンソールから、 ccs-tools パッケージをダウンロードしてインストールしてください。<br>
管理者用のコンソールを開くには、「START」→「システム」→「その他のアプリケーション」→「コンソール（管理者モード）」の順番にメニューを選択してください。</p>

<p><img alt="Opening console as root user" title="Opening console as root user" width="800" height="600" src="rootconsole.png"></p>

<p>以下のファイルをダウンロードしてインストールしてください。</p>

<pre>
# <span class="user">wget http://ftp.turbolinux.co.jp/pub/TurboLinux/TurboLinux/ia32/Client/12/misc/ccs-tools-1.6.8-1.i586.rpm</span>
# <span class="user">rpm -ivh ccs-tools-1.6.8-1.i586.rpm</span>
</pre>

<h2><a name="l3">ポリシーの初期設定</a></h2>

<p>この章で説明している内容を設定するためのスクリプトが付属しているので、管理者用のコンソールから以下のように実行してください。</p>

<pre># <span class="user">/usr/lib/ccs/init_policy.sh --file-only-profile</span></pre>

<p>init_policy.sh の実行にはしばらく時間が掛かります。環境によっては１０分以上を要する場合もあります。</p>

<p>以上で準備完了です。システムを再起動してください。</p>

<pre># <span class="user">reboot</span></pre>

<h3>設定の保存ディレクトリについて</h3>

<p>TOMOYO Linuxの設定を保存するディレクトリは /etc/ccs/ です。</p>

<h3>プロファイルについて</h3>

<p>TOMOYO Linux には多くの機能があり、どの機能を有効／無効にするのかの設定をプロファイルと呼びます。プロファイルは複数作成して切り替えて使うことができます。すべてのプロファイルは /etc/ccs/profile.conf という単一のファイルに保存します。</p>

<p>今回はファイルに対するアクセス制御の機能のみを利用するため、 /etc/ccs/profile.conf の内容は以下のようなっているはずです。</p>

<pre>
0-COMMENT=-----Disabled Mode-----
0-MAC_FOR_FILE=disabled
0-TOMOYO_VERBOSE=disabled
1-COMMENT=-----Learning Mode-----
1-MAC_FOR_FILE=learning
1-TOMOYO_VERBOSE=disabled
2-COMMENT=-----Permissive Mode-----
2-MAC_FOF_FILE=permissive
2-TOMOYO_VERBOSE=enabled
3-COMMENT=-----Enforcing Mode-----
3-MAC_FOR_FILE=enforcing
3-TOMOYO_VERBOSE=enabled
</pre>

<p>/etc/ccs/profile.conf の構文を以下に示します。</p>

<pre>
（プロファイル番号）-（設定項目）=（制御モード）
</pre>

<p>先頭の番号がプロファイル番号で、続いて設定項目、最後が制御モードです。</p>

<p>設定項目 COMMENT は、プロファイルを区別しやすくするためのコメントで、 TOMOYO Linux の機能には影響を与えません。</p>

<p>設定項目 MAC_FOR_FILE は「ファイルに対するアクセス制御」を表しており、制御モードが disabled なら無効、 learning なら学習、 permissive なら確認、 enforcing なら強制、となります。</p>

<p>設定項目 TOMOYO_VERBOSE は「ポリシー違反の情報をコンソールに出力するかどうか」を表しており、制御モードが disabled なら出力しない、 enabled なら出力するようになります。</p>

<p>上記設定では、プロファイル番号が 0 ～ 3 の 4 つのプロファイルを作成しており、それぞれの意味は以下のようになります。</p>

<table><tbody>
<tr><th>プロファイル 0</th><td>ファイルに対するアクセス制御を無効にする／コンソールにポリシー違反を出力しない</td></tr>
<tr><th>プロファイル 1</th><td>ファイルに対するアクセス制御を学習モードにする／コンソールにポリシー違反を出力しない</td></tr>
<tr><th>プロファイル 2</th><td>ファイルに対するアクセス制御を確認モードにする／コンソールにポリシー違反を出力する</td></tr>
<tr><th>プロファイル 3</th><td>ファイルに対するアクセス制御を強制モードにする／コンソールにポリシー違反を出力する</td></tr>
</tbody></table>

<p>学習モード（プロファイル 1 ）で行ったアクセスを元にポリシーを作成し、
確認モード（プロファイル 2 ）で仮運用して必要なポリシーが作成できているかを確かめ、
強制モード（プロファイル 3 ）で本運用としてアクセス制御を行う、
というのが基本的な運用の流れです。</p>

<h3>ポリシーの変更を許可するプログラムについて</h3>

<p>ポリシーを変更することができるプログラムを、 /etc/ccs/manager.conf というファイルで指定します。以下のプログラムが指定されているはずです。</p>

<pre>
/usr/lib/ccs/loadpolicy
/usr/lib/ccs/editpolicy
/usr/lib/ccs/setlevel
/usr/lib/ccs/setprofile
/usr/lib/ccs/ld-watch
/usr/lib/ccs/ccs-queryd
</pre>

<h3>例外ポリシーについて</h3>

<p>/etc/ccs/exception_policy.conf には以下の 12 種類の例外が指定されています。</p>

<ol>
<li>パス名のパターン</li>
<li>パス名のグループ</li>
<li>アドレスのグループ</li>
<li>無条件に参照を許可するファイル</li>
<li>無条件に利用を許可する環境変数</li>
<li>内容を上書きすることを禁止するファイル</li>
<li>シンボリックリンク経由で実行できるプログラム</li>
<li>類似するプログラムの集約</li>
<li>ドメイン遷移を初期化させるプログラム</li>
<li>ドメイン遷移の初期化を抑制させるプログラム</li>
<li>ドメイン遷移を抑制させるプログラム</li>
<li>ドメイン遷移を再開させるプログラム</li>
</ol>

<h3>監査ログについて</h3>

<p>TOMOYO Linux には、「アクセス許可ログ」（ドメイン用ポリシーに違反しなかったアクセス要求のログ）と「アクセス拒否ログ」（ドメイン用ポリシーに違反したアクセス要求のログ）の２種類のログが存在します。 ccs-tools パッケージをインストールすることにより、自動的に「アクセス拒否ログ」だけを保存するように構成されます。</p>

<h2><a name="l4">学習モードへの切り替え</a></h2>

<p>管理者用のコンソールから TOMOYO Linux のポリシーエディタを実行してください。</p>

<pre># <span class="user">/usr/sbin/ccs-editpolicy</span></pre>

<p>以下のような画面が表示されるはずです。なお、表示される domains の数は環境により異なります。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-1.png"></p>

<p>例えば、この画面の中から現在実行中のエディタを探してみましょう。「f」キーを押してから「ccs-editpolicy」と入力し、最後に「Enter」キーを押してください。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-2.png"></p>

<p>/usr/sbin/ccs-editpolicy というパス名を含んだ行を見つけることができるはずです。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-3.png"></p>

<p>矢印キーを使ってスクロールすることができます。カーソルを /usr/bin/kdeinit と /bin/su の間にある /bin/bash の行（この画像では７８行目）に移動させてください。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-4.png"></p>

<p>「Space」キーを押してください。すると、カーソルのある行の先頭に「&amp;」というマークが表示されるはずです。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-5.png"></p>

<p>「s」キーを押してから「1」と入力し、「Enter」キーを押してください。「1」というのはプロファイル 1 のことを表しており、プロファイル 1 は<a href="#l3">ポリシーの初期設定</a>において学習モード用として定義されています。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-6.png"></p>

<p>行頭の数字が「1」になりました。これは、学習モード用のプロファイル 1 が割り当てられていることを示しています。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-7.png"></p>

<p>いくつかの操作をしてみるために、一般ユーザ用のコンソールを開いてください。<br>
一般ユーザ用のコンソールを開くには、「START」→「システム」→「端末コンソール」の順番にメニューを選択してください。</p>

<p><img alt="Opening Konsole" title="Opening Konsole" width="800" height="600" src="konsole-1.png"></p>

<p>一般ユーザ用のコンソールと管理者用コンソールとの違いは、一般ユーザ用のコンソールの中から /bin/su コマンドを実行して root ユーザのパスワードを入力したかどうかです。<br>
<a href="#l2">TOMOYO Linux 用ツールのインストール</a>において「パスワード:」というプロンプトが表示されていますが、これは一般ユーザ用のコンソールを開いた直後に自動的に実行された /bin/su コマンドが表示しているものです。</p>

<p>ポリシーエディタの画面に切り替えて、「r」キーを押して最新の情報に更新してください。すると、行頭に「1」が付いた行がいくつか追加されているはずです。この画面では、「/bin/grep」「/bin/id」「/bin/stty」「/usr/bin/pidof」「/usr/bin/tty」「/usr/bin/wc」という６行が追加されています。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-8.png"></p>

<p>一般ユーザ用のコンソール画面に切り替えて、いくつか操作をしてみてください。</p>

<p><img alt="Using Konsole" title="Using Konsole" width="800" height="600" src="konsole-2.png"></p>

<p>ポリシーエディタの画面に切り替えて、「r」キーを押して最新の情報に更新してください。すると、一般ユーザ用のコンソール画面で実行したプログラムが追加されているはずです。この画面では、「/bin/date」（７９行目）「/bin/sh」「/bin/grep」「/bin/id」「/bin/stty」「/usr/bin/pidof」「/usr/bin/tail」「/usr/bin/tty」「/usr/bin/wc」（８２～８９行目）「/usr/bin/head」（１０５行目）というのが追加されています。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-9.png"></p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-10.png"></p>

<h2><a name="l5">学習結果の確認</a></h2>

<p>カーソルを「 /usr/bin/head 」の行（１０５行目）に移動させてから「Enter」キーを押してください。「allow_read /etc/passwd」というエントリを確認することができるはずです。このエントリは、 TOMOYO Linux の学習モードにより自動的に追加されたものです。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-11.png"></p>

<p>「Enter」キーを押して元に戻ってください。同様に「/bin/sh」（８２行目）や「/usr/bin/tail」（８７行目）に対してどのようなエントリが追加されたかを見てみましょう。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-12.png"></p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-13.png"></p>

<p>既にお気づきかもしれませんが、 allow_read とは指定されたパス名を読み込みモードでオープンしたこと、 allow_read/write とは指定されたパス名を読み書きモードでオープンしたこと、 allow_execute とは指定されたパス名をプログラムとして実行したことを表しています。</p>

<p>一般ユーザ用のコンソール画面での操作では、管理者用のコンソールを開くために必要な操作（ /bin/su コマンドの実行）を学習させていませんでした。そのため、このまま強制モードにしてしまうと、管理者用のコンソールを開くことができなくなってしまいます。これは、ポリシーエディタを実行して強制モードを解除することができなくなることを意味します。<br>
ですから、管理者用のコンソールを開始できるようにするために、一般ユーザ用のコンソールに対して /bin/su の実行許可を与えておきます。カーソルを一般ユーザ用のコンソールである /bin/bash の行（７８行目）に移動させてから「Enter」キーを押してください。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="add-su-1.png"></p>

<p>この状態で、「a」キーを押してから「allow_execute /bin/su」と入力し、「Enter」キーを押してください。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="add-su-2.png"></p>

<p>/bin/su の実行許可が与えられたことを確認したら、「Enter」キーを押して元の画面に戻ってください。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="add-su-3.png"></p>

<h2><a name="l6">強制モードへの切り替え</a></h2>

<p>それでは、強制モードへ切り替えてみましょう。プロファイル 3 は<a href="#l3">ポリシーの初期設定</a>において強制モード用として定義されています。プロファイル 3 を現在プロファイル 1 が割り当てられている行に適用してみましょう。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-14.png"></p>

<p>選択された行には、プロファイル 3 が割り当てられました。</p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-15.png"></p>

<p><img alt="Policy Editor" title="Policy Editor" width="800" height="600" src="editpolicy-16.png"></p>

<p>一般ユーザ用のコンソールに切り替えて、いくつか操作をしてみましょう。</p>

<p><img alt="Using Konsole" title="Using Konsole" width="800" height="600" src="konsole-3.png"></p>

<p>学習モードの間に行った操作だけが許可されることを理解いただけるはずです。</p>

<p>ポリシーエディタの画面に切り替え、「q」キーを押してエディタを終了させてください。次に、「アクセス拒否ログ」を閲覧してみましょう。</p>

<pre># <span class="user">less /var/log/tomoyo/reject_log.conf</span></pre>

<p>以下のように mode=enforcing という行を含んだログを見つけることができるはずです。</p>

<blockquote><p>
#2008-09-02 09:59:37# profile=3 mode=enforcing pid=4274 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /usr/bin/head<br>
allow_read /etc/hosts <br>
<br>
#2008-09-02 09:59:37# profile=3 mode=enforcing pid=4274 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /usr/bin/head<br>
allow_read /usr/lib/gconv/EUC-JP.so <br>
<br>
#2008-09-02 09:59:37# profile=3 mode=enforcing pid=4274 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /usr/bin/head<br>
allow_read /usr/lib/gconv/EUC-JP.so <br>
<br>
#2008-09-02 09:59:37# profile=3 mode=enforcing pid=4274 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /usr/bin/head<br>
allow_read /usr/lib/gconv/EUC-JP.so <br>
<br>
#2008-09-02 09:59:37# profile=3 mode=enforcing pid=4274 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /usr/bin/head<br>
allow_read /usr/lib/gconv/EUC-JP.so <br>
<br>
#2008-09-02 09:59:44# profile=3 mode=enforcing pid=4275 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 argc=4 envc=46 argv[]={ "tail" "-n" "3" "/etc/passwd" } envp[]={ "KDE_MULTIHEAD=false" "HOSTNAME=localhost" "DM_CONTROL=/var/run/xdmctl" "GPG_AGENT_INFO=/tmp/gpg-ipJudX/S.gpg-agent:3788:1" "TERM=xterm" "SHELL=/bin/bash" "LC_SOURCED=1" "HISTSIZE=1000" "XDM_MANAGED=/var/run/xdmctl/xdmctl-:0,maysd,mayfn,fn,rsvd,method=classic" "XDG_SESSION_COOKIE=457cc6821c6dec43887b31ce48bb8c33-1220313555.143126-1574269587" "GTK2_RC_FILES=/etc/gtk-2.0/gtkrc:/home/kumaneko/.gtkrc-2.0:/home/kumaneko/.kde/share/config/gtkrc-2.0" "GTK_RC_FILES=/etc/gtk/gtkrc:/home/kumaneko/.gtkrc:/home/kumaneko/.kde/share/config/gtkrc" "GS_LIB=/home/kumaneko/.fonts" "WINDOWID=50331655" "QTDIR=/usr/lib/qt3" "KDE_FULL_SESSION=true" "USER=kumaneko" "COMPOSITING_WM_START=no" "ENV=/home/kumaneko/.bashrc" "SESSION_MANAGER=local/localhost:/tmp/.ICE-unix/3817" "USERNAME=" "KONSOLE_DCOP=DCOPRef(konsole-4253,konsole)" "PATH=/usr/kerberos/bin:/usr/java/jre1.6.0_07/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin:/usr/games" "DESKTOP_SESSION=default" "QT_IM_MODULE=scim" "KONSOLE_DCOP_SESSION=DCOPRef(konsole-4253,session-1)" "PWD=/home/kumaneko" "XMODIFIERS=@im=SCIM" "JAVA_HOME=/usr/java/jre1.6.0_07" "LANG=ja_JP.UTF-8" "KDE_SESSION_UID=500" "UNICODEMAP_JP=cp932,nec-vdc" "HISTCONTROL=ignoredups" "HOME=/home/kumaneko" "SHLVL=3" "XCURSOR_THEME=default" "LESS=-MM" "LOGNAME=kumaneko" "DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-qab5dkDzi6,guid=600515bdc768600a3bde494248bc81d3" "LESSOPEN=|/usr/bin/lesspipe.sh\040%s" "DISPLAY=:0.0" "GTK_IM_MODULE=scim" "G_BROKEN_FILENAMES=1" "COLORTERM=" "XAUTHORITY=/home/kumaneko/.Xauthority" "_=/usr/bin/tail" }<br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash<br>
allow_execute /usr/bin/tail <br>
<br>
#2008-09-02 09:59:44# profile=3 mode=enforcing pid=4275 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash<br>
allow_read /usr/bin/tail <br>
<br>
#2008-09-02 09:59:44# profile=3 mode=enforcing pid=4275 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash<br>
allow_read /usr/lib/gconv/EUC-JP.so <br>
<br>
#2008-09-02 09:59:55# profile=3 mode=enforcing pid=4291 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 argc=1 envc=46 argv[]={ "date" } envp[]={ "KDE_MULTIHEAD=false" "DM_CONTROL=/var/run/xdmctl" "HOSTNAME=localhost" "GPG_AGENT_INFO=/tmp/gpg-ipJudX/S.gpg-agent:3788:1" "SHELL=/bin/bash" "TERM=xterm" "XDG_SESSION_COOKIE=457cc6821c6dec43887b31ce48bb8c33-1220313555.143126-1574269587" "XDM_MANAGED=/var/run/xdmctl/xdmctl-:0,maysd,mayfn,fn,rsvd,method=classic" "HISTSIZE=1000" "LC_SOURCED=1" "GTK2_RC_FILES=/etc/gtk-2.0/gtkrc:/home/kumaneko/.gtkrc-2.0:/home/kumaneko/.kde/share/config/gtkrc-2.0" "GS_LIB=/home/kumaneko/.fonts" "GTK_RC_FILES=/etc/gtk/gtkrc:/home/kumaneko/.gtkrc:/home/kumaneko/.kde/share/config/gtkrc" "WINDOWID=50331655" "QTDIR=/usr/lib/qt3" "KDE_FULL_SESSION=true" "USER=kumaneko" "COMPOSITING_WM_START=no" "ENV=/home/kumaneko/.bashrc" "USERNAME=" "SESSION_MANAGER=local/localhost:/tmp/.ICE-unix/3817" "KONSOLE_DCOP=DCOPRef(konsole-4253,konsole)" "DESKTOP_SESSION=default" "PATH=/usr/kerberos/bin:/usr/java/jre1.6.0_07/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin:/usr/games" "QT_IM_MODULE=scim" "PWD=/home/kumaneko" "KONSOLE_DCOP_SESSION=DCOPRef(konsole-4253,session-1)" "JAVA_HOME=/usr/java/jre1.6.0_07" "XMODIFIERS=@im=SCIM" "LANG=ja_JP.UTF-8" "KDE_SESSION_UID=500" "UNICODEMAP_JP=cp932,nec-vdc" "HISTCONTROL=ignoredups" "SHLVL=4" "HOME=/home/kumaneko" "XCURSOR_THEME=default" "LOGNAME=kumaneko" "LESS=-MM" "DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-qab5dkDzi6,guid=600515bdc768600a3bde494248bc81d3" "LESSOPEN=|/usr/bin/lesspipe.sh\040%s" "DISPLAY=:0.0" "GTK_IM_MODULE=scim" "G_BROKEN_FILENAMES=1" "XAUTHORITY=/home/kumaneko/.Xauthority" "COLORTERM=" "_=/bin/date" }<br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /bin/sh<br>
allow_execute /bin/date <br>
<br>
#2008-09-02 09:59:55# profile=3 mode=enforcing pid=4291 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /bin/sh<br>
allow_read /bin/date <br>
<br>
#2008-09-02 09:59:55# profile=3 mode=enforcing pid=4291 uid=500 gid=500 euid=500 egid=500 suid=500 sgid=500 fsuid=500 fsgid=500 state[0]=0 state[1]=0 state[2]=0 <br>
&lt;kernel&gt; /etc/rc.d/init.d/dm /etc/X11/prefdm /usr/bin/kdm /bin/sh /home/kumaneko/.xsession /usr/bin/startkde /usr/bin/start_kdeinit_wrapper /usr/bin/start_kdeinit /usr/bin/kdeinit /bin/bash /bin/sh<br>
allow_read /usr/lib/gconv/EUC-JP.so 
</p></blockquote>

<p>ccs-editpolicy を用いて閲覧していたポリシーは、メモリ上にのみ存在しています。そのため、シャットダウンすることにより失われてしまいます。メモリ上に存在しているポリシーをディスク上に保存するためには、以下のコマンドを実行してください。</p>

<pre>
# <span class="user">/usr/sbin/ccs-savepolicy</span>
</pre>

<p>このようにTOMOYO Linuxを用いれば、</p>

<ul>
<li>どのような実行履歴を持つプロセスが</li>
<li>いつ</li>
<li>どんなファイルに</li>
<li>どんなアクセスを</li>
</ul>

<p>行ったかを監視することもできます。</p>

<h2><a name="l7">情報源</a></h2>

<h3>root ユーザにならずに TOMOYO Linux を操作する</h3>

<p>もし、 TOMOYO Linux の操作を行うために root ユーザになることを要求したくないのであれば、 root 以外のユーザによる操作を認めるように TOMOYO Linux を設定することができます。</p>

<p>例えば、 demo というユーザに TOMOYO Linux の操作を認めたい場合、以下の内容を /etc/ccs/ccs-post-init というファイルに記述してください。</p>

<pre>
#! /bin/sh
echo manage_by_non_root &gt; /proc/ccs/manager
chown -R demo:demo /proc/ccs/
</pre>

<p>このようにすると、 /etc/ccs/ccs-post-init は /sbin/ccs-init から呼び出されるようになります。なお、プログラムを実行するために</p>

<pre># <span class="user">chmod 700 /etc/ccs/ccs-post-init</span></pre>

<p>を実行することで実行可能な状態にすることを忘れないでください。また、 demo というユーザが /etc/ccs/ 以下にあるポリシーファイルを読み書きできるようにするために</p>

<pre># <span class="user">chown -R demo:demo /etc/ccs/</span></pre>

<p>を実行する必要があります。</p>

<h3>ポリシーエディタのマニュアル</h3>

<p>ポリシーエディタ /usr/sbin/ccs-editpolicy のマニュアルは <a href="../../tool-editpolicy.html">ポリシーエディタの使い方</a> を参照ください。</p>

<hr>
<address><a href="http://tomoyo.osdn.jp/">TOMOYO Linux</a> is supported by <a href="http://www.nttdata.co.jp/">NTT DATA CORPORATION</a><br>
<a href="mailto:tomoyo-contact@I-love.SAKURA.ne.jp">Send message to Webadmin</a><br>
Last modified: $Date$<br>
<!--#include virtual="/cgi-bin/counter.pl" -->
</address>

<p><a href="http://osdn.jp/"><img src="http://osdn.jp/sflogo.php?group_id=1973" width="96" height="31" alt="sflogo.php" title="SourceForge.jp"></a></p>
</body>
</html>
