<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linuxによるアクセス解析手順</title>
<link rel="stylesheet" href="tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>Info: Version <a href="../1.6.x/">1.6.x</a> is available.</p>
<p style="text-align:right;"><a href="../../en/1.5.x/analysis.html">English Page</a></p>
<h1>TOMOYO Linuxによるアクセス解析手順</h1>
<p style="text-align:right;">Last modified: $Date$</p>

<p>TOMOYO Linux のポリシーはパス名で表現されるため、ファイルのアクセスを追跡するためにも利用できます。<br>
特定のプログラムがどのようなファイルにアクセスしているかを知りたい場合や、特定のディレクトリにファイルを作成しているプログラムを知りたい場合に利用できます。</p>

<h1>準備</h1>

<h2>TOMOYO Linux カーネルのインストール</h2>

<p>TOMOYO Linux では、いくつかのコンパイル済みのカーネルをパッケージにして提供しています。コンパイル済みのカーネルを利用する場合は、以下のファイルをダウンロードしてインストールしてください。</p>

<table border="1">
<tr><td>
RedHat Linux 9</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32422/ccs-kernel-smp-2.4.20-46.9.legacy_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
Fedora Core 3</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32418/ccs-kernel-smp-2.6.12-2.3.legacy_FC3_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
Fedora Core 4</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32419/ccs-kernel-smp-2.6.17-1.2142_FC4_tomoyo_1.5.5.i686.rpm
</td></tr><tr><td>
Fedora Core 5</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32420/ccs-kernel-smp-2.6.20-1.2320.fc5_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
Fedora Core 6</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32421/ccs-kernel-2.6.22.14-72_tomoyo_1.5.5.fc6.i586.rpm
</td></tr><tr><td>
Fedora 7</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32415/ccs-kernel-2.6.23.17-88_tomoyo_1.5.5.fc7.i586.rpm
</td></tr><tr><td>
Fedora 8</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32416/ccs-kernel-2.6.26.6-49_tomoyo_1.5.5.fc8.i586.rpm
</td></tr><tr><td>
Fedora 9</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32417/ccs-kernel-2.6.27.5-37_tomoyo_1.5.5.fc9.i586.rpm
</td></tr><tr><td>
CentOS 4.7</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32413/ccs-kernel-smp-2.6.9-78.0.5.EL_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
CentOS 5.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32414/ccs-kernel-2.6.18-92.1.18.el5_tomoyo_1.5.5.i686.rpm
</td></tr><tr><td>
Debian Sarge</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32750/kernel-image-2.4.27-4-686-smp-ccs1.5.5_2.4.27-10sarge7_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32750/kernel-pcmcia-modules-2.4.27-4-686-smp-ccs1.5.5_2.4.27-10sarge7_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32750/kernel-image-2.6.8-4-686-smp-ccs1.5.5_2.6.8-17sarge1_i386.deb
</td></tr><tr><td>
Debian Etch</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32751/linux-image-2.6.18-6-686-ccs1.5.5-i686_2.6.18.dfsg.1-23_i386.deb
</td></tr><tr><td>
Debian Lenny</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32752/linux-image-2.6.26-1-686-ccs1.5.5-i686_2.6.26-8_i386.deb
</td></tr><tr><td>
OpenSUSE 10.1</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32423/ccs-kernel-default-2.6.16.54-0.2.5_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
OpenSUSE 10.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32424/ccs-kernel-default-2.6.18.8-0.13_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
OpenSUSE 10.3</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32425/ccs-kernel-default-2.6.22.19-0.1_tomoyo_1.5.5.i586.rpm
</td></tr><tr><td>
Asianux 2.0</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32428/ccs-kernel-smp-2.6.9-42.29AX_tomoyo_1.5.5.i686.rpm
</td></tr><tr><td>
Asianux 3.0</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32429/ccs-kernel-2.6.18-53.11AXS3_tomoyo_1.5.5.i686.rpm
</td></tr><tr><td>
Ubuntu 6.06</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32745/linux-image-2.6.15-52-686-ccs1.5.5_2.6.15-52.73_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32745/linux-restricted-modules-2.6.15-52-686-ccs1.5.5_2.6.15.12-52.3_i386.deb
</td></tr><tr><td>
Ubuntu 6.10</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32746/linux-image-2.6.17-12-generic-ccs1.5.5_2.6.17.1-12.44_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32746/linux-restricted-modules-2.6.17-12-generic-ccs1.5.5_2.6.17.9-12.4_i386.deb
</td></tr><tr><td>
Ubuntu 7.04</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32747/linux-image-2.6.20-17-generic-ccs1.5.5_2.6.20-17.39_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32747/linux-restricted-modules-2.6.20-17-generic-ccs1.5.5_2.6.20.6-17.31_i386.deb
</td></tr><tr><td>
Ubuntu 7.10</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32748/linux-image-2.6.22-15-ccs1.5.5_2.6.22-15.59_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32748/linux-ubuntu-modules-2.6.22-15-ccs1.5.5_2.6.22-15.39_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32748/linux-restricted-modules-2.6.22-15-ccs1.5.5_2.6.22.4-15.11_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32748/linux-headers-2.6.22-15-ccs1.5.5_2.6.22-15.59_i386.deb
</td></tr><tr><td>
Ubuntu 8.04</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32749/linux-image-2.6.24-21-ccs1.5.5_2.6.24-21.43_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32749/linux-ubuntu-modules-2.6.24-21-ccs1.5.5_2.6.24-21.32_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32749/linux-restricted-modules-2.6.24-21-ccs1.5.5_2.6.24.14-21.51_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32749/linux-headers-2.6.24-21-ccs1.5.5_2.6.24-21.43_i386.deb
<br>
http://osdn.dl.sourceforge.jp/tomoyo/32749/linux-headers-lum-2.6.24-21-ccs1.5.5_2.6.24-21.32_i386.deb
</td></tr><tr><td>
Vine Linux 4.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32427/ccs-kernel-2.6.16-76.39vl4_tomoyo_1.5.5.i686.rpm
</td></tr>
</table>

<p>アーキテクチャが異なる場合やカスタマイズしたい場合には、カーネルをコンパイルする必要があります。カーネルをコンパイルする方法については、<a href="compile.html">TOMOYO Linuxカーネルの作成手順</a>を参照してください。</p>

<p>SELinux をサポートするディストリビューションでは、 SELinux が無効になっていないとインストール時にエラーが発生する場合があります。インストール時に以下のようなエラーメッセージが表示される場合は、 SELinux を無効にしてからインストールしてください。 /etc/selinux/config の SELINUX= の行を SELINUX=disabled に書き換えてからシステムを再起動するか、あるいは、カーネル起動時のコマンドラインに selinux=0 というオプションを渡すことで SELinux を無効にできます。</p>

<table border="1">
<tr><td>
[root@localhost ~]# rpm -ihv kernel-smp-2.6.9-78.0.5.EL_tomoyo_1.5.4.i586.rpm<br>
Preparing...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;########################################### [100%]<br>
Error: %pre(kernel-2.6.9-78.0.5.EL_tomoyo_1.5.4.i586) scriptlet failed, exit status 255<br>
Error:&nbsp;&nbsp;&nbsp;install: %pre scriptlet failed (2), skipping kernel-2.6.9-78.0.5.EL_tomoyo_1.5.4
</td></tr>
</table>

<p>なお、 TOMOYO Linux 自身は SELinux と同時に使用することができます。以下の操作では SELinux を有効にした状態でも構いません。</p>

<h2>TOMOYO Linux ツールのインストール</h2>

<p>TOMOYO Linux では、いくつかのコンパイル済みのツールを提供しています。コンパイル済みのツールを利用する場合は、以下のファイルをダウンロードしてインストールしてください。</p>

<table border="1">
<tr><td>
RedHat Linux 9</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32422/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora Core 3</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32418/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora Core 4</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32418/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora Core 5</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32420/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora Core 6</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32421/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora 7</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32415/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora 8</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32416/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Fedora 9</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32417/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
CentOS 4.7</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32413/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
CentOS 5.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32414/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Debian Sarge</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32750/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Debian Etch</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32751/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Debian Lenny</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32752/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
OpenSUSE 10.1</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32423/ccs-tools-1.5.5-1.i586.rpm
</td></tr><tr><td>
OpenSUSE 10.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32424/ccs-tools-1.5.5-1.i586.rpm
</td></tr><tr><td>
OpenSUSE 10.3</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32425/ccs-tools-1.5.5-1.i586.rpm
</td></tr><tr><td>
Asianux 2.0</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32428/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Asianux 3.0</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32429/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
Ubuntu 6.06</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32745/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Ubuntu 6.10</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32746/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Ubuntu 7.04</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32747/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Ubuntu 7.10</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32748/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Ubuntu 8.04</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32749/ccs-tools_1.5.5-1_i386.deb
</td></tr><tr><td>
Vine Linux 4.2</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/32427/ccs-tools-1.5.5-1.i386.rpm
</td></tr><tr><td>
その他(ソースパッケージ)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/27220/ccs-tools-1.5.5-20080903.tar.gz
</td></tr>
</table>

<p>ソースパッケージをダウンロードした場合は以下のコマンドを実行してください。</p>

<table border="1">
<tr><td>
tar -zxf ccs-tools-1.5.5-20080903.tar.gz<br>
make -C ccstools/ all install
</td></tr>
</table>

<h2>ポリシーの作成</h2>

<p>/etc/ccs/profile.conf を作成し、以下の内容を指定します。</p>

<table border="1">
<tr><td>
MAC_FOR_FILE=1<BR>
MAX_ACCEPT_ENTRY=1048576<BR>
MAX_GRANT_LOG=0<BR>
MAX_REJECT_LOG=0<BR>
TOMOYO_VERBOSE=0<BR>
</td></tr>
</table>

<p>以下のコマンドを実行してください。</p>

<table border="1">
<tr><td>
/usr/lib/ccs/init_policy.sh
</td></tr>
</table>

<h1>解析</h1>

<p>TOMOYO Linuxカーネルで起動します。

<p>解析したいアプリケーションを動作させます。</p>

<p>/usr/lib/ccs/editpolicy を実行すると、現在に至るまでに実行されたプログラムの一覧を表示できます。プログラムを選択して Enter を押すと、そのプログラムがアクセスしたファイルの一覧が表示されます。ポリシーエディタの使い方については、<a href="tool-editpolicy.html">ポリシーエディタの使い方</a>を参照してください。</p>

<p>/usr/lib/ccs/savepolicy を実行すると、現在に至るまでにアクセスされたファイルの一覧を /etc/ccs/domain_policy.conf に保存することができます。</p>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</body>
</html>
