<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>TOMOYO Linux LiveCD Tutorial</title>
<link rel="stylesheet" href="../startup.css" media="all" type="text/css">
<link rev="made" href="mailto:k.takeda26@gmail.com"> 
</head>
<body>
<p style="text-align:right;"><a href="http://tomoyo.sourceforge.jp/ja/1.6.x/1st-step/centos5-live/index.html">Japanese Page</a></p>
<h1><a href="http://tomoyo.sourceforge.jp/">TOMOYO Linux</a> LiveCD Tutorial for CentOS 5.3</h1>

<ul>
<li><a href="#l1">Abstract</a></li>
<li><a href="#l2">Get LiveCD</a></li>
<li><a href="#l3">Boot from LiveCD</a></li>
<li><a href="#l4">Use LiveCD</a></li>
<li><a href="#l5">Restrict accesses</a></li>
<li><a href="#l7">(appendix) More information</a></li>
</ul>

<h2><a name="l1">Abstract</a></h2>

<p>
This document explains how to use TOMOYO Linux LiveCD.
TOMOYO Linux LiveCD is a CD image which contains CentOS installed TOMOYO Linux kernel and tools.
Using TOMOYO Linux LiveCD, you can try TOMOYO Linux without any effects to existing system.
</p>

<h2><a name="l2">Get LiveCD</a></h2>

<p>
You can download ISO image file of TOMOYO Linux LiveCD at
<a href="http://tomoyo.sourceforge.jp/wiki-e/?TomoyoLive#g975a344">LiveCD page</a>
in TOMOYO Linux project web site.
</p>

<p>
Please burn the ISO image into CD-R.
Otherwise, you can boot TOMOYO Linux LiveCD with
<a href="http://www.vmware.com/products/player/">VMware Player</a>,
which is available at no fee.
</p>

<h2><a name="l3">Boot from LiveCD</a></h2>

<p>
When you boot your PC from LiveCD, you can see the following screen.
</p>

<p><img src="isolinux.png" width="640" height="480" alt="boot screen" title="boot screen"></p>

<p>
Please wait a while or press Enter, then the system boots as a normal CentOS.
When boot sequence has finished, the following screen is shown.
</p>

<p><img src="desktop.png" width="800" height="600" alt="desktop" title="desktop"></p>

<h2><a name="l4">Use LiveCD</a></h2>

<p>
The following two icons are on your Desktop.
</p>

<p>
<img src="icon_editpolicy.png" width="138" height="88" alt="TOMOYO Linux Policy Editor" title="TOMOYO Linux Policy Editor">
<img src="icon_rejectlog.png" width="138" height="88" alt="TOMOYO Linux Policy Violation Log" title="TOMOYO Linux Policy Violation Log">
</p>

<p>
Please double-click the icon named "TOMOYO Linux Policy Violation Log".
Then you can see the following window.
</p>

<p><img src="reject_log.png" width="665" height="462" alt="policy violation log window" title="policy violation log window"></p>

<p>
This window is showing accesses which violate the policy of TOMOYO Linux.
New violation accesses are showed instantly.
Since liveCD is configured to boot in empty policy,
all accesses are outputed as policy violation logs.
Please keep the window shown and operate some functions.
The logs that what process accesses which resources are shown in real time.
</p>

<p>
In the next, please double-click the icon named "TOMOYO Linux Policy Editor".
Then the following window is shown.
</p>

<p><img src="editpolicy.png" width="665" height="462" alt="policy editor window" title="policy editor window"></p>

<p>
This window displays all invoked processes in the tree structure. Each line is called "domain".
All invoked processes from the beginning of boot sequence are monitored by TOMOYO Linux kernel.
The information that what process accesses which resources is recorded as a TOMOYO Linux policy.
You can understand your Linux's behavior easily by browsing TOMOYO Linux policy.
That's the greatest characteristic of TOMOYO Linux.
</p>

<p>
The first situation of policy editor shows process invocation history whose origin is &lt;kernel&gt;.
Please scroll down as you like and confirm the process invoked in your system.
</p>

<p>
Let's try to find the process named "gnome-terminal".
Please press 'F' key, then a prompt is shown in the bottom of the window.
Please input "gnome-terminal" and press Enter.
</p>

<p><img src="find.png" width="311" height="59" alt="find gnome-terminal" title="find gnome-terminal"></p>

<p>
You can see that gnome-terminal invoked /usr/sbin/sudo,
and /usr/sbin/sudo invoked /usr/bin/tail and /usr/lib/ccs/editpolicy .
</p>

<p><img src="domain_gnome-terminal.png" width="686" height="84" alt="around gnome-terminal" title="around gnome-terminal"></p>

<p>
Please press enter on /usr/bin/tail .
</p>

<p><img src="acl_tail.png" width="665" height="462" alt="ACLs of tail command" title="ACLs of tail command"></p>

<p>
The leftmost number of each line is line number, and next word is the access permission.
"allow_execute" means execute, "allow_write" means open for writing, "allow_read" means open for reading, "allow_read/write" means open for reading and writing, "allow_env" means accepting this environment variable name.
These lines show the tail command read some locale files and /var/log/tomoyo/reject_log.txt .
This policy is the result of learning the behavior of double-clicking "TOMOYO Linux Policy Violation Log" icon.
</p>

<p>
Please press Enter to go back to the previous domain-tree view.
Please browse several domains and permissions as you like.
</p>

<h2><a name="l5">Restrict accesses</a></h2>

<p>
Now let's try to restrict accesses by TOMOYO Linux.
Please keep the policy editor in background,
and start "Terminal" in the "Application" menu of the top of the display
(Applications -&gt; Accessories -&gt; Terminal).
</p>

<p><img src="menu_terminal.png" width="380" height="320" alt="start Terminal" title="start Terminal"></p>

<p>
After starting terminal, please go back to the policy editor and press 'R' key to reload TOMOYO Linux policy.
Please find /bin/bash that is the child of gnome-terminal .
To find bash, you can use 'F' key like the previous operations.
</p>

<p><img src="domain_bash.png" width="667" height="192" alt="bash executed by gnome-terminal" title="bash executed by gnome-terminal"></p>

<p>
This bash is running in the "Terminal" window.
There are domains of sed, uname, and so on, which were automatically executed in bash start sequence.
Please type the following command in the terminal.
</p>

<pre>
$ head /etc/passwd
$ bash
$ tail /etc/passwd
$ exit
</pre>

<p><img src="bash_learning.png" width="665" height="496" alt="let bash learn some commands" title="let bash learn some commands"></p>

<p>
After that, please go back the policy editor and press 'R' key, then you can see that domains of executed programs are appended.
</p>

<p><img src="bash_learned.png" width="665" height="262" alt="results of learning" title="results of learning"></p>

<p>
Please pay attention to the numbers in the next of line numbers.
All lines show '1' currently.
</p>

<p><img src="profilenumber.png" width="665" height="262" alt="profile number is all 1" title="profile number is all 1"></p>

<p>
These numbers show the process's running mode of TOMOYO Linux, which is called profile number.
The profile numbers of LiveCD are 0-3 and all domains are initially assigned profile number 1 (learning mode).
</p>

<table border="1" summary="profile number">
<tr><th>profile number</th><th>meanings</th></tr>
<tr><td>0</td><td>disabled mode (TOMOYO Linux do nothing)</td></tr>
<tr><td>1</td><td>leaning mode (policy violation accesses are permitted and appended into policy)</td></tr>
<tr><td>2</td><td>permissive mode (policy violation accesses are permitted and recorded into log)</td></tr>
<tr><td>3</td><td>enforcing mode (policy violation accesses are denied)</td></tr>
</table>

<p>
To enable TOMOYO Linux access restriction, you need to assign profile number 3 to domain.
Let's two bashes restricted in this tutorial.
Please press Space key at bash just below gnome-terminal, then
'&amp;' is shown at the left of the line number.
This '&amp;' is the 'selected' mark.
</p>

<p><img src="bash_selected1.png" width="665" height="56" alt="1st bash is selected" title="1st bash is selected"></p>

<p>
Please press Space key at bash the second bash.
</p>

<p><img src="bash_selected2.png" width="665" height="56" alt="two bashes are selected" title="two bashes are selected"></p>

<p>
After that, please press 'S' key then prompt is shown in the bottom of the window.
Please input "3" and press Enter.
</p>

<p><img src="setprofile.png" width="665" height="40" alt="set profile number 3" title="set profile number 3"></p>

<p>Profile number 3 is assigned to the two bashes.</p>

<p><img src="bash_enforced.png" width="665" height="56" alt="two bashes in profile number 3" title="two bashes in profile number 3"></p>

<p>
bash is already running in enforcing mode.
Please execute some commands in the terminal.
Commands that are not executed in learning mode will be denied.
In the following window, "head /etc/password" succeeded, but executions of "ls" and "ps" are denied.
</p>

<p><img src="1st_bash.png" width="665" height="340" alt="not learned commands are denied" title="not learned commands are denied"></p>

<p>
In addition, first-level bash can't execute "tail /etc/passwd", but second-level bash can do it.
</p>

<p><img src="2nd_bash.png" width="665" height="330" alt="permissions are different according to shell-level" title="permissions are different according to shell-level"></p>

<p>
This is because TOMOYO Linux distinguishes processes according to their invocation history.
In current policy, the following two bashes exist.
</p>

<ul>
<li>bash executed by gnome-terminal</li>
<li>bash executed by bash executed by gnome-terminal</li>
</ul>

<p>
head command is only permitted in the first bash, and tail command is only permitted in the second bash.
TOMOYO Linux monitors all processes from system boot sequence, and processes are distinguished by fine-grained method.
</p>

<h2><a name="l7">(appendix) More information</a></h2>

<p>
In this tutorial, you have experienced the file access control, which is the most basic function of TOMOYO Linux.
TOMOYO Linux has more and more functions. Please see the following documents to use TOMOYO Linux more effectively.
</p>

<ul>
<li><a href="../../policy-reference.html">Policy Specifications of TOMOYO Linux</a>: reference of TOMOYO Linux functions</li>
<li><a href="../../tool-editpolicy.html">How to use Policy Editor</a>: detailed usage of policy editor</li>
</ul>

<hr>
<address><a href="/">TOMOYO Linux</a> is supported by <a href="http://www.nttdata.co.jp/">NTT DATA CORPORATION</a><br>
<a href="mailto:haradats@gmail.com">Send message to Webadmin</a><br>
Last modified: $Date$<br>
<!--#include virtual="/cgi-bin/counter.pl" -->
</address>

<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>

<p><a href="http://validator.w3.org/check?uri=referer">
<img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01 Strict" height="31" width="88"></a></p>

</body>
</html>
