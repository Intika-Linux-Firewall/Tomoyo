<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>Access analysis using TOMOYO Linux</title>
<link rel="stylesheet" href="tomoyo.css" media="all" type="text/css">
</head>
<body>
<p>Info: Version <a href="../1.3.1/">1.3.1</a> is available.</p>
<h1>Access Analysis using TOMOYO Linux</h1>
<p style="text-align:right;">Last modified: $Date$</p>

<p>Since the policy of TOMOYO Linux is represented using pathnames, TOMOYO Linux is applicable for tracing file accesses.<br>
You can use TOMOYO Linux to find how programs access files or what program is creating files on specific directories.</p>

<h1>Preparation</h1>

<h2>Install TOMOYO Linux kernel</h2>

<p>TOMOYO Linux provides some binary kernel packages. If you want to use binary kernel packages, download and install.</p>

<table border="1">
<tr><td>
RedHat Linux 9 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.4.20-46.9.legacy_tomoyo_1.3.i386.rpm
</td></tr><tr><td>
Fedora Core 3 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.6.12-2.3.legacy_FC3_tomoyo_1.3.i586.rpm
</td></tr><tr><td>
Fedora Core 4 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.6.17-1.2142_FC4_tomoyo_1.3.i586.rpm
</td></tr><tr><td>
Fedora Core 5 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.6.18-1.2239.fc5_tomoyo_1.3.i586.rpm
</td></tr><tr><td>
Fedora Core 6 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.6.18-1.2849.fc6_tomoyo_1.3.i586.rpm
</td></tr><tr><td>
CentOS 4.4 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-2.6.9-42.0.3.EL_tomoyo_1.3.i586.rpm
</td></tr><tr><td>
Debian Sarge (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-image-2.4.27-10sarge4-ccs_1.3_i586.deb<br>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-image-2.6.8-16sarge5-ccs_1.3_i586.deb
</td></tr><tr><td>
Debian Etch (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/linux-image-2.6.17-9-ccs_1.3_i586.deb
</td></tr><tr><td>
OpenSUSE 10.1 (80586 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/kernel-default-2.6.16.21-0.25_tomoyo_1.3.i586.rpm
</td></tr>
</table>

<p>If the CPU architecture differs or you want to customize kernel configuration, you need to compile kernel. To compile kernel, see <a href="compile.html">TOMOYO Linux kernel compilation</a>.</p>

<p>If you install rpm package, the following entry is added to /boot/grub/grub.conf upon successful installation.</p>

<table border="1">
<tr><td>
title CentOS (2.6.9-42.0.3.EL_tomoyo_1.3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;kernel /vmlinuz-2.6.9-42.0.3.EL_tomoyo_1.3 ro root=/dev/VolGroup00/LogVol00<br>
&nbsp;&nbsp;&nbsp;&nbsp;initrd /initrd-2.6.9-42.0.3.EL_tomoyo_1.3.img
</td></tr>
</table>

<p>Append "init=/.init" to the line of "kernel".</p>

<table border="1">
<tr><td>
title CentOS (2.6.9-42.0.3.EL_tomoyo_1.3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;kernel /vmlinuz-2.6.9-42.0.3.EL_tomoyo_1.3 ro root=/dev/VolGroup00/LogVol00 init=/.init<br>
&nbsp;&nbsp;&nbsp;&nbsp;initrd /initrd-2.6.9-42.0.3.EL_tomoyo_1.3.img
</td></tr>
</table>

<p>If you install deb package, the following entry is added to /boot/grub/menu.lst upon successful installation.</p>

<table border="1">
<tr><td>
title Debian GNU/Linux, kernel 2.6.8-16sarge5-ccs<br>
root (hd0,0)<br>
kernel /boot/vmlinuz-2.6.8-16sarge5-ccs root=/dev/sda1 ro<br>
initrd /boot/initrd.img-2.6.8-16sarge5-ccs<br>
savedefault<br>
boot
</td></tr>
</table>

<p>Append "init=/.init" to the line of "kernel".</p>

<table border="1">
<tr><td>
title Debian GNU/Linux, kernel 2.6.8-16sarge5-ccs<br>
root (hd0,0)<br>
kernel /boot/vmlinuz-2.6.8-16sarge5-ccs root=/dev/sda1 ro init=/.init<br>
initrd /boot/initrd.img-2.6.8-16sarge5-ccs<br>
savedefault<br>
boot
</td></tr>
</table>

<p>The "/.init" is a script to load TOMOYO Linux's policy files and is executed before starting "/sbin/init" .<br>
The "/.init" is included in the TOMOYO Linux tools package.</p>

<h2>Install TOMOYO Linux tools</h2>

<p>TOMOYO Linux provides some pre-compiled tools. If you want to use pre-compiled tools, download and extract under /root/ directory.</p>

<table border="1">
<tr><td>
RedHat Linux 9 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-RHL9.tar.gz
</td></tr><tr><td>
Fedora Core 3 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-FC3.tar.gz
</td></tr><tr><td>
Fedora Core 4 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-FC4.tar.gz
</td></tr><tr><td>
Fedora Core 5 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-FC5.tar.gz
</td></tr><tr><td>
Fedora Core 6 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-FC6.tar.gz
</td></tr><tr><td>
CentOS 4.4 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-CentOS4.4.tar.gz
</td></tr><tr><td>
Debian Sarge (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-Sarge.tar.gz
</td></tr><tr><td>
Debian Etch (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-Etch.tar.gz
</td></tr><tr><td>
OpenSUSE 10.1 (80386 and later)</td><td>
http://osdn.dl.sourceforge.jp/tomoyo/22560/ccs-tools-1.3-i386-SUSE10.1.tar.gz
</td></tr>
</table>

<p>Move extracted ".init" (policy loader) to / .</p>

<table border="1">
<tr><td>
mv ccstools/.init /
</td></tr>
</table>

<p>If the CPU architecture differs, you need to compile tools. To compile tools, run the following commands.</p>

<table border="1">
<tr><td>
cd /root/<br>
# Download source of tools for TOMOYO Linux.<br>
wget http://osdn.dl.sourceforge.jp/tomoyo/22559/ccs-tools-1.3-20061111.tar.gz<br>
# Extract.<br>
tar -zxf ccs-tools-1.3-20061111.tar.gz<br>
# Compile.<br>
make -sC ccstools/<br>
# Move policy loader to / .<br>
mv ccstools/.init /
</td></tr>
</table>

<h2>Create Policy</h2>

<p>Create /etc/ccs/manager.txt with the following contents.</p>

<table border="1">
<tr><td>
/root/ccstools/editpolicy
</td></tr>
</table>

<p>Create /etc/ccs/status.txt with the following contents.</p>

<table border="1">
<tr><td>
MAC_FOR_FILE=1<BR>
MAX_ACCEPT_FILES=1048576<BR>
MAX_GRANT_LOG=0<BR>
MAX_REJECT_LOG=0<BR>
TOMOYO_VERBOSE=0<BR>
</td></tr>
</table>

<p>Save the output of the following commands as /etc/ccs/exception_policy.txt .</p>

<table border="1">
<tr><td>
/root/ccstools/make_exception.sh | grep ^file_pattern | sort | uniq
</td></tr>
</table>

<h1>Analysis</h1>

<p>Reboot with TOMOYO Linux kernel.</p>

<p>The following messages will appear upon successful execution of "/.init", so press "Enter".</p>

<table border="1">
<tr><td>
Press 'Enter' or wait for 10 seconds to use default status.<br>
You may input 'disabled' and press 'Enter' to disable MAC in case of emergency.<br>
&gt;
</td></tr>
</table>

<p>/sbin/init will start and the system will boot if profiles are loaded successfully.<br>
On failure, the following messages will appear and the system halts.</p>

<table border="1">
<tr><td>
No profiles loaded. Run policy loader using 'init=' option.
</td></tr>
</table>

<p>If failed, check the following points.</p>

<ul>
<li>The "kernel" line of the entry of TOMOYO Linux kernel in /boot/grub/grub.conf ( or /boot/grub/menu.lst ) has "init=/.init" option.
<li> /.init has execute permission.
</ul>

<p>Run applications you want to analyze.</p>

<p>You can see the list of programs executed until now by executing /root/ccstools/editpolicy . Choose a program and press "Enter" to see the list of files accessed by the program.</p>

<p>You can save the list of all accessed files until now as /etc/ccs/domain_policy.txt by executing /root/ccstools/savepolicy .</p>

</body>
</html>
