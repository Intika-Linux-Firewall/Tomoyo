<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Documentation</title>
</head>
<body>

<h1><a href="#how_to_use">How to use</a></h1>

<ul>
<li><a href="#difference_with_existing_versions">1. Difference with existing versions (for existing users)</a></li>
<li><a href="#how_to_install">2. How to install</a></li>
<li><a href="#how_to_develop_policy">3. How to develop policy</a></li>
</ul>

<h1><a href="#policy_specification">Policy Specification</a></h1>

<ul>
<li><a href="#available_parameters">1. About parameters which can be handled via policy</a></li>
<li><a href="#string_expression">1.1. String parameters representation rule</a></li>
<li><a href="#numeric_expression">1.2. Numeric parameters representation rule</a></li>
<li><a href="#ipaddress_expression">1.3. IP address parameters representation rule</a></li>
<li><a href="#conditions">2. About conditional expressions</a></li>
<li><a href="#string_comparison">2.1. Conditional expressions which handle string parameters</a></li>
<li><a href="#integer_comparison">2.2. Conditional expressions which handle numeric parameters</a></li>
<li><a href="#ipaddr_comparison">2.3. Conditional expressions which handle IP address parameters</a></li>
<li><a href="#task_attributes_comparison">2.4. Conditional expressions which handle current thread's attributes</a></li>
<li><a href="#argv_comparison">2.5. Conditional expressions which handle command line arguments</a></li>
<li><a href="#envp_comparison">2.6. Conditional expressions which handle environment variable arguments</a></li>
<li><a href="#dac_permission_comparison">2.7. Conditional expressions which handle file's DAC permissions</a></li>
<li><a href="#file_type_comparison">2.8. Conditional expressions which handle file's type</a></li>
<li><a href="#file_attributes_comparison">2.9. Conditional expressions which handle file's attributes</a></li>
<li><a href="#syntax_list">3. List of syntaxes sorted by operations</a></li>
<li><a href="#policy_syntaxes">4. Policy syntaxes</a></li>
<li><a href="#policy_structure_definition">4.1. Definition</a></li>
<li><a href="#policy_examples">4.2. Examples</a></li>
</ul>

<hr>

<h1><a name="how_to_use">How to use</a></h1>

<h2><a name="difference_with_existing_versions">1. Difference with existing versions (for existing users)</a></h2>

<h3>About pathnames and management programs</h3>

<p>/proc/ccs/domain_policy /proc/ccs/exception_policy /proc/ccs/profile /proc/ccs/manager /proc/ccs/stat has been aggregated into /proc/ccs/policy</p>

<p>/etc/ccs/policy/current/domain_policy.conf /etc/ccs/policy/current/exception_policy.conf /etc/ccs/policy/current/profile.conf /etc/ccs/policy/current/manager.conf /etc/ccs/policy/current/stat.conf has been aggregated into /etc/ccs/policy/current</p>

<p>Built-in policy files which are located in security/ccsecurity/policy/domain_policy.conf security/ccsecurity/policy/exception_policy.conf security/ccsecurity/policy/profile.conf security/ccsecurity/policy/manager.conf security/ccsecurity/policy/stat.conf under kernel source directory have been aggregated into security/ccsecurity/policy/policy.conf</p>

<p>Only /sbin/ccs-init /usr/sbin/ccs-auditd /usr/sbin/ccs-loadpolicy /usr/sbin/ccs-notifyd /usr/sbin/ccs-pstree /usr/sbin/ccs-queryd /usr/sbin/ccs-savepolicy /usr/lib/ccs/audit-exec-param /usr/lib/ccs/ccs-editpolicy-agent /usr/lib/ccs/init_policy are provided for managing policy. (In other words, programs such as /usr/sbin/ccs-editpolicy and /usr/sbin/ccs-setprofile have been removed.)</p>

<p>Command line arguments for specifying type of policy to load/save has been removed from /usr/sbin/ccs-loadpolicy and /usr/sbin/ccs-savepolicy</p>

<p>Command line arguments for specifying profile type has been removed from /usr/lib/ccs/init_policy</p>

<h3>About policy syntax</h3>

<p>Policy syntax has been drastically changed. Existing versions used process's domainname as a key for grouping permissions to do some operations. In other words, existing version's policy is collection of "which domain can do ..." rules. On the other hand, this version uses operation as a key for checking permission. In other words, this version's policy is collection of "which operation can be done by ..." rules. This change is intended for allowing users to protect resources using blacklisting approach. In this version, process's domainname is nothing but one of optional parameters that can be used for controlling whether to grant or deny specific operations. Users can write rules without managing domainnames unless needed.</p>

<p>Process's domainname representation has changed from space delimited multiple words (e.g. "&lt;kernel&gt; /sbin/init /etc/rc.d/rc.sysinit") to a single word (e.g. "/sbin/init").</p>

<p>Domain transitions no longer happen unless explicitly specified by policy.</p>

<p>Distinction of disabled/learning/permissive/enforcing mode has been removed.</p>

<p>"path_group" keyword has been renamed to "string_group", and "address_group" keyword has been renamed to "ip_group".</p>

<p>Representation of \ character has been changed from \\ to \134.</p>

<p>Category keywords (i.e. "file", "network", "ipc", "misc", "capability", "task") have been removed because access control levels which was specified using profile has been removed. Some of operation keywords have been renamed (e.g. "network inet stream connect" became "inet_stream_connect", "misc env" became "environ").</p>

<p>"task auto_execute_handler" keyword has been renamed to "handler=" argument of "execute" keyword. This is intended for using execute handler for preprocessing purpose when executing specific programs rather than when executing from specific domains. "task denied_execute_handler" keyword has been removed.</p>

<p>Domain argument has been removed from permission to send signals (i.e. "signal" directive), for kill() system call accepts negative number for specifying multiple processes. It is impossible to selectively deny sending signals because it is not permitted to sleep while sending signals.</p>

<p>Restriction granularity for ptrace operation has changed from boolean (i.e. "capability SYS_PTRACE") to command number + domainname.</p>

<p>Restriction granularity for environment variables has changed from name only to both name and values.</p>

<p>Several variables for referencing file's attributes have been added.</p>

<p>Local port reserve functionality (i.e. "deny_autobind" keyword) has been removed.</p>

<h2><a name="how_to_install">2. How to install</a></h2>

<p>Same with <a href="http://tomoyo.sourceforge.jp/1.8/chapter-3.html#3.3">http://tomoyo.sourceforge.jp/1.8/chapter-3.html#3.3</a> except that you need to replace</p>

<table border="1">
<tr><td>
$ wget -O ccs-patch-1.8.3-20120301.tar.gz 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/49684/ccs-patch-1.8.3-20120301.tar.gz'<br>
$ wget -O ccs-patch-1.8.3-20120301.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/49684/ccs-patch-1.8.3-20120301.tar.gz.asc'<br>
$ gpg ccs-patch-1.8.3-20120301.tar.gz.asc<br>
$ tar -zxf ccs-patch-1.8.3-20120301.tar.gz
</td></tr>
</table>

<p>with</p>

<table border="1">
<tr><td>
$ wget -O - 'http://sourceforge.jp/projects/tomoyo/svn/view/trunk/1.8.x/ccs-patch/patches/?root=tomoyo&amp;view=tar' | tar -zxf -<br>
$ wget -O - 'http://sourceforge.jp/projects/tomoyo/svn/view/branches/experimental/ccs-patch/?root=tomoyo&amp;view=tar' | tar -zxf - --strip 1
</td></tr>
</table>

<p>and replace</p>

<table border="1">
<tr><td>
$ wget -O ccs-tools-1.8.3-20120301.tar.gz 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/49693/ccs-tools-1.8.3-20120301.tar.gz'<br>
$ wget -O ccs-tools-1.8.3-20120301.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?m=jaist&amp;f=/tomoyo/49693/ccs-tools-1.8.3-20120301.tar.gz.asc'<br>
$ gpg ccs-tools-1.8.3-20120301.tar.gz.asc<br>
$ tar -zxf ccs-tools-1.8.3-20120301.tar.gz
</td></tr>
</table>

<p>with</p>

<table border="1">
<tr><td>
$ wget -O - 'http://sourceforge.jp/projects/tomoyo/svn/view/branches/experimental/ccs-tools/ccstools/?root=tomoyo&amp;view=tar' | tar -zxf -<br>
</td></tr>
</table>

<p>. To initialize, run /usr/lib/ccs/init_policy without --file-only-profile option. Be sure to remove (or rename) /etc/ccs/ directory if it already exists, for tools are not compatible with existing versions.</p>

<p>To save /proc/ccs/audit automatically, run /usr/sbin/ccs-auditd from somewhere. Default setting (specified in /etc/ccs/tools/auditd.conf) sends access matched logs to /dev/null, access unmatched logs to /var/log/tomoyo/unmatched.log, access denied logs to /var/log/tomoyo/denied.log.</p>

<h2><a name="how_to_develop_policy">3. How to develop policy</a></h2>

<p>Please read <a href="#policy_specification">Policy Specification</a> before continue.</p>

<p>Firstly, create a "quota audit[$audit_index]" line with non 0 $max_logs_for_unmatched_request value.</p>

<table border="1">
<tr><td>
quota audit[1] allowed=0 unmatched=1024 denied=1024
</td></tr>
</table>

<p>You can use /usr/sbin/ccs-loadpolicy to update policy.</p>

<table border="1">
<tr><td>
# echo 'quota audit[1] allowed=0 unmatched=1024 denied=1024' | /usr/sbin/ccs-loadpolicy
</td></tr>
</table>

<p>Then, decide conditions to restrict access. Below example restricts opening /etc/shadow for reading.</p>

<table border="1">
<tr><td>
100 acl read path="/etc/shadow"<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1
</td></tr>
</table>

<p>By operating the system, access unmatched logs are generated and spooled in /proc/ccs/audit interface when access request of opening /etc/shadow for reading happens. If /usr/sbin/ccs-auditd is running , access unmatched logs will be moved to /var/log/tomoyo/unmatched.log .</p>

<table border="1">
<tr><td>
#2012/03/02 08:11:51# global-pid=2826 result=unmatched / read path="/etc/shadow" task.pid=2826 task.ppid=2814 task.uid=0 task.gid=0 task.euid=0 task.egid=0 task.suid=0 task.sgid=0 task.fsuid=0 task.fsgid=0 task.type!=execute_handler task.exe="/usr/bin/passwd" task.domain="/usr/sbin/sshd" path.uid=0 path.gid=42 path.ino=33708 path.major=8 path.minor=1 path.perm=0640 path.type=file path.fsmagic=0xEF53 path.parent.uid=0 path.parent.gid=0 path.parent.ino=32769 path.parent.major=8 path.parent.minor=1 path.parent.perm=0755 path.parent.type=directory path.parent.fsmagic=0xEF53
</td></tr>
</table>

<p>Examine the log and decide whether to grant this access request or not. To grant this request, add an allow line. Below example grants this request to /usr/bin/passwd program.</p>

<table border="1">
<tr><td>
100 acl read path="/etc/shadow"<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/bin/passwd"
</td></tr>
</table>

<p>Operate the system again. For example, /usr/sbin/sshd program and /bin/cat program have requested opening /etc/shadow for reading.</p>

<table border="1">
<tr><td>
#2012/03/02 08:13:06# global-pid=2831 result=unmatched / read path="/etc/shadow" task.pid=2831 task.ppid=2691 task.uid=0 task.gid=0 task.euid=0 task.egid=0 task.suid=0 task.sgid=0 task.fsuid=0 task.fsgid=0 task.type!=execute_handler task.exe="/usr/sbin/sshd" task.domain="/usr/sbin/sshd" path.uid=0 path.gid=42 path.ino=33716 path.major=8 path.minor=1 path.perm=0640 path.type=file path.fsmagic=0xEF53 path.parent.uid=0 path.parent.gid=0 path.parent.ino=32769 path.parent.major=8 path.parent.minor=1 path.parent.perm=0755 path.parent.type=directory path.parent.fsmagic=0xEF53<br>
#2012/03/02 08:13:12# global-pid=2837 result=unmatched / read path="/etc/shadow" task.pid=2837 task.ppid=2833 task.uid=0 task.gid=0 task.euid=0 task.egid=0 task.suid=0 task.sgid=0 task.fsuid=0 task.fsgid=0 task.type!=execute_handler task.exe="/bin/cat" task.domain="/usr/sbin/sshd" path.uid=0 path.gid=42 path.ino=33716 path.major=8 path.minor=1 path.perm=0640 path.type=file path.fsmagic=0xEF53 path.parent.uid=0 path.parent.gid=0 path.parent.ino=32769 path.parent.major=8 path.parent.minor=1 path.parent.perm=0755 path.parent.type=directory path.parent.fsmagic=0xEF53
</td></tr>
</table>

<p>Add an allow line with /usr/sbin/sshd program in order to allow access by /usr/sbin/sshd program. Also, add a deny line with /bin/cat program in order to deny access by /bin/cat program. Give higher priority (i.e. smaller $cond_priority value) to deny line than allow line so that deny lines are checked before allow lines are checked.</p>

<table border="1">
<tr><td>
100 acl read path="/etc/shadow"<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny task.exe="/bin/cat"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/bin/passwd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/sbin/sshd"
</td></tr>
</table>

<p>From now on, attempt to read /etc/shadow using /bin/cat should be denied and access denied logs should be generated. If /usr/sbin/ccs-auditd is running , access denied logs will be moved to /var/log/tomoyo/denied.log .</p>

<table border="1">
<tr><td>
#2012/03/02 08:14:38# global-pid=2842 result=denied / read path="/etc/shadow" task.pid=2842 task.ppid=2833 task.uid=0 task.gid=0 task.euid=0 task.egid=0 task.suid=0 task.sgid=0 task.fsuid=0 task.fsgid=0 task.type!=execute_handler task.exe="/bin/cat" task.domain="/usr/sbin/sshd" path.uid=0 path.gid=42 path.ino=33716 path.major=8 path.minor=1 path.perm=0640 path.type=file path.fsmagic=0xEF53 path.parent.uid=0 path.parent.gid=0 path.parent.ino=32769 path.parent.major=8 path.parent.minor=1 path.parent.perm=0755 path.parent.type=directory path.parent.fsmagic=0xEF53
</td></tr>
</table>

<p>After you have finished enumerating all allow lines and deny lines, add a deny line with lowest priority (i.e. largest $cond_priority value within this block).</p>

<table border="1">
<tr><td>
100 acl read path="/etc/shadow"<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny task.exe="/bin/cat"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/bin/passwd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/sbin/sshd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;10000 deny
</td></tr>
</table>

<p>A rule for restricting /etc/shadow for opening is now completed.</p>

<p>Note that the rule explained above alone cannot prevent diverted accesses such as creating a hard link of /etc/shadow . If the resource to protect has characteristic attribute, it is recommended to utilize such attributes. On several distributions, /etc/shadow is owned by shadow group. In that case, this rule can be modified to below. (Below example assumes that shadow group's group ID is 42.)</p>

<table border="1">
<tr><td>
100 acl read path.gid=42<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny task.exe="/bin/cat"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/bin/passwd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/sbin/sshd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;10000 deny
</td></tr>
</table>

<p>On several distributions, /etc/shadow is owned by root user and root group and has DAC permissions 0400. In that case, you might want to use a rule like below. (You should check whether there are other files with such attributes.)</p>

<table border="1">
<tr><td>
100 acl read path.uid=0 path.gid=0 path.perm=0400<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny task.exe="/bin/cat"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/bin/passwd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 allow task.exe="/usr/sbin/sshd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;10000 deny
</td></tr>
</table>

<p>It is recommended to restrict other operations such as mount, link and rename. For example, a rule to deny creation of hard links which is not owned by the user would look like below. (Note that the variable which refers source pathname of link operation is "old_path" rather than "path" because the operation is "link".)</p>

<table border="1">
<tr><td>
100 acl link old_path.uid!=task.uid<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;100 deny
</td></tr>
</table>

<p>If you can split files into different filesystems or different partitions, you might be able to utilize more variables. For example, rules for denying creation of hard links on tmpfs filesystem (tmpfs filesystem's magic number is 0x01021994) would look like below.</p>

<table border="1">
<tr><td>
100 acl link old_path.fsmagic=0x01021994<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny
</td></tr>
</table>

<p>Splitting into different partitions and defining rules based on partition's attributes will help preventing diverted access via creating hard links, for hard links cannot be created across partitions. Separating /home partition from / partition will be useful when protecting resources in /home partition.</p>

<hr>

<h1><a name="policy_specification">Policy Specification</a></h1>

<h2><a name="available_parameters">1. About parameters which can be handled via policy</a></h2>

<p>Each entry in the policy has a keyword that specifies "operation", and can optionally have "conditional expressions".</p>

<p>It is possible to check parameters which can be represented as string data or numeric data using "conditional expressions".</p>

<h3><a name="string_expression">1.1. String parameters representation rule</a></h3>

<p>Parameters such as file's pathnames and command line arguments and environment variables are handled as string data.</p>

<p>All ASCII printable characters other than \ character (i.e. from 33 to 91 and from 93 to 126) are represented as is.</p>

<p>All other characters (i.e. from 0 to 32, 92 and from 127 to 255) are represented using \ooo style octal form.</p>

<table border="1">
<tr>
<td>
<table><tr><td></td><td>Lower 4 bits</td></tr><tr><td>Upper 4 bits</td><td></td></tr></table>
</td>
<th><p>0x0</p></th>
<th><p>0x1</p></th>
<th><p>0x2</p></th>
<th><p>0x3</p></th>
<th><p>0x4</p></th>
<th><p>0x5</p></th>
<th><p>0x6</p></th>
<th><p>0x7</p></th>
<th><p>0x8</p></th>
<th><p>0x9</p></th>
<th><p>0xA</p></th>
<th><p>0xB</p></th>
<th><p>0xC</p></th>
<th><p>0xD</p></th>
<th><p>0xE</p></th>
<th><p>0xF</p></th>
</tr>
<tr>
<th><p>0x0</p></th>
<td><p>\000</p></td>
<td><p>\001</p></td>
<td><p>\002</p></td>
<td><p>\003</p></td>
<td><p>\004</p></td>
<td><p>\005</p></td>
<td><p>\006</p></td>
<td><p>\007</p></td>
<td><p>\010</p></td>
<td><p>\011</p></td>
<td><p>\012</p></td>
<td><p>\013</p></td>
<td><p>\014</p></td>
<td><p>\015</p></td>
<td><p>\016</p></td>
<td><p>\017</p></td>
</tr>
<tr>
<th><p>0x1</p></th>
<td><p>\020</p></td>
<td><p>\021</p></td>
<td><p>\022</p></td>
<td><p>\023</p></td>
<td><p>\024</p></td>
<td><p>\025</p></td>
<td><p>\026</p></td>
<td><p>\027</p></td>
<td><p>\030</p></td>
<td><p>\031</p></td>
<td><p>\032</p></td>
<td><p>\033</p></td>
<td><p>\034</p></td>
<td><p>\035</p></td>
<td><p>\036</p></td>
<td><p>\037</p></td>
</tr>
<tr>
<th><p>0x2</p></th>
<td><p>\040</p></td>
<td><p>!</p></td>
<td><p>"</p></td>
<td><p>#</p></td>
<td><p>$</p></td>
<td><p>%</p></td>
<td><p>&amp;</p></td>
<td><p>'</p></td>
<td><p>(</p></td>
<td><p>)</p></td>
<td><p>*</p></td>
<td><p>+</p></td>
<td><p>,</p></td>
<td><p>-</p></td>
<td><p>.</p></td>
<td><p>/</p></td>
</tr>
<tr>
<th><p>0x3</p></th>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>:</p></td>
<td><p>;</p></td>
<td><p>&lt;</p></td>
<td><p>=</p></td>
<td><p>&gt;</p></td>
<td><p>?</p></td>
</tr>
<tr>
<th><p>0x4</p></th>
<td><p>@</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
<td><p>G</p></td>
<td><p>H</p></td>
<td><p>I</p></td>
<td><p>J</p></td>
<td><p>K</p></td>
<td><p>L</p></td>
<td><p>M</p></td>
<td><p>N</p></td>
<td><p>O</p></td>
</tr>
<tr>
<th><p>0x5</p></th>
<td><p>P</p></td>
<td><p>Q</p></td>
<td><p>R</p></td>
<td><p>S</p></td>
<td><p>T</p></td>
<td><p>U</p></td>
<td><p>V</p></td>
<td><p>W</p></td>
<td><p>X</p></td>
<td><p>Y</p></td>
<td><p>Z</p></td>
<td><p>[</p></td>
<td><p>\134</p></td>
<td><p>]</p></td>
<td><p>^</p></td>
<td><p>_</p></td>
</tr>
<tr>
<th><p>0x6</p></th>
<td><p>`</p></td>
<td><p>a</p></td>
<td><p>b</p></td>
<td><p>c</p></td>
<td><p>d</p></td>
<td><p>e</p></td>
<td><p>f</p></td>
<td><p>g</p></td>
<td><p>h</p></td>
<td><p>i</p></td>
<td><p>j</p></td>
<td><p>k</p></td>
<td><p>l</p></td>
<td><p>m</p></td>
<td><p>n</p></td>
<td><p>o</p></td>
</tr>
<tr>
<th><p>0x7</p></th>
<td><p>p</p></td>
<td><p>q</p></td>
<td><p>r</p></td>
<td><p>s</p></td>
<td><p>t</p></td>
<td><p>u</p></td>
<td><p>v</p></td>
<td><p>w</p></td>
<td><p>x</p></td>
<td><p>y</p></td>
<td><p>z</p></td>
<td><p>{</p></td>
<td><p>|</p></td>
<td><p>}</p></td>
<td><p>~</p></td>
<td><p>\177</p></td>
</tr>
<tr>
<th><p>0x8</p></th>
<td><p>\200</p></td>
<td><p>\201</p></td>
<td><p>\202</p></td>
<td><p>\203</p></td>
<td><p>\204</p></td>
<td><p>\205</p></td>
<td><p>\206</p></td>
<td><p>\207</p></td>
<td><p>\210</p></td>
<td><p>\211</p></td>
<td><p>\212</p></td>
<td><p>\213</p></td>
<td><p>\214</p></td>
<td><p>\215</p></td>
<td><p>\216</p></td>
<td><p>\217</p></td>
</tr>
<tr>
<th><p>0x9</p></th>
<td><p>\220</p></td>
<td><p>\221</p></td>
<td><p>\222</p></td>
<td><p>\223</p></td>
<td><p>\224</p></td>
<td><p>\225</p></td>
<td><p>\226</p></td>
<td><p>\227</p></td>
<td><p>\230</p></td>
<td><p>\231</p></td>
<td><p>\232</p></td>
<td><p>\233</p></td>
<td><p>\234</p></td>
<td><p>\235</p></td>
<td><p>\236</p></td>
<td><p>\237</p></td>
</tr>
<tr>
<th><p>0xA</p></th>
<td><p>\240</p></td>
<td><p>\241</p></td>
<td><p>\242</p></td>
<td><p>\243</p></td>
<td><p>\244</p></td>
<td><p>\245</p></td>
<td><p>\246</p></td>
<td><p>\247</p></td>
<td><p>\250</p></td>
<td><p>\251</p></td>
<td><p>\252</p></td>
<td><p>\253</p></td>
<td><p>\254</p></td>
<td><p>\255</p></td>
<td><p>\256</p></td>
<td><p>\257</p></td>
</tr>
<tr>
<th><p>0xB</p></th>
<td><p>\260</p></td>
<td><p>\261</p></td>
<td><p>\262</p></td>
<td><p>\263</p></td>
<td><p>\264</p></td>
<td><p>\265</p></td>
<td><p>\266</p></td>
<td><p>\267</p></td>
<td><p>\270</p></td>
<td><p>\271</p></td>
<td><p>\272</p></td>
<td><p>\273</p></td>
<td><p>\274</p></td>
<td><p>\275</p></td>
<td><p>\276</p></td>
<td><p>\277</p></td>
</tr>
<tr>
<th><p>0xC</p></th>
<td><p>\300</p></td>
<td><p>\301</p></td>
<td><p>\302</p></td>
<td><p>\303</p></td>
<td><p>\304</p></td>
<td><p>\305</p></td>
<td><p>\306</p></td>
<td><p>\307</p></td>
<td><p>\310</p></td>
<td><p>\311</p></td>
<td><p>\312</p></td>
<td><p>\313</p></td>
<td><p>\314</p></td>
<td><p>\315</p></td>
<td><p>\316</p></td>
<td><p>\317</p></td>
</tr>
<tr>
<th><p>0xD</p></th>
<td><p>\320</p></td>
<td><p>\321</p></td>
<td><p>\322</p></td>
<td><p>\323</p></td>
<td><p>\324</p></td>
<td><p>\325</p></td>
<td><p>\326</p></td>
<td><p>\327</p></td>
<td><p>\330</p></td>
<td><p>\331</p></td>
<td><p>\332</p></td>
<td><p>\333</p></td>
<td><p>\334</p></td>
<td><p>\335</p></td>
<td><p>\336</p></td>
<td><p>\337</p></td>
</tr>
<tr>
<th><p>0xE</p></th>
<td><p>\340</p></td>
<td><p>\341</p></td>
<td><p>\342</p></td>
<td><p>\343</p></td>
<td><p>\344</p></td>
<td><p>\345</p></td>
<td><p>\346</p></td>
<td><p>\347</p></td>
<td><p>\350</p></td>
<td><p>\351</p></td>
<td><p>\352</p></td>
<td><p>\353</p></td>
<td><p>\354</p></td>
<td><p>\355</p></td>
<td><p>\356</p></td>
<td><p>\357</p></td>
</tr>
<tr>
<th><p>0xF</p></th>
<td><p>\360</p></td>
<td><p>\361</p></td>
<td><p>\362</p></td>
<td><p>\363</p></td>
<td><p>\364</p></td>
<td><p>\365</p></td>
<td><p>\366</p></td>
<td><p>\367</p></td>
<td><p>\370</p></td>
<td><p>\371</p></td>
<td><p>\372</p></td>
<td><p>\373</p></td>
<td><p>\374</p></td>
<td><p>\375</p></td>
<td><p>\376</p></td>
<td><p>\377</p></td>
</tr>
</table>

<p>It is possible to use wildcards listed below in order to match string patterns.</p>

<table border="1">
<tr>
<th><p>Wildcard</p></th>
<th><p>Pattern match</p></th>
<th><p>Examples</p></th>
</tr>
<tr>
<td><p>\*</p></td>
<td><p>0 or more repetitions of characters other than "/"</p></td>
<td><p>/var/log/samba/\*</p></td>
</tr>
<tr>
<td><p>\@</p></td>
<td><p>0 or more repetitions of characters other than "/" or "."</p></td>
<td><p>/var/www/html/\@.html</p></td>
</tr>
<tr>
<td><p>\?</p></td>
<td><p>1 byte character other than "/"</p></td>
<td><p>/tmp/mail.\?\?\?\?\?\?</p></td>
</tr>
<tr>
<td><p>\$</p></td>
<td><p>1 or more repetitions of decimal digits</p></td>
<td><p>/proc/\$/cmdline</p></td>
</tr>
<tr>
<td><p>\+</p></td>
<td><p>1 decimal digit</p></td>
<td><p>/var/tmp/my_work.\+</p></td>
</tr>
<tr>
<td><p>\X</p></td>
<td><p>1 or more repetitions of hexadecimal digits</p></td>
<td><p>/var/tmp/my-work.\X</p></td>
</tr>
<tr>
<td><p>\x</p></td>
<td><p>1 hexadecimal digit</p></td>
<td><p>/tmp/my-work.\x</p></td>
</tr>
<tr>
<td><p>\A</p></td>
<td><p>1 or more repetitions of alphabet characters</p></td>
<td><p>/var/log/my-work/\$-\A-\$.log</p></td>
</tr>
<tr>
<td><p>\a</p></td>
<td><p>1 alphabet character</p></td>
<td><p>/home/users/\a/\*/public_html/\*.html</p></td>
</tr>
<tr>
<td><p>\-</p></td>
<td><p>Pathname subtraction operator (negative match)</p></td>
<td>
<p>/\*\-proc\-sys/</p>
<p>This will match /\*/ directories except "/proc/" and "/sys/".</p>
</td>
</tr>
<tr>
<td><p>/\{dir\}/</p></td>
<td><p>Recursive directory matching operator.</p>
<p>Matches "/" and 1 or more repetitions of "dir/".</p></td>
<td>
<p>/var/www/html/\{\*\}/</p>
<p>This will match all subdirectories under /var/www/html/ . Note that /var/www/html/ will not match.</p>
<br>
<p>/var/www/html/\{\*\}/\*.html</p>
<p>This will match all *.html files in subdirectories under /var/www/html/ . Note that /var/www/html/\*.html will not match.</p>
</td>
</tr>
</table>

<p>It is possible to group string data using "<a href="#string_comparison">string_group</a>" syntax.</p>

<h3><a name="numeric_expression">1.2. Numeric parameters representation rule</a></h3>

<p>Parameters such as user ID and process ID are handled as numeric data.</p>

<p>Decimal form, octal form and hexadecimal form are supported. Octal form is prefixed with 0 and Hexadecimal form is prefixed with 0x. For example, 010 in octal form is equivalent with 8 in decimal form, 0x10 in hexadecimal form is equivalent with 16 in decimal form.</p>

<p>Since numeric data is handled using C language's "unsigned long" type, minimal value is 0 and maximal value is 0xFFFFFFFF (for 32 bit environments) or 0xFFFFFFFFFFFFFFFF (for 64 bit environments).</p>

<p>It is possible to specify numeric data ranges in $min_value-$max_value form. If specifying in range, $min_value has to be smaller or equals to $max_value. For example, 0-100 is valid but 100-0 is invalid.</p>

<p>It is possible to group numeric data or numeric data range using "<a href="#integer_comparison">number_group</a>" syntax.</p>

<h3><a name="ipaddress_expression">1.3. IP address parameters representation rule</a></h3>

<p>It is possible to handle IPv4 address and IPv6 address. IPv4 address (32 bit) is represented using dot separated decimal form. and IPv6 address (128 bit) is represented using forms defined in RFC 2373.</p>

<p>It is possible to specify IP address ranges in $min_address-$max_address form. If specifying in range, $min_address has to be smaller or equals to $max_address. For example, 1.2.3.4-5.6.7.8 is valid but 5.6.7.8-1.2.3.4 is invalid.</p>

<p>It is possible to group IP address and IP address range using "<a href="#ipaddr_comparison">ip_group</a>" syntax.</p>

<h2><a name="conditions">2. About conditional expressions</a></h2>

<p>Valid conditions are determined by "operation". See <a href="#syntax_list">List of syntaxes sorted by operations</a> for "operation".</p>

<p>Some examples are shown below. Details of conditions are explained later.</p>

<table border="1">
<tr><td>Example of policy</td><td>Meaning</td></tr>
<tr><td>acl execute</td><td>Execution of any program</td></tr>
<tr><td>acl execute task.uid=0</td><td>Execution of any program by current thread's user ID is 0</td></tr>
<tr><td>acl execute task.uid=0 task.gid=0</td><td>Execution of any program by current thread's user ID and group ID are both 0</td></tr>
<tr><td>acl execute path="/bin/true"</td><td>Execution of any program where normalized pathname is /bin/true .</td></tr>
<tr><td>acl execute path="/bin/true" argv[1]="--help"</td><td>Execution of any program where normalized pathname is /bin/true and the first command line argument is --help</td></tr>
<tr><td>acl execute task.uid=0 path="/sbin/init"</td><td>Execution of any program where normalized pathname is /sbin/init by current thread's user ID is 0</td></tr>
</table>

<p>Basically conditions are omissible. But a few "operation" have mandatory conditions and parameters which controls behavior after policy matches. Such conditions/parameters are explained in individual topics.</p>

<h3><a name="string_comparison">2.1. Conditional expressions which handle string parameters</a></h3>

<p>Number of parameters which is represented as string data depends on "operation". For example, "read" operation has one and "rename" operation has two. Thus, the name of variables which references string data varies on "operation". Below description assumes that the name of variable is "path".</p>

<p>Comparison with string data is defined as below. Note that one string which ends with / and another string which does not end with / never matches.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "path"</td><td>Comparison result</td></tr>
<tr><td rowspan="6">path="/tmp/\*"</td>
<td>/</td><td>Does not match</td></tr>
<tr><td>/tmp/</td><td>Does not match</td></tr>
<tr><td>/tmp/rt6bh84t</td><td>Matches</td></tr>
<tr><td>/tmp/hbrt4768</td><td>Matches</td></tr>
<tr><td>/tmp/349gy08t/</td><td>Does not match</td></tr>
<tr><td>/tmp/349gy08t/y8024fgf</td><td>Does not match</td></tr>
<tr><td rowspan="6">path!="/tmp/\*"</td>
<td>/</td><td>Matches</td></tr>
<tr><td>/tmp/</td><td>Matches</td></tr>
<tr><td>/tmp/rt6bh84t</td><td>Does not match</td></tr>
<tr><td>/tmp/hbrt4768</td><td>Does not match</td></tr>
<tr><td>/tmp/349gy08t/</td><td>Matches</td></tr>
<tr><td>/tmp/349gy08t/y8024fgf</td><td>Matches</td></tr>
</table>

<p>If a string_group group named TMPDIR is defined as</p>

<table border="1">
<tr><td>
string_group TMPDIR /tmp/<br>
string_group TMPDIR /tmp/\*<br>
string_group TMPDIR /tmp/\{\*\}/<br>
string_group TMPDIR /tmp/\{\*\}/\*
</td></tr>
</table>

<p>it is possible to define conditions like below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "path"</td><td>Value of TMPDIR group</td><td>Comparison result</td></tr>
<tr><td rowspan="6">path=@TMPDIR</td>
<td>/</td><td rowspan="6">/tmp/<br>/tmp/\*<br>/tmp/\{\*\}/<br>/tmp/\{\*\}/\*</td><td>Does not match</td></tr>
<tr><td>/tmp/</td><td>Matches</td></tr>
<tr><td>/tmp/rt6bh84t</td><td>Matches</td></tr>
<tr><td>/tmp/hbrt4768</td><td>Matches</td></tr>
<tr><td>/tmp/349gy08t/</td><td>Matches</td></tr>
<tr><td>/tmp/349gy08t/y8024fgf</td><td>Matches</td></tr>
<tr><td rowspan="6">path!=@TMPDIR</td>
<td>/</td><td rowspan="6">/tmp/<br>/tmp/\*<br>/tmp/\{\*\}/<br>/tmp/\{\*\}/\*</td><td>Matches</td></tr>
<tr><td>/tmp/</td><td>Does not match</td></tr>
<tr><td>/tmp/rt6bh84t</td><td>Does not match</td></tr>
<tr><td>/tmp/hbrt4768</td><td>Does not match</td></tr>
<tr><td>/tmp/349gy08t/</td><td>Does not match</td></tr>
<tr><td>/tmp/349gy08t/y8024fgf</td><td>Does not match</td></tr>
</table>

<p>See <a href="#syntax_list">List of syntaxes sorted by operations</a> for name of variables that handle string data.</p>

<h3><a name="integer_comparison">2.2. Conditional expressions which handle numeric parameters</a></h3>

<p>Number of parameters which is represented as numeric data depends on "operation". For example, "create" operation has one and "mkblock" operation has three. Thus, the name of variables which references numeric parameters varies on "operation". Below description uses "task.uid" (which references current thread's user ID) and "task.gid" (which references current thread's group ID) as an example.</p>

<p>Comparison with numeric value is defined as below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "task.uid"</td><td>Comparison result</td></tr>
<tr><td rowspan="3">task.uid=0</td>
<td>0</td><td>Matches</td></tr>
<tr><td>100</td><td>Does not match</td></tr>
<tr><td>500</td><td>Does not match</td></tr>
<tr><td rowspan="3">task.uid!=0</td>
<td>0</td><td>Does not match</td></tr>
<tr><td>100</td><td>Matches</td></tr>
<tr><td>500</td><td>Matches</td></tr>
</table>

<p>Comparison with numeric value range is defined as below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "task.gid"</td><td>Comparison result</td></tr>
<tr><td rowspan="3">task.gid=0-100</td>
<td>0</td><td>Matches</td></tr>
<tr><td>100</td><td>Matches</td></tr>
<tr><td>500</td><td>Does not match</td></tr>
<tr><td rowspan="3">task.gid!=0-100</td><td>0</td><td>Does not match</td></tr>
<tr><td>100</td><td>Does not match</td></tr>
<tr><td>500</td><td>Matches</td></tr>
</table>

<p>It is possible to compare one variable which references numeric value with another variable which references numeric value.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "task.uid"</td><td>Value of variable "task.gid"</td><td>Comparison result</td></tr>
<tr><td rowspan="4">task.uid=task.gid</td>
<td>0</td><td>0</td><td>Matches</td></tr>
<tr><td>0</td><td>100</td><td>Does not match</td></tr>
<tr><td>100</td><td>0</td><td>Does not match</td></tr>
<tr><td>100</td><td>100</td><td>Matches</td></tr>
<tr><td rowspan="4">task.uid!=task.gid</td>
<td>0</td><td>0</td><td>Does not match</td></tr>
<tr><td>0</td><td>100</td><td>Matches</td></tr>
<tr><td>100</td><td>0</td><td>Matches</td></tr>
<tr><td>100</td><td>100</td><td>Does not match</td></tr>
</table>

<p>If a number_group group named ID_GROUP is defined as</p>

<table border="1">
<tr><td>
number_group ID_GROUP 100<br>
number_group ID_GROUP 200-500
</td></tr>
</table>

<p>it is possible to define conditions like below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "task.uid"</td><td>Values in ID_GROUP group</td><td>Comparison result</td></tr>
<tr><td rowspan="4">task.uid=@ID_GROUP</td>
<td>0</td><td rowspan="4">100<br>200-500</td><td>Does not match</td></tr>
<tr><td>100</td><td>Matches</td></tr>
<tr><td>500</td><td>Matches</td></tr>
<tr><td>1000</td><td>Does not match</td></tr>
<tr><td rowspan="4">task.uid!=@ID_GROUP</td>
<td>0</td><td rowspan="4">100<br>200-500</td><td>Matches</td></tr>
<tr><td>100</td><td>Does not match</td></tr>
<tr><td>500</td><td>Does not match</td></tr>
<tr><td>1000</td><td>Matches</td></tr>
</table>

<p>See <a href="#syntax_list">List of syntaxes sorted by operations</a> for name of variables that handle numeric data.</p>

<h3><a name="ipaddr_comparison">2.3. Conditional expressions which handle IP address parameters</a></h3>

<p>Any "operation" which handles IPv4/IPv6 network address can check IP address using variable "ip".</p>

<p>Comparison with IP address value is defined as below. Note that comparison between an IPv4 address and an IPv6 address does not match.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "ip"</td><td>Comparison result</td></tr>
<tr><td rowspan="4">ip=127.0.0.1</td><td>127.0.0.1</td><td>Matches</td></tr>
<tr><td>0.0.0.0</td><td>Does not match</td></tr>
<tr><td>::1</td><td>Does not match</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td rowspan="4">ip!=127.0.0.1</td><td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>0.0.0.0</td><td>Matches</td></tr>
<tr><td>::1</td><td>Does not match</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td rowspan="4">ip=::1</td><td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>0.0.0.0</td><td>Does not match</td></tr>
<tr><td>::1</td><td>Matches</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td rowspan="4">ip!=::1</td><td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>0.0.0.0</td><td>Does not match</td></tr>
<tr><td>::1</td><td>Does not match</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Matches</td></tr>
</table>

<p>Comparison with IP address range is defined as below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "ip"</td><td>Comparison result</td></tr>
<tr><td rowspan="3">ip=127.0.0.0-127.255.255.255</td>
<td>127.0.0.1</td><td>Matches</td></tr>
<tr><td>10.0.0.1</td><td>Does not match</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td rowspan="3">ip!=127.0.0.0-127.255.255.255</td>
<td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>10.0.0.1</td><td>Matches</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td rowspan="3">ip=::-::1</td><td>::ffff:127.0.0.1</td><td>Does not match</td></tr>
<tr><td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>::1</td><td>Matches</td></tr>
<tr><td rowspan="3">ip!=::-::1</td><td>::ffff:127.0.0.1</td><td>Matches</td></tr>
<tr><td>127.0.0.1</td><td>Does not match</td></tr>
<tr><td>::1</td><td>Does not match</td></tr>
</table>

<p>If an ip_group group named PRIVATE_ADDRESS is defined as</p>

<table border="1">
<tr><td>
ip_group PRIVATE_ADDRESS 10.0.0.0-10.255.255.255<br>
ip_group PRIVATE_ADDRESS 172.16.0.0-172.31.255.255<br>
ip_group PRIVATE_ADDRESS 192.168.0.0-192.168.255.255<br>
ip_group PRIVATE_ADDRESS fd00::-fdff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
</td></tr>
</table>

<p>it is possible to define conditions like below.</p>

<table border="1">
<tr><td>Conditions example</td><td>Value of variable "ip"</td><td>Values in PRIVATE_ADDRESS group</td><td>Comparison result</td></tr>
<tr><td rowspan="5">ip=@PRIVATE_ADDRESS</td>
<td>127.0.0.1</td><td rowspan="5">10.0.0.0-10.255.255.255<br>172.16.0.0-172.31.255.255<br>192.168.0.0-192.168.255.255<br>fd00::-fdff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</td><td>Does not match</td></tr>
<tr><td>10.0.0.1</td><td>Matches</td></tr>
<tr><td>192.168.0.1</td><td>Matches</td></tr>
<tr><td>::ffff:172.16.0.1</td><td>Does not match</td></tr>
<tr><td>fd01::</td><td>Matches</td></tr>
<tr><td rowspan="5">ip!=@PRIVATE_ADDRESS</td><td>127.0.0.1</td><td rowspan="5">10.0.0.0-10.255.255.255<br>172.16.0.0-172.31.255.255<br>192.168.0.0-192.168.255.255<br>fd00::-fdff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</td><td>Matches</td></tr>
<tr><td>10.0.0.1</td><td>Does not match</td></tr>
<tr><td>::ffff:192.168.0.1</td><td>Matches</td></tr>
<tr><td>::ffff:127.0.0.1</td><td>Matches</td></tr>
<tr><td>fd01::</td><td>Does not match</td></tr>
</table>

<p>See <a href="#syntax_list">List of syntaxes sorted by operations</a> for operations that can handle IP address.</p>

<h3><a name="task_attributes_comparison">2.4. Conditional expressions which handle current thread's attributes</a></h3>

<p>It is possible to use current thread's attributes as part of conditions. Below variables are always available.</p>

<table border="1">
<tr><td>Variable's name</td><td>Comparison method</td><td>Meaning</td><td></td></tr>
<tr><td>task.uid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's user ID</td></tr>
<tr><td>task.gid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's group ID</td></tr>
<tr><td>task.euid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's effective user ID</td></tr>
<tr><td>task.egid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's effective group ID</td></tr>
<tr><td>task.suid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's saved user ID</td></tr>
<tr><td>task.sgid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's saved group ID</td></tr>
<tr><td>task.fsuid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's filesystem user ID</td></tr>
<tr><td>task.fsgid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's filesystem group ID</td></tr>
<tr><td>task.pid</td><td><a href="#integer_comparison">Numeric</a></td><td>Current thread's process ID </td></tr>
<tr><td>task.ppid</td><td><a href="#integer_comparison">Numeric</a></td><td>Process ID of current thread's parent process</td></tr>
<tr><td>task.exe</td><td><a href="#string_comparison">String</a></td><td>Current thread's program name (the content of /proc/self/exe)</td></tr>
<tr><td>task.domain</td><td><a href="#string_comparison">String</a></td><td>Current thread's domainname (the content of /proc/ccs/self_domain)</td></tr>
<tr><td>task.type</td><td>Literal</td><td>Matches execute_handler if running as an execute handler, does not match execute_handler otherwise</td></tr>
</table>

<h3><a name="argv_comparison">2.5. Conditional expressions which handle command line arguments</a></h3>

<p>It is possible to check command line arguments (a.k.a. argv[]) when checking permissions for program execution.</p>

<table border="1">
<tr><td>Conditions example</td><td>Comparison method</td><td>Meaning</td><td></td></tr>
<tr><td>argv[0]="true"</td><td><a href="#string_comparison">String</a></td><td>argv[0] matches "true"</td></tr>
<tr><td>argv[0]!="false"</td><td><a href="#string_comparison">String</a></td><td>argv[0] does not match "false"</td></tr>
<tr><td>argv[1]=@ARGV1_GROUPS</td><td><a href="#string_comparison">String</a></td><td>argv[0] matches one of strings in string_group ARGV1_GROUPS group</td></tr>
<tr><td>argv[1]!=@ARGV1_GROUPS</td><td><a href="#string_comparison">String</a></td><td>argv[0] matches none of strings in string_group ARGV1_GROUPS group</td></tr>
</table>

<p>Applications can pass a string data up to 32 * PAGE_SIZE bytes to each argv[]. But due to difficulty of allocating contiguous memory in the kernel, only up to 4085 bytes can be checked using variable "argv[$index]". If you want to check strictly, please consider using handler= argument of "allow " lines in "acl execute" block.</p>

<h3><a name="envp_comparison">2.6. Conditional expressions which handle environment variable arguments</a></h3>

<p>It is possible to check environment variables (a.k.a. envp[]) when checking permissions for program execution.</p>

<table border="1">
<tr><td>Conditions example</td><td>Comparison method</td><td>Meaning</td><td></td></tr>
<tr><td>envp["PATH"]="/"</td><td><a href="#string_comparison">String</a></td><td>Environment variable PATH is defined and its value is "/"</td></tr>
<tr><td>envp["PATH"]!="/"</td><td><a href="#string_comparison">String</a></td><td>Either<br>&nbsp;&nbsp;&nbsp;&nbsp;Environment variable PATH is not defined<br>or<br>&nbsp;&nbsp;&nbsp;&nbsp;Environment variable PATH is defined but its value is not "/"</td></tr>
<tr><td>envp["PATH"]=@ENV_PATH_VALUES"/"</td><td><a href="#string_comparison">String</a></td><td>Environment variable PATH is defined and its value matches one of strings in string_group ENVP_PATH_VALUES group</td></tr>
<tr><td>envp["PATH"]!=@ENV_PATH_VALUES"/"</td><td><a href="#string_comparison">String</a></td><td>Either<br>&nbsp;&nbsp;&nbsp;&nbsp;Environment variable PATH is not defined<br>or<br>&nbsp;&nbsp;&nbsp;&nbsp;Environment variable PATH is defined but its value matches none of strings in string_group ENVP_PATH_VALUES group</td></tr>
<tr><td>envp["PATH"]=NULL</td><td>None</td><td>Environment variable PATH is not defined</td></tr>
<tr><td>envp["PATH"]!=NULL</td><td>None</td><td>Environment variable PATH is not defined</td></tr>
</table>

<p>Applications can pass a string data up to 32 * PAGE_SIZE bytes to each envp[]. But due to difficulty of allocating contiguous memory in the kernel, only up to 4085 bytes can be checked using variable "envp["$name"]". If you want to check strictly, please consider using handler= argument of "allow " lines in "acl execute" block.</p>

<h3><a name="dac_permission_comparison">2.7. Conditional expressions which handle file's DAC permissions</a></h3>

<p>When checking permissions for file related operations, it is possible to check its DAC permissions if the file already exists as of permission check.
Below table assumes that the variable name for referencing the requested pathname is "path".</p>

<p>Value of DAC permissions can be referenced using variable "path.perm", and its value is between 0 and 07777. Although it is possible to do normal <a href="#integer_comparison">numeric comparison</a>, below constants are provided in order to make it easier to compare whether specific bit is set or not.</p>

<table border="1">
<tr><td>Constant</td><td>Value ranges that match </td></tr>
<tr><td>setuid</td><td>Values where bitwise AND between path.perm and 04000 are 04000. (i.e. 04000-07777)</td></tr>
<tr><td>setgid</td><td>Values where bitwise AND between path.perm and 02000 are 02000. (i.e. 02000-03777 06000-07777)</td></tr>
<tr><td>sticky</td><td>Values where bitwise AND between path.perm and 01000 are 01000. (i.e. 01000-01777 03000-03777 05000-05777 07000-07777)</td></tr>
<tr><td>owner_read</td><td>Values where bitwise AND between path.perm and 00400 are 00400. (e.g. 00400-00777 01400-01777 02400-02777)</td></tr>
<tr><td>owner_write</td><td>Values where bitwise AND between path.perm and 00200 are 00200. (e.g. 00200-00377 00600-00777 01200-01377)</td></tr>
<tr><td>owner_execute</td><td>Values where bitwise AND between path.perm and 00100 are 00100. (e.g. 00100-00177 00300-00377 00500-00577)</td></tr>
<tr><td>group_read</td><td>Values where bitwise AND between path.perm and 00040 are 00040. (e.g. 00040-00077 00140-00177 00240-00277)</td></tr>
<tr><td>group_write</td><td>Values where bitwise AND between path.perm and 00020 are 00020. (e.g. 00020-00037 00060-00077 00120-00137)</td></tr>
<tr><td>group_execute</td><td>Values where bitwise AND between path.perm and 00010 are 00010. (e.g. 00010-00017 00030-00037 00050-00057)</td></tr>
<tr><td>others_read</td><td>Values where bitwise AND between path.perm and 00004 are 00004. (e.g. 00004-00007 00014-00017 00024-00027)</td></tr>
<tr><td>others_write</td><td>Values where bitwise AND between path.perm and 00002 are 00002. (e.g. 00002-00003 00006-00007 00012-00013)</td></tr>
<tr><td>others_execute</td><td>Values where bitwise AND between path.perm and 00001 are 00001. (e.g. 00001 00003 00005 00007 00011 00013)</td></tr>
</table>

<p>Below are some examples that use constants.</p>

<table border="1">
<tr><td>Conditions example</td><td>Permissions of file referenced by variable "path"</td><td>Comparison result</td></tr>
<tr><td>path.perm=setuid</td><td>04755</td><td>Matches</td></tr>
<tr><td>path.perm!=setuid</td><td>04755</td><td>Does not match</td></tr>
<tr><td>path.perm=setuid path.perm=setgid path.perm=sticky</td><td>0755</td><td>Does not match</td></tr>
<tr><td>path.perm!=setuid path.perm!=setgid path.perm!=sticky</td><td>0755</td><td>Matches</td></tr>
</table>

<h3><a name="file_type_comparison">2.8. Conditional expressions which handle file's type</a></h3>

<p>When checking permissions for file related operations, it is possible to check its type if the file already exists as of permission check.
Below table assumes that the variable name for referencing the requested pathname is "path".</p>

<p>Type of a file can be referenced using variable "path.type", and its value takes one of "file", "directory", "socket", "fifo", "block", "char", "symlink".</p>

<table border="1">
<tr><td>Possible conditions</td><td>Type of file referenced by variable "path"</td><td>Comparison result</td></tr>
<tr><td>path.type=file</td><td>Regular file</td><td>Matches</td></tr>
<tr><td>path.type!=file</td><td>Other than regular file</td><td>Matches</td></tr>
<tr><td>path.type=directory</td><td>Directory</td><td>Matches</td></tr>
<tr><td>path.type!=directory</td><td>Other than directory</td><td>Matches</td></tr>
<tr><td>path.type=socket</td><td>Unix domain socket</td><td>Matches</td></tr>
<tr><td>path.type!=socket</td><td>Other than Unix domain socket</td><td>Matches</td></tr>
<tr><td>path.type=fifo</td><td>FIFO</td><td>Matches</td></tr>
<tr><td>path.type!=fifo</td><td>Other than FIFO</td><td>Matches</td></tr>
<tr><td>path.type=block</td><td>Block device file</td><td>Matches</td></tr>
<tr><td>path.type!=block</td><td>Other than block device file</td><td>Matches</td></tr>
<tr><td>path.type=char</td><td>Character device file</td><td>Matches</td></tr>
<tr><td>path.type!=char</td><td>Other than character device file</td><td>Matches</td></tr>
<tr><td>path.type=symlink</td><td>Symbolic link</td><td>Matches</td></tr>
<tr><td>path.type!=symlink</td><td>Other than symbolic link</td><td>Matches</td></tr>
</table>

<h3><a name="file_attributes_comparison">2.9. Conditional expressions which handle file's attributes</a></h3>

<p>When checking permissions for file related operations, it is possible to check its attributes if the file already exists as of permission check.
Below table assumes that the variable name for referencing the requested pathname is "path".</p>

<table border="1">
<tr><td>Variable's name</td><td>Comparison method</td><td>Meaning</td></tr>
<tr><td>path.uid</td><td><a href="#integer_comparison">Numeric</a></td><td>Owner ID</td></tr>
<tr><td>path.gid</td><td><a href="#integer_comparison">Numeric</a></td><td>Group ID</td></tr>
<tr><td>path.ino</td><td><a href="#integer_comparison">Numeric</a></td><td>i-node number on the filesystem</td></tr>
<tr><td>path.major</td><td><a href="#integer_comparison">Numeric</a></td><td>Device major number on the filesystem</td></tr>
<tr><td>path.minor</td><td><a href="#integer_comparison">Numeric</a></td><td>Device minor number on the filesystem</td></tr>
<tr><td>path.perm</td><td><a href="#dac_permission_comparison">Permission</a></td><td>DAC permissions</td></tr>
<tr><td>path.type</td><td><a href="#file_type_comparison">File's type</a></td><td>Type of the file</td></tr>
<tr><td>path.dev_major</td><td><a href="#integer_comparison">Numeric</a></td><td>Device major number of the file if path.type=block or path.type=char</td></tr>
<tr><td>path.dev_minor</td><td><a href="#integer_comparison">Numeric</a></td><td>Device minor number of the file if path.type=block or path.type=char</td></tr>
<tr><td>path.fsmagic</td><td><a href="#integer_comparison">Numeric</a></td><td>Magic number of filesystem</td></tr>
</table>

<p>When checking permissions for file related operations, it is possible to also check its parent directory's attributes.
Below table assumes that the variable name for referencing the requested pathname is "path".</p>

<table border="1">
<tr><td>Variable's name</td><td>Comparison method</td><td>Meaning</td></tr>
<tr><td>path.parent.uid</td><td><a href="#integer_comparison">Numeric</a></td><td>Owner ID</td></tr>
<tr><td>path.parent.gid</td><td><a href="#integer_comparison">Numeric</a></td><td>Group ID</td></tr>
<tr><td>path.parent.ino</td><td><a href="#integer_comparison">Numeric</a></td><td>i-node number on the filesystem</td></tr>
<tr><td>path.parent.major</td><td><a href="#integer_comparison">Numeric</a></td><td>Device major number on the filesystem</td></tr>
<tr><td>path.parent.minor</td><td><a href="#integer_comparison">Numeric</a></td><td>Device minor number on the filesystem</td></tr>
<tr><td>path.parent.perm</td><td><a href="#dac_permission_comparison">Permission</a></td><td>DAC permissions</td></tr>
<tr><td>path.parent.fsmagic</td><td><a href="#integer_comparison">Numeric</a></td><td>Magic number of filesystem</td></tr>
</table>

<p>It does not make sense to use path.parent.type path.parent.dev_major path.parent.dev_minor because path.parent is always a directory.</p>

<h2><a name="syntax_list">3. List of syntaxes sorted by operations</a></h2>

<table border="1">
<tr><td>Operation</td><td>Meaning</td><td>Available variables</td><td>Content of variable</td><td>Related man pages</td></tr>

<tr><td rowspan="11">execute</td><td rowspan="11">Execute a program</td><td><a href="#string_comparison">path</a></td><td>Requested program's pathname</td><td rowspan="11">execve(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>
<tr><td><a href="#string_comparison">exec</a></td><td>Requested program's pathname, but maybe a symbolic link</td></tr>
<tr><td><a href="#integer_comparison">argc</a></td><td>Number of command line arguments passed to this request</td></tr>
<tr><td><a href="#integer_comparison">envc</a></td><td>Number of environment variables arguments</td></tr>
<tr><td><a href="#argv_comparison">argv[$index]</a></td><td>$index'th (0 &lt;= $index &lt; argc) value of command line arguments</td></tr>
<tr><td><a href="#envp_comparison">envp["$name"]</a></td><td>Value of environment variable named $name</td></tr>
<tr><td>handler</td><td>Pathname of a wrapper program for preprocessing (available to only "allow" lines)</td></tr>
<tr><td>transition</td><td>New domainname to transit to if operation was successful (available to only "allow" lines)</td></tr>

<tr><td rowspan="4">read</td><td rowspan="4">Open a pathname for reading</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">open(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">write</td><td rowspan="4">Open a pathname for writing</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">open(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">append</td><td rowspan="4">Open a pathname for appending</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">open(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">create</td><td rowspan="4">Create a regular file</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">open(2), mknod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">unlink</td><td rowspan="4">Delete a non directory pathname</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">unlink(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">getattr</td><td rowspan="4">Get attributes of a pathname</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">stat(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">mkdir</td><td rowspan="4">Create a directory</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">mkdir(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">rmdir</td><td rowspan="4">Delete a directory pathname</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">rmdir(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">mkfifo</td><td rowspan="4">Create a FIFO</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">mknod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">mksock</td><td rowspan="4">Create a Unix domain socket</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">mknod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">truncate</td><td rowspan="4">Truncate a regular file</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">open(2), truncate(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">symlink</td><td rowspan="4">Create a  symbolic link</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">symlink(2)</td></tr>
<tr><td><a href="#string_comparison">target</a></td><td>Symbolic link's content</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="6">mkblock</td><td rowspan="6">Create a block device file</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="6">mknod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#integer_comparison">dev_major</a></td><td>Major device number of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#integer_comparison">dev_minor</a></td><td>Minor device number of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="6">mkchar</td><td rowspan="6">Create a character device file</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="6">mknod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>DAC permissions of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#integer_comparison">dev_major</a></td><td>Major device number of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#integer_comparison">dev_minor</a></td><td>Minor device number of a new object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="6">link</td><td rowspan="6">Create a link</td><td><a href="#string_comparison">old_path</a></td><td>Link source's pathname</td><td rowspan="6">link(2)</td></tr>
<tr><td><a href="#string_comparison">new_path</a></td><td>Link target's pathname</td></tr>
<tr><td><a href="#file_attributes_comparison">old_path.$attribute</a></td><td>Attributes of an object referenced by variable "old_path"</td></tr>
<tr><td><a href="#file_attributes_comparison">old_path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#file_attributes_comparison">new_path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="6">rename</td><td rowspan="6">Rename a pathname</td><td><a href="#string_comparison">old_path</a></td><td>Old pathname</td><td rowspan="6">rename(2)</td></tr>
<tr><td><a href="#string_comparison">new_path</a></td><td>New pathname</td></tr>
<tr><td><a href="#file_attributes_comparison">old_path.$attribute</a></td><td>Attributes of an object referenced by variable "old_path"</td></tr>
<tr><td><a href="#file_attributes_comparison">old_path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#file_attributes_comparison">new_path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="5">chmod</td><td rowspan="5">Change DAC's permission</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="5">chmod(2)</td></tr>
<tr><td><a href="#integer_comparison">perm</a></td><td>New DAC permissions of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="5">chown</td><td rowspan="5">Change DAC's owner ID</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="5">chown(2)</td></tr>
<tr><td><a href="#integer_comparison">uid</a></td><td>New DAC owner ID of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="5">chgrp</td><td rowspan="5">Change DAC's group ID</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="5">chown(2)</td></tr>
<tr><td><a href="#integer_comparison">gid</a></td><td>New DAC group ID of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="5">ioctl</td><td rowspan="5">Use ioctl request</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="5">ioctl(2)</td></tr>
<tr><td><a href="#integer_comparison">cmd</a></td><td>Command number for ioctl request</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="4">chroot</td><td rowspan="4">Change root directory</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="4">chroot(2)</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="9">mount</td><td rowspan="9">Mount a filesystem</td><td><a href="#string_comparison">source</a></td><td>Device name if mount operation requires device file, source name if bind or move mount.</td><td rowspan="9">mount(2)</td></tr>
<tr><td><a href="#string_comparison">target</a></td><td>Mount point</td></tr>
<tr><td><a href="#string_comparison">fstype</a></td><td>Filesystem name</td></tr>
<tr><td><a href="#integer_comparison">flags</a></td><td>Mount flags</td></tr>
<tr><td><a href="#file_attributes_comparison">source.$attribute</a></td><td>Attributes of an object referenced by variable "source" when variable "source" references a valid pathname</td></tr>
<tr><td><a href="#file_attributes_comparison">source.parent.$attribute</a></td><td>Attributes of parent directory of an object referenced by variable "source" when variable "source" references a valid pathname</td></tr>
<tr><td><a href="#file_attributes_comparison">target.$attribute</a></td><td>Attributes of an object referenced by variable "target"</td></tr>
<tr><td><a href="#file_attributes_comparison">target.parent.$attribute</a></td><td>Attributes of parent directory of an object referenced by variable "target"</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="5">unmount</td><td rowspan="5">Unmount a filesystem</td><td><a href="#string_comparison">path</a></td><td>Requested pathname</td><td rowspan="5">umount(2)</td></tr>
<tr><td><a href="#integer_comparison">flags</a></td><td>Unmount flags</td></tr>
<tr><td><a href="#file_attributes_comparison">path.$attribute</a></td><td>Attributes of an object referenced by variable "path"</td></tr>
<tr><td><a href="#file_attributes_comparison">path.parent.$attribute</a></td><td>Parent directory's attributes</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="7">pivot_root</td><td rowspan="7">Exchange root directory</td><td><a href="#string_comparison">new_root</a></td><td>New root directory</td><td rowspan="7">pivot_root(2)</td></tr>
<tr><td><a href="#string_comparison">put_old</a></td><td>Location to place old root directory</td></tr>
<tr><td><a href="#file_attributes_comparison">new_root.$attribute</a></td><td>Attributes of an object referenced by variable "new_root"</td></tr>
<tr><td><a href="#file_attributes_comparison">new_root.parent.$attribute</a></td><td>Attributes of parent directory of an object referenced by variable "new_root"</td></tr>
<tr><td><a href="#file_attributes_comparison">put_old.$attribute</a></td><td>Attributes of an object referenced by variable "put_old"</td></tr>
<tr><td><a href="#file_attributes_comparison">put_old.parent.$attribute</a></td><td>Attributes of parent directory of an object referenced by variable "put_old"</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_stream_bind</td><td rowspan="3">Binding PF_INET/PF_INET6+SOCK_STREAM socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">bind(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_stream_listen</td><td rowspan="3">Listening PF_INET/PF_INET6+SOCK_STREAM socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">listen(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_stream_connect</td><td rowspan="3">Connecting PF_INET/PF_INET6+SOCK_STREAM socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">connect(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_stream_accept</td><td rowspan="3">Accepting PF_INET/PF_INET6+SOCK_STREAM socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">accept(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_dgram_bind</td><td rowspan="3">Binding PF_INET/PF_INET6+SOCK_DGRAM socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">bind(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_dgram_send</td><td rowspan="3">Sending AF_INET/AF_INET6 datagrams</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">sendmsg(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_dgram_recv</td><td rowspan="3">Receiving AF_INET/AF_INET6 datagrams</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">recvmsg(2), ip(7), ipv6(7)</td></tr>
<tr><td><a href="#integer_comparison">port</a></td><td>Port number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_raw_bind</td><td rowspan="3">Binding PF_INET/PF_INET6+SOCK_RAW socket</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">bind(2), raw(7)</td></tr>
<tr><td><a href="#integer_comparison">proto</a></td><td>Protocol number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_raw_send</td><td rowspan="3">Sending AF_INET/AF_INET6 packets</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">sendmsg(2), raw(7)</td></tr>
<tr><td><a href="#integer_comparison">proto</a></td><td>Protocol number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">inet_raw_recv</td><td rowspan="3">Receiving AF_INET/AF_INET6 packets</td><td><a href="#ipaddr_comparison">ip</a></td><td>IPv4 or IPv6 address</td><td rowspan="3">recvmsg(2), raw(7)</td></tr>
<tr><td><a href="#integer_comparison">proto</a></td><td>Protocol number</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_stream_bind</td><td rowspan="2">Binding PF_UNIX+SOCK_STREAM socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">bind(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_stream_listen</td><td rowspan="2">Listening PF_UNIX+SOCK_STREAM socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">listen(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_stream_connect</td><td rowspan="2">Connecting PF_UNIX+SOCK_STREAM socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">connect(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_stream_accept</td><td rowspan="2">Accepting PF_UNIX+SOCK_STREAM socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">accept(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_dgram_bind</td><td rowspan="2">Binding PF_UNIX+SOCK_DGRAM socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">bind(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_dgram_send</td><td rowspan="2">Sending AF_UNIX datagrams</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">sendmsg(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_dgram_recv</td><td rowspan="2">Receiving AF_UNIX datagrams</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">recvmsg(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_seqpacket_bind</td><td rowspan="2">Binding PF_UNIX+SOCK_SEQPACKET socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">bind(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_seqpacket_listen</td><td rowspan="2">Listening PF_UNIX+SOCK_SEQPACKET socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">listen(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_seqpacket_connect</td><td rowspan="2">Connecting PF_UNIX+SOCK_SEQPACKET socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">connect(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">unix_seqpacket_accept</td><td rowspan="2">Accepting PF_UNIX+SOCK_SEQPACKET socket</td><td><a href="#string_comparison">addr</a></td><td>Unix domain socket address</td><td rowspan="2">accept(2), unix(7)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">ptrace</td><td rowspan="3">Call ptrace() system call</td><td><a href="#integer_comparison">cmd</a></td><td>Command number</td><td rowspan="3">ptrace(2)</td></tr>
<tr><td><a href="#string_comparison">domain</a></td><td>Target process's domainname</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">signal</td><td rowspan="2">Send signals</td><td><a href="#integer_comparison">sig</a></td><td>Signal number</td><td rowspan="2">kill(2), tkill(2), tgkill(2), rt_sigqueueinfo(2)</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="3">environ</td><td rowspan="3">Receive environment variables upon program execution</td><td><a href="#string_comparison">name</a></td><td>Environment variable's name</td><td rowspan="3">execve(2)</td></tr>
<tr><td><a href="#string_comparison">value</a></td><td>Environment variable's value</td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="1">modify_policy</td><td rowspan="1">Modify policy configuration</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1"></td></tr>

<tr><td rowspan="1">use_netlink_socket</td><td rowspan="1">Create PF_NETLINK socket</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">socket(2), netlink(7)</td></tr>

<tr><td rowspan="1">use_packet_socket</td><td rowspan="1">Create PF_PACKET socket</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">socket(2), packet(7)</td></tr>

<tr><td rowspan="1">use_reboot</td><td rowspan="1">Call reboot() system call</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">reboot(2)</td></tr>

<tr><td rowspan="1">use_vhangup</td><td rowspan="1">Call vhangup() system call</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">vhangup(2)</td></tr>

<tr><td rowspan="1">set_time</td><td rowspan="1">Set system's time</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">stime(2), settimeofday(2), adjtimex(2)</td></tr>

<tr><td rowspan="1">set_priority</td><td rowspan="1">Change process's priority</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">nice(2), setpriority(2)</td></tr>

<tr><td rowspan="1">set_hostname</td><td rowspan="1">Set host's name</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">sethostname(2), setdomainname(2)</td></tr>

<tr><td rowspan="1">use_kernel_module</td><td rowspan="1">Load or unload kernel modules</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">init_module(2), delete_module(2)</td></tr>

<tr><td rowspan="1">use_new_kernel</td><td rowspan="1">Load a new kernel</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="1">kexec_load(2)</td></tr>

<tr><td rowspan="2">manual_domain_transition</td><td rowspan="2">Change domains by writing to /proc/ccs/self_domain</td><td><a href="#string_comparison">domain</a></td><td>Domainname to allow transition to </td><td rowspan="2"></td></tr>
<tr><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td></tr>

<tr><td rowspan="2">auto_domain_transition</td><td rowspan="2">Change domains automatically upon conditions are met</td><td><a href="#task_attributes_comparison">task.$attribute</a></td><td>Current thread's attributes</td><td rowspan="2"></td></tr>
<tr><td>transition</td><td>New domainname to transit to if conditions are met (available to only "allow" lines)</td></tr>

</table>

<h2><a name="policy_syntaxes">4. Policy syntaxes</a></h2>

<h3><a name="policy_structure_definition">4.1. Definition</a></h3>

<p>Policy consists with two parts.</p>

<p>Header part defines below lines.</p>

<table border="1">
<tr><td>
POLICY_VERSION=20100903<br>
quota memory policy $max_byte_for_policy<br>
quota memory audit $max_byte_for_audit_logs<br>
quota memory query $max_byte_for_query<br>
quota audit[$audit_index] allowed=$max_logs_for_allowed_request unmatched=$max_logs_for_unmatched_request denied=$max_logs_for_denied_request<br>
string_group $string_group_name $string_group_member<br>
number_group $number_group_name $number_group_member<br>
ip_group $ip_group_name $ip_group_member<br>
</td></tr>
</table>

<ul>
<li>POLICY_VERSION line defines policy version.</li>
<li>$max_byte_for_policy is max amount of memory in byte which can be allocated for policy. Default is unlimited.</li>
<li>$max_byte_for_audit_logs is max amount of memory in byte which can be allocated for audit logs. Default is unlimited. $max_byte_for_audit_logs=16777216 should be sufficient.</li>
<li>$max_byte_for_query is max amount of memory in byte which can be allocated for interactive enforcement. Default is unlimited. $max_byte_for_audit_logs=1048576 should be sufficient.</li>
<li>quota audit[$audit_index] lines (0 &lt;= $audit_index &lt;= 255) are max number of audit logs which can be held in the kernel space. $max_logs_for_allowed_request is for allowed requests. $max_logs_for_unmatched_request is for unmatched requests. $max_logs_for_denied_request is for denied requests. Default is 0. Unless you have special reasons, you should set 0 to $max_logs_for_allowed_request. Regarding $max_logs_for_unmatched_request and $max_logs_for_denied_request, 1024 should be sufficient.</li>
<li>string_group $string_group_name lines define group of strings. $string_group_member is a member for $string_group_name group.</li>
<li>number_group $number_group_name lines define group of numbers. $number_group_member is a member for $number_group_name group.</li>
<li>ip_group $ip_group_name lines define group of IP addresses. $ip_group_member is a member for $ip_group_name group.</li>
</ul>

<p>ACL part is consists with 0 or more repetitions of below block.</p>

<table border="1">
<tr><td>
$acl_priority acl $operation $conditions_to_filter<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit $audit_index<br>
&nbsp;&nbsp;&nbsp;&nbsp;$cond_priority $decision $conditions_to_allow_or_deny
</td></tr>
</table>

<ul>
<li>A block which starts with $acl_priority determines whether to evaluate rules in this block or not.</li>
<li>Blocks which start with $acl_priority can be defined as many as you need.</li>
<li>$acl_priority is a priority (an integer between 0 and 65535) which controls which block should be evaluated first (among all blocks defined in the policy).</li>
<li>Blocks are evaluated from smaller $acl_priority values to larger $acl_priority values.</li>
<li>If two blocks have same $acl_priority value, the block which is defined first is evaluated first.</li>
<li>$operation is "operation".</li>
<li>$conditions_to_filter is "conditional expressions" which can be applied to "operation". Omit $conditions_to_filter to evaluate this block unconditionally.</li>
<li>Access requests will be denied if one of deny lines (among all blocks defined in the policy) matches.</li>
</ul>

<p>$decision lines in a block is evaluated only when the block's $acl_priority line matched.</p>

<ul>
<li>A line which starts with $cond_priority determines whether to grant the access request or not.</li>
<li>Lines which start with $cond_priority can be defined as many as you need.</li>
<li>$cond_priority is a priority (an integer between 0 and 65535) which controls which line should be checked first (among all lines defined in the block).</li>
<li>Lines are checked from smaller $cond_priority values to larger priority values.</li>
<li>If two lines have same $cond_priority value, the line which is defined first is checked first.</li>
<li>$decision is either allow or deny.</li>
<li>$conditions_to_allow_or_deny is "conditional expressions" which can be applied to "operation". Omit $conditions_to_allow_or_deny to match this line unconditionally.</li>
</ul>

<p>Checking of $decision lines in a block lasts until it matches a $decision line or it reaches to the end of block.</p>

<ul>
<li>If $conditions_to_allow_or_deny of a deny line matches, the access request is denied. At the same time, access denied log is generated if memory used for audit logs is smaller than $max_byte_for_audit_logs bytes and number of denied logs which is in the kernel is smaller than $max_logs_for_denied_request of quota audit[$audit_index] line where $audit_index is specified by audit line of this block.</li>
<li>If $conditions_to_allow_or_deny of an allow line matches, the evaluation of this block ends and proceeds to next block. At the same time, access allowed log is generated if memory used for audit logs is smaller than $max_byte_for_audit_logs bytes and number of allowed logs which is in the kernel is smaller than $max_logs_for_allowed_request of quota audit[$audit_index] line where $audit_index is specified by audit line of this block.</li>
<li>If none of $conditions_to_allow_or_deny matches, the evaluation of this block ends and proceeds to next block. At the same time, access unmatched log is generated if memory used for audit logs is smaller than $max_byte_for_audit_logs bytes and number of unmatched logs which is in the kernel is smaller than $max_logs_for_unmatched_request of quota audit[$audit_index] line where $audit_index is specified by audit line of this block.</li>
</ul>

<p>Access requests will be denied only when "deny" line of "acl" block matched. There are three exceptions. Regarding permission to modify policy (i.e. "acl modify_policy" blocks), permission to change domains manually (i.e. "acl manual_domain_transition" blocks) and permission to change domains automatically (i.e. "acl auto_domain_transition" blocks), access requests will be granted only when "allow" line of all blocks match, in order to avoid unintended modification of policy or domain transition.</p>

<p>$acl_priority and $cond_priority values are used for two purposes. One is for selectively deny operations using "deny" lines. For example,</p>

<table border="1">
<tr><td>
10 acl write path.fsmagic=0x9FA0<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny path="proc:/cmdline"<br>
&nbsp;&nbsp;&nbsp;&nbsp;20 allow
</td></tr>
</table>

<p>denies opening /proc/cmdline on the proc filesystem (proc filesystem's magic number is 0x9FA0) for reading while allowing opening all other files.</p>

<p>The other is for controlling which "transition=" and "handler=" arguments should be used when these arguments matched more than once. For example, 2 "acl execute" blocks with 5 transition= arguments are defined (conditions$X is <a href="#conditions">"conditional expressions"</a> such as path.uid=task.uid and path.uid!=task.uid).</p>

<table border="1">
<tr><td>
10 acl execute conditions1<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow conditions2 transition="domainname1" <br>
&nbsp;&nbsp;&nbsp;&nbsp;20 allow conditions3<br>
&nbsp;&nbsp;&nbsp;&nbsp;20 allow conditions4 transition="domainname2" <br>
<br>
20 acl execute conditions5<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow conditions6 transition="domainname3" <br>
&nbsp;&nbsp;&nbsp;&nbsp;20 allow conditions7 transition=NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;20 allow conditions8 transition="domainname4"
</td></tr>
</table>

<p>Domain transition is determined from the first matching transition= argument of allow lines, and keeps current domain if none of matching transition= argument was found. In other words,</p>

<ul>
<li>If conditions1 and conditions2 are met, then transit to domainname1 domain when execute request succeeded.</li>
<li>Otherwise, if conditions1 and conditions3 are met, then proceed to next block.</li>
<li>Otherwise, if conditions1 and conditions4 are met, then transit to domainname3 domain when execute request succeeded.</li>
<li>Otherwise, if conditions5 and conditions6 are met, then transit to domainname5 domain when execute request succeeded.</li>
<li>Otherwise, if conditions5 and conditions7 are met, then keep current domain even if execute request succeeded.</li>
<li>Otherwise, if conditions5 and conditions8 are met, then transit to domainname7 domain when execute request succeeded.</li>
<li>Otherwise, keep current domain even if execute request succeeded.</li>
</ul>

<p>Same rule applies to handler= argument. That is, execute handler is determined from the first matching handler= argument of allow lines, and does not use execute handler if none of matching handler= argument was found.</p>

<h3><a name="policy_examples">4.2. Examples</a></h3>

<p>Below example restricts mount operation to allow by only /bin/mount program with one of</p>

<ul>
<li>mounting proc filesystem to /proc/ with default mount options</li>
<li>mounting sysfs filesystem to /sys/ with default mount options</li>
<li>mounting devpts filesystem to /dev/pts/ with default mount options</li>
<li>mounting tmpfs filesystem to /dev/shm/ with default mount options</li>
<li>remounting a filesystem which is mounted on / with read-only option</li>
<li>remounting a filesystem which is mounted on / with noatime option</li>
<li>mounting securityfs filesystem to /sys/kernel/security/ with default mount options</li>
</ul>

<p>combinations. Mount requests by other than /bin/mount program are denied. Mount requests other than combinations not listed is also denied.</p>

<table border="1">
<tr><td>
100 acl mount<br>
&nbsp;&nbsp;&nbsp;&nbsp;audit allowed=0 unmatched=0 denied=1024<br>
&nbsp;&nbsp;&nbsp;&nbsp;1 deny task.exe!="/bin/mount"<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="proc" target="/proc/" fstype="proc" flags=0x0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="sysfs" target="/sys/" fstype="sysfs" flags=0x0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="devpts" target="/dev/pts/" fstype="devpts" flags=0x0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="tmpfs" target="/dev/shm/" fstype="tmpfs" flags=0x0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="/dev/sda1" target="/" fstype="--remount" flags=0x1<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="/dev/sda1" target="/" fstype="--remount" flags=0x400<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 allow source="securityfs" target="sysfs:/kernel/security/" fstype="securityfs" flags=0x0<br>
&nbsp;&nbsp;&nbsp;&nbsp;10 deny
</td></tr>
</table>

</body>
</html>
