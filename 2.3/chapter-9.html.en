<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-US">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="content-style-type" content="text/css">
<link rel="stylesheet" href="../media/tomoyolinux.css" media="all" type="text/css">
<title>TOMOYO Linux 2.3.x : The Official Guide : Chapter 9</title>
</head>

<body>

<div id="titlebar">
<a href="../index.html.en"><img src="../media/tomoyotitle.png" alt="tomoyotitle.png" width="320" height="40" border="0" align="left"></a>
</div>

<div id="navbar" class="tomoyo-documentation">
<ul id="navbarlist">
<li id="tomoyo-home"><a href="../index.html.en" title="TOMOYO Linux Home Page">Home</a></li>
<li id="tomoyo-about"><a href="../about.html.en" title="About TOMOYO Linux">About</a></li>
<li id="tomoyo-download"><a href="../download.html.en" title="Get TOMOYO Linux">Download</a></li>
<li id="tomoyo-changelogs"><a href="../changelogs.html.en" title="TOMOYO Linux ChangeLogs">ChangeLogs</a></li>
<li id="tomoyo-documentation"><a href="../documentation.html.en" title="Official Documentation">Documentation</a></li>
<li id="tomoyo-support"><a href="../support.html.en" title="Support information">Support</a></li>
<li id="tomoyo-links"><a href="../links.html.en" title="Links">Links</a></li>
</ul>
<ul id="switch-language">
<li id="tomoyo-switch-language"><a href="chapter-9.html.ja" title="Go to Japanese page">Japanese page</a></li>
</ul>
</div>

<div id="content">

<div id="documentation">

<div class="navheader">
<p><a href="chapter-8.html.en">&lt;Prev&gt;</a> <a href="index.html.en">&lt;Index&gt;</a> <a href="chapter-10.html.en">&lt;Next&gt;</a></p>
</div>

<h2>Chapter 9: Advanced profile management</h2>

<h3><a name="9.1">9.1. Profile initialization</a></h3>

<p>Profile can be modified to make development of policy easier depending on what functionality you wish to restrict. Profiles can be modified using the policy editor at any later date to fit your needs. The following table summarizes the command-line options available:</p>

<div class="simple-table-wrap">
<table>
<tr>
<th><p>Option</p></th>
<th><p>Default</p></th>
<th><p>Meaning</p></th>
</tr>
<tr>
<td><p>root="$rootdir"</p></td>
<td><p>/</p></td>
<td><p>Change the root directory in which to create configuration files.</p></td>
</tr>
<tr>
<td><p>policy_dir="$configdir"</p></td>
<td><p>/etc/tomoyo/</p></td>
<td><p>Change the directory in which to create configuration files. If you specify this option then a symbolic link must be created named "/etc/tomoyo" that points to "$condigdir".</p></td>
</tr>
</table>
</div>

<p>If you executed <code>/usr/lib/tomoyo/init_policy</code>, "/etc/tomoyo/profile.conf" will look like this:</p>

<pre>
PROFILE_VERSION=20090903
PREFERENCE::enforcing={ verbose=yes }
PREFERENCE::learning={ verbose=no max_entry=2048 }
PREFERENCE::permissive={ verbose=yes }
0-COMMENT=-----Disabled Mode-----
0-CONFIG={ mode=disabled }
1-COMMENT=-----Learning Mode-----
1-CONFIG={ mode=learning }
2-COMMENT=-----Permissive Mode-----
2-CONFIG={ mode=permissive }
3-COMMENT=-----Enforcing Mode-----
3-CONFIG={ mode=enforcing }
</pre>

<h3><a name="9.2">9.2. Profile syntax</a></h3>

<h4><a name="9.2.1">9.2.1. Fields</a></h4>

<p>Each profile contains 3 fields:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Name</p></th>
<th><p>Control</p></th>
</tr>
<tr>
<td><p>COMMENT</p></td>
<td><p>Description of the profile.</p></td>
</tr>
<tr>
<td><p>CONFIG</p></td>
<td><p>Configuration of operation mode.</p></td>
</tr>
<tr>
<td><p>PREFERENCE</p></td>
<td><p>Configuration of various options.</p></td>
</tr>
</table>
</div>

<h4><a name="9.2.2">9.2.2. The CONFIG field</a></h4>

<p>The following options are available in the CONFIG field:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Option</p></th>
<th><p>Default</p></th>
<th><p>Meaning</p></th>
</tr>
<tr>
<td><p>mode</p></td>
<td><p>disabled</p></td>
<td><p>Set what mode to use. See the table below.</p></td>
</tr>
</table>
</div>

<p>The "mode" parameter of the CONFIG line can contain one of the following values:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Value</p></th>
<th><p>Meaning</p></th>
</tr>
<tr>
<td><p>disabled</p></td>
<td><p>Works as if a regular kernel.</p></td>
</tr>
<tr>
<td><p>learning</p></td>
<td><p>Do not reject an access request if the request violates policy. Append the request to policy.</p></td>
</tr>
<tr>
<td><p>permissive</p></td>
<td><p>Do not reject an access request if the request violates policy. Do not append the request to policy.</p></td>
</tr>
<tr>
<td><p>enforcing</p></td>
<td><p>Reject an access request if the request violates policy. Do not append the request to policy.</p></td>
</tr>
</table>
</div>

<p>By default, the CONFIG line specifies the default operation mode for all categories and functionalities. The absence of the CONFIG line is equivalent to "mode=disabled". The default configuration can be overwritten by using one or more CONFIG lines per profile and using category-specific configuration:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Name</p></th>
<th><p>Category to specify operation mode for</p></th>
</tr>
<tr>
<td><p>CONFIG</p></td>
<td><p>All operations</p></td>
</tr>
<tr>
<td><p>CONFIG::file</p></td>
<td><p>File related operations only</p></td>
</tr>
</table>
</div>

<p>(But since CONFIG::file is the only category supported as of this version, CONFIG and CONFIG::file refer the same operations.)</p>

<p>Category-specific configuration can be further overwritten by functionality-specific configuration:</p>

<div class="simple-table">
<table>
<tr>
<th><p>Name</p></th>
<th><p>Functionality to specify operation mode for</p></th>
</tr>
<tr>
<td><p>CONFIG::file::execute</p></td>
<td><p>Program execution and domain transition</p></td>
</tr>
<tr>
<td><p>CONFIG::file::open</p></td>
<td><p>Opening files for reading or writing</p></td>
</tr>
<tr>
<td><p>CONFIG::file::create</p></td>
<td><p>File creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::unlink</p></td>
<td><p>File deletion</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mkdir</p></td>
<td><p>Directory creation.</p></td>
</tr>
<tr>
<td><p>CONFIG::file::rmdir</p></td>
<td><p>Directory deletion.</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mkfifo</p></td>
<td><p>FIFO creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mksock</p></td>
<td><p>UNIX domain socket creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::truncate</p></td>
<td><p>File truncation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::symlink</p></td>
<td><p>Symlink creation.</p></td>
</tr>
<tr>
<td><p>CONFIG::file::rewrite</p></td>
<td><p>Rewriting file contents</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mkblock</p></td>
<td><p>Block device file creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mkchar</p></td>
<td><p>Character device file creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::link</p></td>
<td><p>Link creation</p></td>
</tr>
<tr>
<td><p>CONFIG::file::rename</p></td>
<td><p>File or directory renaming</p></td>
</tr>
<tr>
<td><p>CONFIG::file::chmod</p></td>
<td><p>File or directory chmod</p></td>
</tr>
<tr>
<td><p>CONFIG::file::chown</p></td>
<td><p>File or directory chown</p></td>
</tr>
<tr>
<td><p>CONFIG::file::chgrp</p></td>
<td><p>File or directory chgrp</p></td>
</tr>
<tr>
<td><p>CONFIG::file::ioctl</p></td>
<td><p>Use of the ioctl system calls</p></td>
</tr>
<tr>
<td><p>CONFIG::file::chroot</p></td>
<td><p>Use of chroot</p></td>
</tr>
<tr>
<td><p>CONFIG::file::mount</p></td>
<td><p>Use of mount</p></td>
</tr>
<tr>
<td><p>CONFIG::file::unmount</p></td>
<td><p>Use of umount</p></td>
</tr>
<tr>
<td><p>CONFIG::file::pivot_root</p></td>
<td><p>Use of pivot_root</p></td>
</tr>
</table>
</div>

<p>For example, you could create a profile for only restricting file execution:</p>

<pre>
4-COMMENT=-----Enforcing file::execute only-----
4-CONFIG::file::execute={ mode=enforcing }
</pre>

<p>Note that the settings for "CONFIG::file::execute" overwrite the settings for "CONFIG::file", which in turn overwrite the settings for "CONFIG" (which in this case has not been set and so is equivalent to "mode=disabled"). This allows fine-grained control over which operations you wish to restrict.</p>

<p>It is also possible to mix different restriction modes within a single profile, such as enforcing program execution operations but staying in "Learning Mode" for other file-related operations:</p>

<pre>
5-COMMENT=-----Enforcing file::execute and learning other file operations-----
5-CONFIG::file={ mode=learning  }
5-CONFIG::file::execute={ mode=enforcing }
</pre>

<h4><a name="9.2.3">9.2.3. The PREFERENCE field</a></h4>

<p>The PREFERENCE line holds the following options:</p>

<div class="simple-table-wrap">
<table>
<tr>
<th><p>Name</p></th>
<th><p>Function</p></th>
</tr>
<tr>
<td><p>verbose</p></td>
<td><p>Whether to print warning message on console upon policy violation event. This value can be either "yes" or "no".</p></td>
</tr>
<tr>
<td><p>max_entry</p></td>
<td><p>Set the maximum number of ACL entries automatically added to each domain by the kernel when using learning mode. This value must be an integer, and setting to "0" makes the "Learning Mode" as if "Permissive Mode". Maximum memory used can also be controlled using the <a href="policy-specification/securityfs-interface.html.en#meminfo">/sys/kernel/security/tomoyo/meminfo</a> interface.</p></td>
</tr>
</table>
</div>

</div><!-- documentation -->

</div><!-- content -->

<div id="navfooter">
<hr>
<table>
<tr>
<td class="docs-previous">
<a href="chapter-8.html.en">Prev</a>
</td>
<td class="docs-index">
<a href="index.html.en">Index</a>
</td>
<td class="docs-next">
<a href="chapter-10.html.en">Next</a>
</td>
</tr>
<tr>
<td class="docs-previous-description">
<p>Chapter 8: Interface permissions</p>
</td>
<td class="docs-home">
</td>
<td class="docs-next-description">
<p>Chapter 10: Reinforced authentication</p>
</td>
</tr>
</table>
</div>

<div id="footer">
<p class="language">Go to <a href="chapter-9.html.ja">Japanese page</a>.</p>
<p class="timestamp">Last modified: $Date$</p>
<p class="trademark">Linux&reg; is a registered trademark of Linus Torvalds world-wide. TOMOYO&reg; is a registered trademark of <a href="http://www.nttdata.co.jp/en/">NTT DATA Corporation</a>.</p>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</div>

</body>
</html>
